!function(){Cocoon=window.Cocoon?window.Cocoon:{},Cocoon.version="3.0.5",Cocoon.nativeAvailable=!!window.ext,Cocoon.extend=function(a,b){var c=a.prototype,d=function(){};d.prototype=b.prototype,a.prototype=new d,a.superclass=b.prototype,a.prototype.constructor=a,b.prototype.constructor===Object.prototype.constructor&&(b.prototype.constructor=b);for(var e in c)c.hasOwnProperty(e)&&(a.prototype[e]=c[e])},Cocoon.clone=function(a,b){if(null==a||"object"!=typeof a)return a;var c=[];for(var d in a)c.push(b.hasOwnProperty(d)?b[d]:a[d]);return c},Cocoon.callNative=function(a,b,c,d){if(Cocoon.nativeAvailable){var e=Array.prototype.slice.call(c);e.unshift(b);var f=ext[a],g=d?f.makeCallAsync:f.makeCall,h=g.apply(f,e),i=h;if("string"==typeof h)try{i=JSON.parse(h)}catch(j){console.log(j)}return i}},Cocoon.getObjectFromPath=function(a,b){for(var c=b.split("."),d=a,e=0,f=c.length;f>e;++e)d[c[e]]=d[c[e]]||void 0,d=d[c[e]];return d},Cocoon.EventHandler=function(a,b,c,d){return this.listeners=[],this.listenersOnce=[],this.chainFunction=d,this.addEventListener=function(e){if(d){var f=function(){d.call(this,arguments.callee.sourceListener,Array.prototype.slice.call(arguments))};e.CocoonEventHandlerChainFunction=f,f.sourceListener=e,e=f}var g=Cocoon.getObjectFromPath(Cocoon,b);if(g&&g.nativeAvailable)ext[a].addEventListener(c,e);else{var h=this.listeners.indexOf(e);0>h&&this.listeners.push(e)}},this.addEventListenerOnce=function(e){if(d){var f=function(){d(arguments.callee.sourceListener,Array.prototype.slice.call(arguments))};f.sourceListener=e,e=f}var g=Cocoon.getObjectFromPath(Cocoon,b);if(g.nativeAvailable)ext[a].addEventListenerOnce(c,e);else{var h=this.listeners.indexOf(e);0>h&&this.listenersOnce.push(e)}},this.removeEventListener=function(e){d&&(e=e.CocoonEventHandlerChainFunction,delete e.CocoonEventHandlerChainFunction);var f=Cocoon.getObjectFromPath(Cocoon,b);if(f.nativeAvailable)ext[a].removeEventListener(c,e);else{var g=this.listeners.indexOf(e);g>=0&&this.listeners.splice(g,1)}},this.removeEventListenerOnce=function(e){d&&(e=e.CocoonEventHandlerChainFunction,delete e.CocoonEventHandlerChainFunction);var f=Cocoon.getObjectFromPath(Cocoon,b);if(f.nativeAvailable)ext[a].removeEventListenerOnce(c,e);else{var g=this.listenersOnce.indexOf(e);g>=0&&this.listenersOnce.splice(g,1)}},this.notifyEventListeners=function(){var d=Cocoon.getObjectFromPath(Cocoon,b);if(d&&d.nativeAvailable)ext[a].notifyEventListeners(c);else{var e=Array.prototype.slice.call(arguments),f=Array.prototype.slice.call(this.listeners),g=Array.prototype.slice.call(this.listenersOnce),h=this;setTimeout(function(){for(var a=0;a<f.length;a++)f[a].apply(h,e);for(var a=0;a<g.length;a++)g[a].apply(h,e)},0),h.listenersOnce=[]}},this},Cocoon.define=function(a,b){for(var c="Cocoon."==a.substring(0,7)?a.substr(7):a,d=window.Cocoon,e=c.split("."),f=d,g=0;g<e.length;g++){var h=e[g];if(console.log(f[h]?"Updated namespace: - "+a:"Created namespace: "+a),f=f[h]=g==e.length-1?b(f[h]||{}):{},!f)throw"Unable to create class "+a}return!0},console.log("Created namespace: Cocoon")}(),Cocoon.define("Cocoon.Signal",function(a){"use strict";return a.createSignal=function(){this.handle=null,this.signals={},this.register=function(a,b){if(!a&&!b)throw new Error("Can't create signal "+(a||""));if(b.addEventListener)return this.signals[a]=b,!0;if(!b.addEventListener){this.signals[a]={};for(var c in b)b.hasOwnProperty(c)&&(this.signals[a][c]=b[c]);return!0}throw new Error("Can't create handler for "+a+" signal.")},this.expose=function(){return function(a,b,c){var d=!1;if(1===arguments.length){var e=this,f=function(a){this.signal=a};return f.prototype.remove=function(a){var b=e.signals[this.signal];b&&b.removeEventListener&&(b.removeEventListener.apply(e,[a]),e.signals[this.signal]=void 0)},new f(a)}if(c&&c.once&&(d=!0),!this.signals[a])throw new Error("The signal "+a+" does not exists.");var g=this.signals[a];if(g.addEventListener&&(d?g.addEventListenerOnce(function(){b.apply(this||window,arguments)}):g.addEventListener(function(){b.apply(this||window,arguments)})),!this.signals[a].addEventListener)for(var h in this.signals[a])if(this.signals[a].hasOwnProperty(h)){var g=this.signals[a][h];d?g.addEventListenerOnce(function(){this.clbk[this.name].apply(this||window,arguments)}.bind({name:h,clbk:b})):g.addEventListener(function(){this.clbk[this.name].apply(this||window,arguments)}.bind({name:h,clbk:b}))}}.bind(this)}},a}),Cocoon.define("Cocoon.App",function(a){a.nativeAvailable=!!window.ext&&!!window.ext.IDTK_APP,a.isBridgeAvailable=function(){if("boolean"===Cocoon.App.forward.nativeAvailable)return Cocoon.App.forward.nativeAvailable;var a=Cocoon.callNative("IDTK_APP","forwardAvailable",arguments);return a=!!a,Cocoon.App.forward.nativeAvailable=a,a},a.forward=function(a){return Cocoon.App.nativeAvailable&&Cocoon.App.isBridgeAvailable()?Cocoon.callNative("IDTK_APP","forward",arguments):navigator.isCocoonJS?void 0:"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name?window.parent.eval(a):window.frames.CocoonJS_App_ForCocoonJS_WebViewIFrame.window.eval(a)},a.forwardAsync=function(a,b){return Cocoon.App.nativeAvailable&&Cocoon.App.isBridgeAvailable()?"undefined"!=typeof b?ext.IDTK_APP.makeCallAsync("forward",a,b):ext.IDTK_APP.makeCallAsync("forward",a):void setTimeout(function(){var c;"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name?(c=window.parent.eval(a),"function"==typeof b&&b(c)):(c=window.parent.frames.CocoonJS_App_ForCocoonJS_WebViewIFrame.window.eval(a),"function"==typeof b&&b(c))},1)},a.load=function(a,b){if(Cocoon.App.nativeAvailable)return Cocoon.callNative("IDTK_APP","loadPath",arguments);if(!navigator.isCocoonJS){var c=new XMLHttpRequest;c.onreadystatechange=function(b){if(4===c.readyState)if(200===c.status){var d;d=Cocoon.App.EmulatedWebViewIFrame?"window.Cocoon && window.Cocoon.App.onLoadInCocoonJSSucceed.notifyEventListeners('"+a+"');":"window.Cocoon && window.Cocoon.App.onLoadInTheWebViewSucceed.notifyEventListeners('"+a+"');",Cocoon.App.forwardAsync(d),window.location.href=a}else if(404===c.status){this.onreadystatechange=null;var d;d=Cocoon.App.EmulatedWebViewIFrame?"Cocoon && Cocoon.App.onLoadInCocoonJSFailed.notifyEventListeners('"+a+"');":"Cocoon && Cocoon.App.onLoadInTheWebViewFailed.notifyEventListeners('"+a+"');",Cocoon.App.forwardAsync(d)}},c.open("GET",a,!0),c.send()}},a.reload=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","reload",arguments):navigator.isCocoonJS?void 0:"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name?window.parent.location.reload():window.parent.frames.CocoonJS_App_ForCocoonJS_WebViewIFrame.window.location.reload()},a.openURL=function(a){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","openURL",arguments,!0):void(navigator.isCocoonJS||window.open(a,"_blank"))},a.exit=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","forceToFinish",arguments):void(navigator.isCocoonJS||window.close())},a.StorageType={APP_STORAGE:"APP_STORAGE",INTERNAL_STORAGE:"INTERNAL_STORAGE",EXTERNAL_STORAGE:"EXTERNAL_STORAGE",TEMPORARY_STORAGE:"TEMPORARY_STORAGE"},a.onSuspended=new Cocoon.EventHandler("IDTK_APP","App","onsuspended"),a.onActivated=new Cocoon.EventHandler("IDTK_APP","App","onactivated"),a.onSuspending=new Cocoon.EventHandler("IDTK_APP","App","onsuspending"),a.onMemoryWarning=new Cocoon.EventHandler("IDTK_APP","App","onmemorywarning");var b=new Cocoon.Signal.createSignal;return b.register("suspended",a.onSuspended),b.register("activated",a.onActivated),b.register("suspending",a.onSuspending),b.register("memorywarning",a.onMemoryWarning),a.on=b.expose(),a}),Cocoon.define("Cocoon.App",function(a){function b(){var a=Cocoon.App.EmulatedWebView;if(!a){a=document.createElement("div"),a.setAttribute("id","CocoonJS_App_ForCocoonJS_WebViewDiv"),a.style.width=0,a.style.height=0,a.style.position="absolute",a.style.left=0,a.style.top=0,a.style.backgroundColor="transparent",a.style.border="0px solid #000";var b=document.createElement("IFRAME");b.setAttribute("id","CocoonJS_App_ForCocoonJS_WebViewIFrame"),b.setAttribute("name","CocoonJS_App_ForCocoonJS_WebViewIFrame"),b.style.width=0,b.style.height=0,b.frameBorder=0,b.allowtransparency=!0,a.appendChild(b),Cocoon.App.EmulatedWebView=a,Cocoon.App.EmulatedWebViewIFrame=b,document.body||(document.body=document.createElement("body")),document.body.appendChild(Cocoon.App.EmulatedWebView)}}a.pause=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","pause",arguments):void 0},a.resume=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","resume",arguments):void 0},a.loadInTheWebView=function(a,c){if(navigator.isCocoonJS&&Cocoon.App.nativeAvailable)Cocoon.callNative("IDTK_APP","loadInTheWebView",arguments);else{var d=new XMLHttpRequest;d.onreadystatechange=function(c){if(4===d.readyState)if(d.status>=200&&d.status<=299||0===d.status){b();var e=function(b){Cocoon.App.onLoadInTheWebViewSucceed.notifyEventListeners(a),Cocoon.App.EmulatedWebViewIFrame.removeEventListener("load",e)};Cocoon.App.EmulatedWebViewIFrame.addEventListener("load",e),Cocoon.App.EmulatedWebViewIFrame.contentWindow.location.href=a}else this.onreadystatechange=null,Cocoon.App.onLoadInTheWebViewFailed.notifyEventListeners(a)},d.open("GET",a,!0),d.send()}},a.reloadWebView=function(){Cocoon.App.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","reloadWebView",arguments):(b(),Cocoon.App.EmulatedWebViewIFrame.contentWindow.location.reload())},a.showTheWebView=function(a,c,d,e){Cocoon.App.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","showTheWebView",arguments):(b(),Cocoon.App.EmulatedWebViewIFrame.style.width=(d?d/window.devicePixelRatio:window.innerWidth)+"px",Cocoon.App.EmulatedWebViewIFrame.style.height=(e?e/window.devicePixelRatio:window.innerHeight)+"px",Cocoon.App.EmulatedWebView.style.left=(a?a:0)+"px",Cocoon.App.EmulatedWebView.style.top=(c?c:0)+"px",Cocoon.App.EmulatedWebView.style.width=(d?d/window.devicePixelRatio:window.innerWidth)+"px",Cocoon.App.EmulatedWebView.style.height=(e?e/window.devicePixelRatio:window.innerHeight)+"px",Cocoon.App.EmulatedWebView.style.display="block")},a.hideTheWebView=function(){if(Cocoon.App.nativeAvailable&&navigator.isCocoonJS){var a="ext.IDTK_APP.makeCall('hide');";return Cocoon.App.forwardAsync(a)}b(),Cocoon.App.EmulatedWebView.style.display="none"},a.exitCallback=function(a){navigator.isCocoonJS&&Cocoon.App.nativeAvailable&&(window.onidtkappfinish=a)},a.forwardedEventFromTheWebView=function(a,b){var c=JSON.parse(b);c.target=window;var d=new Event(a);for(var e in c)d[e]=c[e];d.target=window,window.dispatchEvent(d);for(var f=document.getElementsByTagName("canvas"),g=0;g<f.length;g++)d.target=f[g],f[g].dispatchEvent(d)},a.onLoadInTheWebViewSucceed=new Cocoon.EventHandler("IDTK_APP","App","forwardpageload"),a.onLoadInTheWebViewFailed=new Cocoon.EventHandler("IDTK_APP","App","forwardpagefail");var c=new Cocoon.Signal.createSignal;return c.register("load",{success:a.onLoadInTheWebViewSucceed,error:a.onLoadInTheWebViewFailed}),a.WebView=Cocoon.WebView||{},a.WebView.on=c.expose(),a}),Cocoon.define("Cocoon.Utils",function(a){"use strict";return a.logMemoryInfo=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","logMemoryInfo",arguments):void 0},a.textureReduction=function(a,b,c){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","setDefaultTextureReducerThreshold",arguments):void 0},a.markAsMusic=function(a){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","addForceMusic",arguments):void 0},a.captureScreen=function(a,b,c,d){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","captureScreen",arguments):void 0},a.captureScreenAsync=function(a,b,c,d,e){Cocoon.nativeAvailable&&Cocoon.callNative("IDTK_APP","captureScreen",arguments,!0)},a.setAntialias=function(a){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","setDefaultAntialias",arguments):void 0},a.setWebGLEnabled=function(a){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","setDefaultAntialias",arguments):void 0},a.setNPOTEnabled=function(a){return Cocoon.nativeAvailable&&navigator.isCocoonJS?window.ext.IDTK_APP.makeCall("setNPOTEnabled",a):void 0},a.setMaxMemory=function(a){return Cocoon.nativeAvailable&&navigator.isCocoonJS?window.ext.IDTK_APP.makeCall("setMaxMemory",a):void 0},a.CaptureType={EVERYTHING:0,COCOONJS_GL_SURFACE:1,JUST_SYSTEM_VIEWS:2},a.existsPath=function(a,b){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","existsPath",arguments):!1},a.setTextCacheSize=function(a){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","setTextCacheSize",arguments):void 0},a}),Cocoon.define("Cocoon.Dialog",function(a){"use strict";return a.keyboardType={TEXT:"text",NUMBER:"num",PHONE:"phone",EMAIL:"email",URL:"url"},a.prompt=function(a,b){if(!b)throw"Callback missing for Cocoon.Dialog.prompt();";var c=Cocoon.Dialog.keyboardType.TEXT;switch(a.type){case Cocoon.Dialog.keyboardType.TEXT:c=Cocoon.Dialog.keyboardType.TEXT;break;case Cocoon.Dialog.keyboardType.NUMBER:c=Cocoon.Dialog.keyboardType.NUMBER;break;case Cocoon.Dialog.keyboardType.PHONE:c=Cocoon.Dialog.keyboardType.PHONE;break;case Cocoon.Dialog.keyboardType.EMAIL:c=Cocoon.Dialog.keyboardType.EMAIL;break;case Cocoon.Dialog.keyboardType.URL:c=Cocoon.Dialog.keyboardType.URL}var d={title:"",message:"",text:"",type:c,cancelText:"Cancel",confirmText:"Ok"},e=Cocoon.clone(d,a),f=function(){Cocoon.Dialog.onTextDialogCancelled.removeEventListener(g),Cocoon.Dialog.onTextDialogFinished.removeEventListener(f),b.success.apply(window,Array.prototype.slice.call(arguments))},g=function(){Cocoon.Dialog.onTextDialogCancelled.removeEventListener(g),Cocoon.Dialog.onTextDialogFinished.removeEventListener(f),b.cancel.apply(window,Array.prototype.slice.call(arguments))};return Cocoon.Dialog.onTextDialogCancelled.addEventListener(g),Cocoon.Dialog.onTextDialogFinished.addEventListener(f),Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","showTextDialog",e,!0):void setTimeout(function(){var a=prompt(d.message,d.text),b=a?Cocoon.Dialog.onTextDialogFinished:Cocoon.Dialog.onTextDialogCancelled;b.notifyEventListeners(a)},0)},a.confirm=function(a,b){if(!b)throw"Callback missing for Cocoon.Dialog.confirm();";var c={title:"",message:"",cancelText:"Cancel",confirmText:"Ok"},d=Cocoon.clone(c,a),e=function(){Cocoon.Dialog.onMessageBoxDenied.removeEventListenerOnce(f),b(!0)},f=function(){Cocoon.Dialog.onMessageBoxConfirmed.removeEventListenerOnce(e),b(!1)};return Cocoon.Dialog.onMessageBoxDenied.addEventListenerOnce(f),Cocoon.Dialog.onMessageBoxConfirmed.addEventListenerOnce(e),Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","showMessageBox",d,!0):void setTimeout(function(){var a=confirm(c.message),b=a?Cocoon.Dialog.onMessageBoxConfirmed:Cocoon.Dialog.onMessageBoxDenied;b.notifyEventListeners()},0)},a.showKeyboard=function(a,b){a=a||{},a.type=a.type||Cocoon.Dialog.keyboardType.TEXT;var c=b&&b.insertText,d=b&&b.deleteBackward,e=b&&b.done,f=b&&b.cancel;Cocoon.nativeAvailable&&Cocoon.callNative("IDTK_APP","showKeyboard",[a,c,d,e,f],!0)},a.dismissKeyboard=function(){Cocoon.nativeAvailable&&Cocoon.callNative("IDTK_APP","dismissKeyboard",[],!0)},a.onTextDialogFinished=new Cocoon.EventHandler("IDTK_APP","App","ontextdialogfinish"),a.onTextDialogCancelled=new Cocoon.EventHandler("IDTK_APP","App","ontextdialogcancel"),a.onMessageBoxConfirmed=new Cocoon.EventHandler("IDTK_APP","App","onmessageboxconfirmed"),a.onMessageBoxDenied=new Cocoon.EventHandler("IDTK_APP","App","onmessageboxdenied"),a}),Cocoon.define("Cocoon.WebView",function(a){return"undefined"==typeof Cocoon||null===Cocoon?a:"undefined"==typeof Cocoon.App||null===Cocoon.App?a:navigator.isCocoonJS?a:(a.show=function(a,b,c,d){if(Cocoon.App.nativeAvailable)return Cocoon.callNative("IDTK_APP","show",arguments);var e=window.parent.document.getElementById("CocoonJS_App_ForCocoonJS_WebViewDiv");e.style.left=(a?a:e.style.left)+"px",e.style.top=(b?b:e.style.top)+"px",e.style.width=(c?c/window.devicePixelRatio:window.parent.innerWidth)+"px",e.style.height=(d?d/window.devicePixelRatio:window.parent.innerHeight)+"px",e.style.display="block";var f=window.parent.document.getElementById("CocoonJS_App_ForCocoonJS_WebViewIFrame");f.style.width=(c?c/window.devicePixelRatio:window.parent.innerWidth)+"px",f.style.height=(d?d/window.devicePixelRatio:window.parent.innerHeight)+"px"},a.hide=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","hide",arguments):void(window.parent.document.getElementById("CocoonJS_App_ForCocoonJS_WebViewDiv").style.display="none")},a.loadInCocoon=function(a,b,c){if(Cocoon.App.nativeAvailable){var d="ext.IDTK_APP.makeCall('loadPath'";return"undefined"!=typeof a&&(d+=", '"+a+"'","undefined"!=typeof c&&(d+=", '"+c+"'")),d+=");",Cocoon.App.forwardAsync(d)}Cocoon.App.forwardAsync("Cocoon.App.load('"+a+"');")},a.reloadCocoonJS=function(){return Cocoon.App.nativeAvailable?Cocoon.App.forwardAsync("ext.IDTK_APP.makeCall('reload');"):void(navigator.isCocoonJS||window.parent.location.reload())},window.addEventListener("load",function(){function a(a,c){var d,e,f={};for(var d in c)e=b.indexOf(d),e>=0&&(f[d]=c[d]);var g="Cocoon && Cocoon.App && Cocoon.App.forwardedEventFromTheWebView && Cocoon.App.forwardedEventFromTheWebView("+JSON.stringify(a)+", '"+JSON.stringify(f)+"');";Cocoon.App.forward(g)}if(!Cocoon.App.nativeAvailable&&"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name){Cocoon.App.forwardEventsToCocoonJSEnabled=!1;var b=["timeStamp","button","type","x","y","pageX","pageY","clientX","clientY","offsetX","offsetY"],c=["dblclick","touchmove","mousemove","touchend","touchcancel","mouseup","touchstart","mousedown","release","dragleft","dragright","swipeleft","swiperight"];for(i=0;i<c.length;i++)window.addEventListener(c[i],function(b){return function(c){Cocoon.App.forwardEventsToCocoonJSEnabled&&a(b,c)}}(c[i]))}}),a.onLoadInCocoonJSSucceed=new Cocoon.EventHandler("IDTK_APP","App","forwardpageload"),a.onLoadInCocoonJSFailed=new Cocoon.EventHandler("IDTK_APP","App","forwardpagefail"),a)}),Cocoon.define("Cocoon.Proxify",function(a){"use strict";return a.getKeyForValueInDictionary=function(a,b){var c=null;for(var d in a)if(a[d]===b){c=d;break}return c},a.setupOriginProxyType=function(b,c,d,e){if(Cocoon.nativeAvailable){if(!b)throw"The given typeName must be valid.";if(!c&&!d&&!e)throw"There is no point on setting up a proxy for no attributes, functions nor eventHandlers.";c=c?c:[],d=d?d:[],e=e?e:[];var f=window,g="Cocoon.Proxify.setupDestinationProxyType("+JSON.stringify(b)+", "+JSON.stringify(e)+");";Cocoon.App.forward(g);var h=f[b];f[b]=function(){var a=this;this._cocoonjs_proxy_object_data={};var g="Cocoon.Proxify.newDestinationProxyObject("+JSON.stringify(b)+");";this._cocoonjs_proxy_object_data.id=Cocoon.App.forward(g),this._cocoonjs_proxy_object_data.eventHandlers={},this._cocoonjs_proxy_object_data.typeName=b,this._cocoonjs_proxy_object_data.eventListeners={},f[b]._cocoonjs_proxy_type_data.proxyObjects[this._cocoonjs_proxy_object_data.id]=this;for(var h=0;h<c.length;h++)!function(c){a.__defineSetter__(c,function(d){var e="Cocoon.Proxify.setDestinationProxyObjectAttribute("+JSON.stringify(b)+", "+a._cocoonjs_proxy_object_data.id+", "+JSON.stringify(c)+", "+JSON.stringify(d)+");";return Cocoon.App.forward(e)}),a.__defineGetter__(c,function(){var d="Cocoon.Proxify.getDestinationProxyObjectAttribute("+JSON.stringify(b)+", "+a._cocoonjs_proxy_object_data.id+", "+JSON.stringify(c)+");";return Cocoon.App.forward(d)})}(c[h]);for(var h=0;h<d.length;h++)!function(c){a[c]=function(){var a=Array.prototype.slice.call(arguments);a.unshift(c),a.unshift(this._cocoonjs_proxy_object_data.id),a.unshift(b);for(var d="Cocoon.Proxify.callDestinationProxyObjectFunction(",e=0;e<a.length;e++)d+=(1!==e?JSON.stringify(a[e]):a[e])+(e<a.length-1?", ":"");d+=");";var f=Cocoon.App.forwardAsync(d);return f}}(d[h]);for(var h=0;h<e.length;h++)!function(b){a.__defineSetter__(b,function(c){a._cocoonjs_proxy_object_data.eventHandlers[b]=c}),a.__defineGetter__(b,function(){return a._cocoonjs_proxy_object_data.eventHandlers[b]})}(e[h]);return a.addEventListener=function(b,c){var d=!0,e=a._cocoonjs_proxy_object_data.eventListeners[b];if(e)d=e.indexOf(c)<0;else{e=[],a._cocoonjs_proxy_object_data.eventListeners[b]=e;var f="Cocoon.Proxify.addDestinationProxyObjectEventListener("+JSON.stringify(a._cocoonjs_proxy_object_data.typeName)+", "+a._cocoonjs_proxy_object_data.id+", "+JSON.stringify(b)+");";Cocoon.App.forwardAsync(f)}d&&e.push(c)},a.removeEventListener=function(b,c){var d=a._cocoonjs_proxy_object_data.eventListeners[b];if(d){var e=d.indexOf(c);e>=0&&d.splice(e,1)}},this},f[b]._cocoonjs_proxy_type_data={originalType:h,proxyObjects:[]},f[b]._cocoonjs_proxy_type_data.deleteProxyObject=function(c){var d=a.getKeyForValueInDictionary(this.proxyObjects,c);if(d){var e="Cocoon.Proxify.deleteDestinationProxyObject("+JSON.stringify(b)+", "+c._cocoonjs_proxy_object_data.id+");";Cocoon.App.forwardAsync(e),c._cocoonjs_proxy_object_data=null,delete this.proxyObjects[d]}},f[b]._cocoonjs_proxy_type_data.callProxyObjectEventHandler=function(a,b){var c=this.proxyObjects[a],d=c._cocoonjs_proxy_object_data.eventHandlers[b];d&&d({target:c})},f[b]._cocoonjs_proxy_type_data.callProxyObjectEventListeners=function(a,b){for(var c=this.proxyObjects[a],d=c._cocoonjs_proxy_object_data.eventListeners[b].slice(),e=0;e<d.length;e++)d[e]({target:c})}}},a.takedownOriginProxyType=function(a){if(Cocoon.App.nativeAvailable){var b=window;b[a]&&b[a]._cocoonjs_proxy_type_data&&(b[a]=b[a]._cocoonjs_proxy_type_data.originalType)}},a.deleteOriginProxyObject=function(a){if(Cocoon.App.nativeAvailable){var b=window;a&&a._cocoonjs_proxy_object_data&&b[a._cocoonjs_proxy_object_data.typeName]._cocoonjs_proxy_type_data.deleteProxyObject(a)}},a.callOriginProxyObjectEventHandler=function(a,b,c){if(Cocoon.App.nativeAvailable){var d=window;d[a]._cocoonjs_proxy_type_data.callProxyObjectEventHandler(b,c)}},a.callOriginProxyObjectEventListeners=function(a,b,c){if(Cocoon.App.nativeAvailable){var d=window;d[a]._cocoonjs_proxy_type_data.callProxyObjectEventListeners(b,c)}},a.setupDestinationProxyType=function(a,b){if(Cocoon.App.nativeAvailable){var c=window;c[a]._cocoonjs_proxy_type_data={nextId:0,proxyObjects:{},eventHandlerNames:b}}},a.takedownDestinationProxyType=function(a){if(Cocoon.App.nativeAvailable){var b=window;parent[a]&&b[a]._cocoonjs_proxy_type_data&&delete b[a]._cocoonjs_proxy_type_data}},a.newDestinationProxyObject=function(a){if(Cocoon.App.nativeAvailable){var b=window,c=new b[a];c._cocoonjs_proxy_object_data={},c._cocoonjs_proxy_object_data.typeName=a;var d=b[a]._cocoonjs_proxy_type_data.nextId;b[a]._cocoonjs_proxy_type_data.proxyObjects[d]=c,c._cocoonjs_proxy_object_data.id=d,b[a]._cocoonjs_proxy_type_data.nextId++;for(var e=0;e<b[a]._cocoonjs_proxy_type_data.eventHandlerNames.length;e++)!function(a){c[a]=function(b){var c=this,d="Cocoon.App.callOriginProxyObjectEventHandler("+JSON.stringify(c._cocoonjs_proxy_object_data.typeName)+", "+c._cocoonjs_proxy_object_data.id+", "+JSON.stringify(a)+");";Cocoon.App.forwardAsync(d)}}(b[a]._cocoonjs_proxy_type_data.eventHandlerNames[e]);return c._cocoonjs_proxy_object_data.eventListeners={},d}},a.callDestinationProxyObjectFunction=function(a,b,c){if(Cocoon.App.nativeAvailable){var d=window,e=Array.prototype.slice.call(arguments);e.splice(0,3);var f=d[a]._cocoonjs_proxy_type_data.proxyObjects[b],g=f[c].apply(f,e);return g}},a.setDestinationProxyObjectAttribute=function(a,b,c,d){if(Cocoon.App.nativeAvailable){var e=window,f=e[a]._cocoonjs_proxy_type_data.proxyObjects[b];f[c]=d}},a.getDestinationProxyObjectAttribute=function(a,b,c){if(Cocoon.App.nativeAvailable){var d=window,e=d[a]._cocoonjs_proxy_type_data.proxyObjects[b];return e[c]}},a.deleteDestinationProxyObject=function(a,b){if(Cocoon.App.nativeAvailable){var c=window;delete c[a]._cocoonjs_proxy_type_data.proxyObjects[b]}},a.addDestinationProxyObjectEventListener=function(a,b,c){if(Cocoon.App.nativeAvailable){var d=window,e=d[a]._cocoonjs_proxy_type_data.proxyObjects[b],f=function(a){var b=this,d="Cocoon.Proxify.callOriginProxyObjectEventListeners("+JSON.stringify(b._cocoonjs_proxy_object_data.typeName)+", "+b._cocoonjs_proxy_object_data.id+", "+JSON.stringify(c)+");";Cocoon.App.forwardAsync(d)};e._cocoonjs_proxy_object_data.eventListeners[c]=f,e.addEventListener(c,f)}},a.xhr=function(){var a=["timeout","withCredentials","upload","status","statusText","responseType","response","responseText","responseXML","readyState"],b=["open","setRequestHeader","send","abort","getResponseHeader","getAllResponseHeaders","overrideMimeType"],c=["onloadstart","onprogress","onabort","onerror","onload","ontimeout","onloadend","onreadystatechange"];Cocoon.Proxify.setupOriginProxyType("XMLHttpRequest",a,b,c)},a.audio=function(){var a=["src","loop","volume","preload"],b=["play","pause","load","canPlayType"],c=["onended","oncanplay","oncanplaythrough","onerror"];Cocoon.Proxify.setupOriginProxyType("Audio",a,b,c)},a.console=function(){if(Cocoon.nativeAvailable){"undefined"==typeof Cocoon.originalConsole&&(Cocoon.originalConsole=window.console);for(var a=["log","error","info","debug","warn"],b={},c=0;c<a.length;c++)b[a[c]]=function(a){return function(a){try{var b="Proxified log: "+JSON.stringify(a);Cocoon.originalConsole.log(b),ext.IDTK_APP.makeCallAsync("forward",b)}catch(c){console.log("Proxified log: "+c)}}}(a[c]);b.assert||(b.assert=function(){if(arguments.length>0&&!arguments[0]){var a="Assertion failed: "+(arguments.length>1?arguments[1]:"");b.error(a)}}),window.console=b}},a.deproxifyConsole=function(){!window.navigator.isCocoonJS&&Cocoon.nativeAvailable&&"undefined"!=typeof Cocoon.originalConsole&&(window.console=Cocoon.originalConsole,Cocoon.originalConsole=void 0)},a}),Cocoon.define("Cocoon.Device",function(a){"use strict";return a.DeviceInfo={os:null,version:null,dpi:null,brand:null,model:null,imei:null,platformId:null,odin:null,openudid:null},a.getDeviceId=function(){return Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("getDeviceId"):void 0},a.getDeviceInfo=function(){return Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("getDeviceInfo"):void 0},a.getOrientation=function(){return Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("getPreferredOrientation"):0},a.setOrientation=function(a){Cocoon.nativeAvailable&&window.ext.IDTK_APP.makeCall("setPreferredOrientation",a)},a.Orientations={PORTRAIT:1,PORTRAIT_UPSIDE_DOWN:2,LANDSCAPE_LEFT:4,LANDSCAPE_RIGHT:8,LANDSCAPE:12,BOTH:15},a.autoLock=function(a){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","setAutoLockEnabled",arguments):void 0},a}),Cocoon.define("Cocoon.Motion",function(a){"use strict";return a.nativeAvailable=Cocoon.nativeAvailable,a.setAccelerometerInterval=function(a){return Cocoon.Motion.nativeAvailable?window.ext.IDTK_APP.makeCall("setAccelerometerUpdateIntervalInSeconds",a):void 0},a.getAccelerometerInterval=function(){return Cocoon.Motion.nativeAvailable?window.ext.IDTK_APP.makeCall("getAccelerometerUpdateIntervalInSeconds"):void 0},a.setGyroscopeInterval=function(a){return Cocoon.Motion.nativeAvailable?window.ext.IDTK_APP.makeCall("setGyroscopeUpdateIntervalInSeconds",a):void 0},a.getGyroscopeInterval=function(){Cocoon.Motion.nativeAvailable&&window.ext.IDTK_APP.makeCall("getGyroscopeUpdateIntervalInSeconds")},a}),Cocoon.define("Cocoon.Touch",function(a){return a.addADivToDisableInput=function(){var a=document.createElement("div");a.id="CocoonJSInputBlockingDiv",a.style.left=0,a.style.top=0,a.style.width="100%",a.style.height="100%",a.style.position="absolute",a.style.backgroundColor="transparent",a.style.border="0px solid #000",a.style.zIndex=999999999,document.body.appendChild(a)},a.removeTheDivToEnableInput=function(){var a=document.getElementById("CocoonJSInputBlockingDiv");a&&document.body.removeChild(a)},a.disable=function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("disableTouchLayer","CocoonJSView"):navigator.isCocoonJS||Cocoon.App.EmulatedWebViewIFrame||(Cocoon.App.forwardEventsToCocoonJSEnabled=!1,Cocoon.App.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.disable();"))},a.enable=function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("enableTouchLayer","CocoonJSView"):navigator.isCocoonJS||Cocoon.App.EmulatedWebViewIFrame||(Cocoon.App.forwardEventsToCocoonJSEnabled=!0,Cocoon.App.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.enable();"))},a.disableInWebView=function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("disableTouchLayer","WebView"):navigator.isCocoonJS||(Cocoon.App.EmulatedWebViewIFrame?Cocoon.App.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.disableInWebView();"):Cocoon.Touch.addADivToDisableInput())},a.enableInWebView=function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("enableTouchLayer","WebView"):navigator.isCocoonJS||(Cocoon.App.EmulatedWebViewIFrame?Cocoon.Touch.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.enableInWebView();"):Cocoon.Touch.removeTheDivToEnableInput())},a}),Cocoon.define("Cocoon.Widget",function(a){"use strict";return a.WebDialog=function(){if(Cocoon.App.nativeAvailable)this.webDialogID=window.ext.IDTK_APP.makeCall("createWebDialog");else{var a=document.createElement("iframe");a.id="CocoonJSWebDialogIFrame",a.name="CocoonJSWebDialogIFrame",a.style.cssText="position:fixed;left:0;top:0;bottom:0;right:0; width:100%; height:100%;margin:0;padding:0;";var b=this;a.onload=function(){b.iframeloaded=!0;var a="Cocoon = {}; Cocoon.Widget = {}; Cocoon.Widget.WebDialog = {} Cocoon.Widget.WebDialog.close = function(){   window.parent.CocoonJSCloseWebDialog();};";b.evalIframe(a);for(var c=0;c<b.pendingEvals.length;++c)b.evalIframe(b.pendingEvals[c]);b.pendingEvals=[]},a.onerror=function(){b.close()},this.iframe=a,this.pendingEvals=[],window.CocoonJSCloseWebDialog=function(){b.close()}}},a.WebDialog.prototype={show:function(a,b){return this.closeCallback=function(){Cocoon.Touch.enable(),b&&b()},Cocoon.App.nativeAvailable?(Cocoon.Touch.disable(),window.ext.IDTK_APP.makeCallAsync("showWebDialog",this.webDialogID,a,this.closeCallback)):(this.iframe.src=a,void document.body.appendChild(this.iframe))},close:function(){return Cocoon.App.nativeAvailable?window.ext.IDTK_APP.makeCallAsync("closeWebDialog",this.webDialogID):(this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe),void(this.closeCallback&&this.closeCallback()))},evalIframe:function(a){window.frames.CocoonJSWebDialogIFrame.eval(a)},eval:function(a){return Cocoon.App.nativeAvailable?window.ext.IDTK_APP.makeCallAsync("evalWebDialog",this.webDialogID,a):void(this.iframeloaded?this.evalIframe(a):this.pendingEvals.push(a))}},a}),Cocoon.define("Cocoon.Camera",function(a){return navigator.getUserMedia_=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,a.CameraType={FRONT:"FRONT",BACK:"BACK"},a.CaptureFormatType={JPEG:"JPEG",RGB_565:"RGB_565",NV21:"NV21",NV16:"NV16",YUY2:"YUY2",YV12:"YV12",BGRA32:"32BGRA"},a.CameraInfo={cameraIndex:0,cameraType:a.CameraType.BACK,supportedVideoSizes:[],supportedVideoFrameRates:[],supportedVideoCaptureImageFormats:[]},a.getNumberOfCameras=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","getNumberOfCameras",arguments):navigator.getUserMedia_?1:0},a.getAllCamerasInfo=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","getAllCamerasInfo",arguments):void 0},a.getCameraInfoByIndex=function(a){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","getCameraInfoByIndex",arguments):void 0},a.getCameraInfoByType=function(a){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","getCameraInfoByType",arguments):void 0},a.start=function(a){if(!Boolean(a.success)||!Boolean(a.error))throw new Error("Missing callbacks for Cocoon.Camera.start();");
if(Cocoon.nativeAvailable){var b={cameraIndex:0,width:50,height:50,frameRate:25},c=Cocoon.clone(b,a),d=Cocoon.callNative("IDTK_SRV_CAMERA","startCapturing",c);Boolean(d)?a.success(d):a.error(!1)}else navigator.getUserMedia_({video:!0,audio:!1},function(b){a.success(b)},function(b){a.error(b)})},a.stop=function(a){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","stopCapturing",arguments):void 0},a.isCapturing=function(a){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","isCapturing",arguments):void 0},a}),Cocoon.define("Cocoon.Ad",function(a){"use strict";a.nativeAvailable=!!Cocoon.nativeAvailable&&!!window.ext.IDTK_SRV_AD,a.BannerLayout={TOP_CENTER:"TOP_CENTER",BOTTOM_CENTER:"BOTTOM_CENTER"},a.Rectangle=function(a,b,c,d){this.x=a,this.y=b,this.width=c,this.height=d},a.Banner=function(a){if("number"!=typeof a)throw"The given ad ID is not a number.";this.id=a;var b=this;this.onBannerShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannershow",function(a,c){b.id===c[0]&&a()}),this.onBannerHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerhide",function(a,c){b.id===c[0]&&a()}),this.onBannerReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerready",function(a,c){b.id===c[0]&&a(c[1],c[2])});var c=new Cocoon.Signal.createSignal;c.register("ready",this.onBannerReady),c.register("shown",this.onBannerShown),c.register("hidden",this.onBannerHidden),this.on=c.expose()},a.Banner.prototype={showBanner:function(){Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","showBanner",[this.id],!0)},hideBanner:function(){Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","hideBanner",[this.id],!0)},load:function(){Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","refreshBanner",[this.id],!0)},getRectangle:function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","getRectangle",[this.id]):void 0},setRectangle:function(a){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","setRectangle",[this.id,a]):void 0},setBannerLayout:function(a){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","setBannerLayout",[this.id,a]):void 0}},a.Interstitial=function(a){if("number"!=typeof a)throw"The given ad ID is not a number.";this.id=a;var b=this;this.onFullScreenShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenshow",function(a,c){b.id===c[0]&&a()}),this.onFullScreenHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenhide",function(a,c){b.id===c[0]&&a()}),this.onFullScreenReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenready",function(a,c){b.id===c[0]&&a()});var c=new Cocoon.Signal.createSignal;c.register("ready",this.onFullScreenReady),c.register("shown",this.onFullScreenShown),c.register("hidden",this.onFullScreenHidden),this.on=c.expose()},a.Interstitial.prototype={showInterstitial:function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","showFullScreen",[this.id],!0):void 0},refreshInterstitial:function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","refreshFullScreen",[this.id],!0):void 0}},a.configure=function(a){return"undefined"==typeof a&&(a={}),Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","requestInitialization",arguments,!0):void 0},a.createBanner=function(b){if("undefined"==typeof b&&(b={}),Cocoon.Ad.nativeAvailable){var c=Cocoon.callNative("IDTK_SRV_AD","createBanner",[b]),d=new a.Banner(c);return d}},a.releaseBanner=function(a){if("undefined"==typeof a)throw"The banner ad object to be released is undefined";Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","releaseBanner",[a.id])},a.createInterstitial=function(a){if("undefined"==typeof a&&(a={}),Cocoon.Ad.nativeAvailable){var b=Cocoon.callNative("IDTK_SRV_AD","createFullscreen",[a]),c=new Cocoon.Ad.Interstitial(b);return c}},a.releaseInterstitial=function(a){if(!a)throw"The fullscreen ad object to be released is undefined";Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","releaseFullscreen",[a.id])},a.showBanner=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","showBanner",arguments,!0):void 0},a.hideBanner=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","hideBanner",arguments,!0):void 0},a.refreshBanner=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","refreshBanner",arguments,!0):void 0},a.showInterstitial=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","showFullScreen",arguments,!0):void 0},a.refreshInterstitial=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","refreshFullScreen",arguments,!0):void 0},a.preloadedBanner=!1,a.loadBanner=function(){return Cocoon.Ad.nativeAvailable?Cocoon.Ad.preloadedBanner?Cocoon.Ad.refreshBanner():(Cocoon.Ad.preloadedBanner=!0,Cocoon.callNative("IDTK_SRV_AD","preloadBanner",arguments,!0)):void 0},a.preloadedInterstitial=!1,a.loadInterstitial=function(){return Cocoon.Ad.nativeAvailable?Cocoon.Ad.preloadedInterstitial?Cocoon.Ad.refreshInterstitial():(Cocoon.Ad.preloadedInterstitial=!0,Cocoon.callNative("IDTK_SRV_AD","preloadFullScreen",arguments,!0)):void 0},a.setRectangle=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","setRectangle",arguments):void 0},a.getRectangle=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","getRectangle",arguments):void 0},a.setBannerLayout=function(a){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","setBannerLayout",arguments):void 0},a.onBannerShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannershow"),a.onBannerHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerhide"),a.onBannerReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerready"),a.onFullScreenShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenshow"),a.onFullScreenHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenhide"),a.onFullScreenReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenready");var b=new Cocoon.Signal.createSignal;b.register("ready",a.onBannerReady),b.register("shown",a.onBannerShown),b.register("hidden",a.onBannerHidden),a.banner={},a.banner.on=b.expose();var b=new Cocoon.Signal.createSignal;return b.register("ready",a.onFullScreenReady),b.register("shown",a.onFullScreenShown),b.register("hidden",a.onFullScreenHidden),a.interstitial={},a.interstitial.on=b.expose(),a}),Cocoon.define("Cocoon.Store",function(a){"use strict";a.nativeAvailable=!!Cocoon.nativeAvailable&&!!window.ext.IDTK_SRV_STORE,a.ProductInfo={productId:"productId",productAlias:"productAlias",productType:"productType",title:"title",description:"description",price:"price",localizedPrice:"localizedPrice",downloadURL:"downloadURL"},a.ProductType={CONSUMABLE:0,NON_CONSUMABLE:1,AUTO_RENEWABLE_SUBSCRIPTION:2,FREE_SUBSCRIPTION:3,NON_RENEWABLE_SUBSCRIPTION:4},a.StoreType={APP_STORE:0,PLAY_STORE:1,MOCK_STORE:2,CHROME_STORE:3,AMAZON_STORE:4,NOOK_STORE:5},a.PurchaseInfo=function(a,b,c,d,e){return this.transactionId=a,this.purchaseTime=b,this.purchaseState=c,this.productId=d,this.quantity=e,this},a.PurchaseState={PURCHASED:0,CANCELED:1,REFUNDED:2,EXPIRED:3},a.getStoreType=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","getStoreType",arguments):!1},a.initialize=function(a){a=a||{};var b={sandbox:!1,managed:!0},c=Cocoon.clone(b,a);Cocoon.Store.requestInitialization({sandbox:c[0],managed:c[1]}),Cocoon.Store.start()},a.requestInitialization=function(a){return"undefined"==typeof a?a={}:(void 0!==a.managed&&(a.remote=a.managed),void 0!==a.sandbox&&(a.debug=a.sandbox)),Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","requestInitialization",arguments,!0):void 0},a.start=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","start",arguments):void 0},a.canPurchase=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","canPurchase",arguments):!1},a.fetchProductsFromServer=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","fetchProductsFromServer",arguments,!0):void 0},a.loadProducts=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","fetchProductsFromStore",arguments,!0):void 0},a.finish=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","finishPurchase",arguments,!0):void 0},a.consume=function(a,b){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","consumePurchase",arguments,!0):void 0},a.purchase=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","purchaseFeature",arguments,!0):void 0},a.puchaseProductModal=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","purchaseFeatureModal",arguments,!0):void 0},a.purchaseProductModalWithPreview=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","purchaseFeatureModalWithPreview",arguments,!0):void 0},a.isProductPurchased=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","isFeaturePurchased",arguments):void 0},a.restore=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","restorePurchases",arguments,!0):void 0},a.restorePurchasesModal=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","restorePurchasesModal",arguments,!0):void 0},a.getProducts=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","getProducts",arguments):void 0},a.addProduct=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","addProduct",arguments):void 0},a.removeProduct=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","removeProduct",arguments):void 0},a.getPurchases=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","getPurchases",arguments):void 0},a.addPurchase=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","addPurchase",arguments):void 0},a.removePurchase=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","removePurchase",arguments):void 0},a.cancelPurchase=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","cancelPurchase",arguments):void 0},a.refundPurchase=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","refundPurchase",arguments):void 0},a.expirePurchase=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","expirePurchase",arguments):void 0},a.onProductsFetchStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductsFetchStarted"),a.onProductsFetchCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductsFetchCompleted"),a.onProductsFetchFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductsFetchFailed"),a.onProductPurchaseStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseStarted"),a.onProductPurchaseVerificationRequestReceived=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseVerificationRequestReceived"),a.onProductPurchaseCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseCompleted"),a.onProductPurchaseFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseFailed"),a.onRestorePurchasesStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onRestorePurchasesStarted"),a.onRestorePurchasesCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onRestorePurchasesCompleted"),a.onRestorePurchasesFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onRestorePurchasesFailed"),a.onConsumePurchaseStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onConsumePurchaseStarted"),a.onConsumePurchaseCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onConsumePurchaseCompleted"),a.onConsumePurchaseFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onConsumePurchaseFailed");var b=new Cocoon.Signal.createSignal;return b.register("load",{started:a.onProductsFetchStarted,success:a.onProductsFetchCompleted,error:a.onProductsFetchFailed}),b.register("purchase",{started:a.onProductPurchaseStarted,success:a.onProductPurchaseCompleted,verification:a.onProductPurchaseVerificationRequestReceived,error:a.onProductPurchaseFailed}),b.register("consume",{started:a.onConsumePurchaseStarted,success:a.onConsumePurchaseCompleted,error:a.onConsumePurchaseFailed}),b.register("restore",{started:a.onRestorePurchasesStarted,success:a.onRestorePurchasesCompleted,error:a.onRestorePurchasesFailed}),a.on=b.expose(),a}),Cocoon.define("Cocoon.Notification",function(a){a.nativeAvailable=!!window.ext&&!!window.ext.IDTK_SRV_NOTIFICATION,a.Local={},a.Push={},a.Local.create=function(a){var b={message:"",soundEnabled:!0,badgeNumber:0,userData:{},contentBody:"",contentTitle:"",date:(new Date).valueOf()+1e3},c=Cocoon.clone(b,a);return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","createLocalNotification",c):void 0},a.Push.create=function(a){var b={message:"",soundEnabled:!0,badgeNumber:0,userData:{},channels:[],expirationTime:0,expirationTimeInterval:0};for(var c in b)a[c]||(a[c]=b[c]);return a},a.start=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","start",arguments):void 0},a.Push.register=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","registerForPushNotifications",arguments,!0):void 0},a.Push.unregister=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","unregisterForPushNotifications",arguments,!0):void 0},a.Local.cancel=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","cancelLocalNotification",arguments):void 0},a.Local.cancelLast=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","cancelLocalNotification",arguments,!0):void 0},a.Local.cancelAllNotifications=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","cancelAllLocalNotifications",arguments):void 0},a.Local.send=function(a){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","sendLocalNotification",arguments,!0):void 0},a.subscribe=function(a){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","subscribe",arguments,!0):void 0},a.unsubscribe=function(a){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","unsubscribe",arguments,!0):void 0},a.Push.send=function(a){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","sendPushNotification",arguments,!0):void 0},a.setBadgeNumber=function(a){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","setBadgeNumber",arguments):void 0},a.getBadgeNumber=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","getBadgeNumber",arguments):void 0},a.Local.getLastNotificationData=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","getLastReceivedLocalNotificationData",arguments):void 0},a.Push.getLastNotificationData=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","getLastReceivedPushNotificationData",arguments):void 0},a.onRegisterForPushNotificationsSucceed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationServiceRegistered"),a.onUnregisterForPushNotificationsSucceed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationServiceUnregistered"),a.onRegisterForPushNotificationsFailed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationServiceFailedToRegister"),a.onPushNotificationReceived=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationReceived"),a.onLocalNotificationReceived=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","localNotificationReceived"),a.onPushNotificationDeliverySucceed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationSuccessfullyDelivered"),a.onPushNotificationDeliveryFailed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationDeliveryError");var b=new Cocoon.Signal.createSignal;b.register("notification",{received:a.onLocalNotificationReceived}),a.Local.on=b.expose();var b=new Cocoon.Signal.createSignal;return b.register("register",{success:a.onRegisterForPushNotificationsSucceed,unregister:a.onUnregisterForPushNotificationsSucceed,error:a.onRegisterForPushNotificationsFailed}),b.register("notification",{received:a.onPushNotificationReceived}),b.register("deliver",{success:a.onPushNotificationDeliverySucceed,error:a.onPushNotificationDeliveryFailed}),a.Push.on=b.expose(),a}),Cocoon.define("Cocoon.Social",function(a){return a.Interface=function(){this.onLoginStatusChanged=new Cocoon.EventHandler("","dummy","onLoginStatusChanged");var a=new Cocoon.Signal.createSignal;return a.register("loginStatusChanged",this.onLoginStatusChanged),this.on=a.expose(),this},a.Interface.prototype={isLoggedIn:function(){return!1},login:function(a){a&&a(!1,{message:"Not implemented!"})},logout:function(a){a&&a({message:"Not implemented!"})},getLoggedInUser:function(){return null},hasPublishPermissions:function(a){a(!0)},requestPublishPermissions:function(a){a&&a(!0,null)},requestUser:function(a,b){a(null,{message:"Not implemented!"})},requestUserImage:function(a,b,c){a("",{message:"Not implemented!"})},requestFriends:function(a,b){a([],{message:"Not implemented!"})},publishMessage:function(a,b){b({message:"Not implemented!"})},publishMessageWithDialog:function(a,b){b({message:"Not implemented!"})}},a.SocialGamingService=function(){return Cocoon.Social.SocialGamingService.superclass.constructor.call(this),this},a.SocialGamingService.prototype={_cachedAchievements:null,_achievementsMap:null,_leaderboardsTemplate:null,_achievementsTemplate:null,requestScore:function(a,b){a(null,{message:"Not implemented!"})},submitScore:function(a,b,c){b&&b({message:"Not implemented!"})},showLeaderboard:function(a,b){a&&a({message:"Not implemented!"})},requestAllAchievements:function(a){a([],{message:"Not implemented!"})},requestAchievements:function(a,b){a([],{message:"Not implemented!"})},submitAchievement:function(a,b){b&&b({message:"Not implemented!"})},resetAchievements:function(a){a&&a([],{message:"Not implemented!"})},showAchievements:function(a){if(!this._achievementsTemplate)throw"Please, provide a html template for achievements with the setTemplates method";var b=new Cocoon.Widget.WebDialog,c=!1;b.show(this._achievementsTemplate,function(d){b.closed=!0,!c&&a&&a(d)});var d=this;this.requestAchievements(function(e,f){if(!b.closed){if(f)return c=!0,void(a&&a(f));var g=[];if(d._cachedAchievements)for(var h=0;h<d._cachedAchievements.length;++h){var i=d._cachedAchievements[h];if(g.push(i),e&&e.length)for(var j=0;j<e.length;++j)if(e[j].achievementID===i.achievementID){i.achieved=!0;break}}var k="addAchievements("+JSON.stringify(g)+");";b.eval(k)}})},setAchievementsMap:function(a){this._achievementsMap=a,this._cachedAchievements&&this.syncAchievementsMap(this._cachedAchievements)},setTemplates:function(a,b){this._leaderboardsTemplate=a,this._achievementsTemplate=b},setCachedAchievements:function(a){this._cachedAchievements=a,a&&this._achievementsMap&&this.syncAchievementsMap(this._cachedAchievements)},findAchievement:function(a){if(!this._cachedAchievements)return null;for(var b=0;b<this._cachedAchievements.length;++b)if(a===this._cachedAchievements[b].achievementID)return this._cachedAchievements[b];return null},translateAchievementID:function(a){if(this._achievementsMap)for(var b in this._achievementsMap)if(b==a)return this._achievementsMap[b];return a},syncAchievementsMap:function(a){if(this._achievementsMap)for(var b=0;b<a.length;++b)for(var c in this._achievementsMap)this._achievementsMap[c]===a[b].achievementID&&(a[b].customID=c)}},Cocoon.extend(a.SocialGamingService,a.Interface),a.ImageSize={THUMB:"thumb",SMALL:"small",MEDIUM:"medium",LARGE:"large"},a.User=function(a,b,c){return this.userID=a,this.userName=b,this.userImage=c,this},a.Message=function(a,b,c,d,e){return this.message=a,this.mediaURL=b,this.linkURL=c,this.linkText=d,this.linkCaption=e,this},a.Score=function(a,b,c,d,e){return this.userID=a,this.score=b||0,this.userName=c,this.imageURL=d,this.leaderboardID=e,this},a.ScoreParams=function(a,b,c,d){this.userID=a,this.leaderboardID=b,this.friends=!!c,this.timeScope=d||2},a.TimeScope={ALL_TIME:0,WEEK:1,TODAY:2},a.Achievement=function(a,b,c,d,e){return this.achievementID=a,this.customID=a,this.title=b,this.description=c,this.imageURL=d,this.points=e||0,this},a.share=function(a){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","share",arguments,!0):void 0},a}),Cocoon.define("Cocoon.Social",function(a){return a.ManagerService=function(){this.services=[]},a.ManagerService.prototype={services:null,registerSocialService:function(a){this.services.push(a)},submitAchievement:function(a){for(var b=0;b<this.services.length;++b){var c=this.services[b];!c.readOnlyHint&&c.isLoggedIn()&&c.submitAchievement(a,function(a){a&&console.error("Error submitting achievement: "+a.message)})}},submitScore:function(a,b){for(var c=0;c<this.services.length;++c){var d=this.services[c];!d.readOnlyHint&&d.isLoggedIn()&&d.submitScore(a,function(a){a&&console.error("Error submitting score: "+a.message)},b)}},getLoggedInServices:function(){for(var a=[],b=0;b<this.services.length;++b){var c=this.services[b];!c.fakeSocialService&&c.isLoggedIn()&&a.push(c)}return a},isLoggedInAnySocialService:function(){return this.getLoggedInServices().length>0}},a.Manager=new a.ManagerService,a}),Cocoon.define("Cocoon.Social",function(a){return a.LocalStorageService=function(){Cocoon.Social.LocalStorageService.superclass.constructor.call(this),this.fakeSocialService=!0},a.LocalStorageService.prototype={loggedIn:!1,keys:{score:"Cocoon.Social.LocalStorageService.score",earnedAchievements:"Cocoon.Social.LocalStorageService.earned"},isLoggedIn:function(){return this.loggedIn},login:function(a){this.loggedIn||this.onLoginStatusChanged.notifyEventListeners(!0),this.loggedIn=!0,a&&setTimeout(function(){a(!0)},0)},logout:function(a){this.loggedIn&&this.onLoginStatusChanged.notifyEventListeners(!0),this.loggedIn=!1,a&&setTimeout(function(){a()},0)},getLoggedInUser:function(){return new Cocoon.Social.User("me","LocalStorage")},requestUser:function(a,b){var c=new Cocoon.Social.User(b||"me","LocalStorage");a&&setTimeout(function(){a(c)},0)},requestScore:function(a,b){var c=localStorage.getItem(this.keys.score),d=parseInt(c)||0;setTimeout(function(){a(new Cocoon.Social.Score("me",d))},0)},submitScore:function(a,b,c){var d=localStorage.getItem(this.keys.score),e=parseInt(d)||0;a>e&&localStorage.setItem(this.keys.score,a),b&&setTimeout(function(){b()},0)},getLocalStorageEarnedAchievements:function(){var a=localStorage.getItem(this.keys.earnedAchievements),b=[];if(a){var c=JSON.stringify(a);c&&c.length&&(b=c)}return b},requestAchievements:function(a,b){var c=this.getLocalStorageEarnedAchievements();setTimeout(function(){a(c)},0)},submitAchievement:function(a,b){if(null===a||"undefined"==typeof a)throw"No achievementID specified";for(var c=this.getLocalStorageEarnedAchievements(),d=!1,e=0;e<c.length;++e)if(c[e]===a){d=!0;break}d||(c.push(a),localStorage.setItem(this.keys.earnedAchievements,JSON.stringify(c))),b&&setTimeout(function(){b()},0)},resetAchievements:function(a){localStorage.removeItem(this.keys.earnedAchievements),a&&setTimeout(function(){a()},0)}},Cocoon.extend(a.LocalStorageService,a.SocialGamingService),a.LocalStorage=new a.LocalStorageService,a}),Cocoon.define("Cocoon.Social",function(a){function b(a,b){return{access_token:a.access_token,state:a.state,error:b,expires_in:a.expirationDate?a.expirationDate-Date.now():0,player_id:a.playerId}}function c(a){return new Cocoon.Social.User(a.playerId,a.displayName,a.avatarImageUrl)}function d(a){var b=a.image?a.image.url:"";return b=b.replace(/sz=\d+/g,"sz=100"),new Cocoon.Social.User(a.id,a.displayName,b)}function e(a){return a===Cocoon.Social.ImageSize.THUMB?100:a===Cocoon.Social.ImageSize.MEDIUM?200:a===Cocoon.Social.ImageSize.LARGE?512:void 0}function f(a){var b=new Cocoon.Social.Achievement(a.id,a.name,a.description,a.revealedIconUrl,0);return b.gpAchievementData=a,b}function g(a,b){return new Cocoon.Social.Score(a.player.playerId,a.scoreValue,a.player.displayName,a.player.avatarImageUrl,b)}return a.GooglePlayGamesExtension=function(){this.nativeExtensionName="IDTK_SRV_GOOGLE_PLAY_GAMES",this.extensionName="Social.GooglePlayGames",this.nativeAvailable=Cocoon.nativeAvailable&&"undefined"!=typeof window.ext[this.nativeExtensionName],this.auth=new Cocoon.Social.GooglePlayGamesAuthExtension(this),this.client=new Cocoon.Social.GooglePlayGamesClientExtension(this),this.defaultScopes=["https://www.googleapis.com/auth/games","https://www.googleapis.com/auth/plus.login"],this.gamesAPI="/games/v1",this.plusAPI="/plus/v1",this.onSessionChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onSessionChanged"),Cocoon.Social.GooglePlayGames=this;var a=this;return this.onSessionChanged.addEventListener(function(c,d){a.token=b(c,d),c&&c.access_token&&a.client.request({path:a.gamesAPI+"/players/me",callback:function(b){a.currentPlayer=b}})}),this},a.GooglePlayGamesExtension.prototype={token:null,settings:{},socialService:null,currentPlayer:null,initialized:!1,auth:null,client:null,init:function(a){if(!a||"object"!=typeof a)throw"Invalid params argument";if(this.settings=a,this.initialized=!0,this.nativeAvailable)Cocoon.callNative(this.nativeExtensionName,"init",[this.settings.clientId],!0);else{var b=this,c=function(){gapi.auth.authorize({immediate:!0,scope:b.defaultScopes,client_id:b.settings.clientId},function(a){b.token=a,a&&a.access_token&&b.onSessionChanged.notifyEventListeners(a)})};if(window.gapi)c();else{window.onGapiLoadCallback=function(){window.setTimeout(c,1)};var d=document.createElement("script");d.src="https://apis.google.com/js/client.js?onload=onGapiLoadCallback",document.getElementsByTagName("head")[0].appendChild(d)}}},getSocialInterface:function(){if(!this.initialized)throw"You must call init() before getting the Social Interface";return this.socialService||(this.socialService=new Cocoon.Social.SocialGamingServiceGooglePlayGames(this)),this.socialService},getMultiplayerInterface:function(){return Cocoon.Multiplayer.GooglePlayGames},share:function(){return window.open(this.href,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600"),!1}},a.GooglePlayGamesAuthExtension=function(a){return this.extension=a,this},a.GooglePlayGamesAuthExtension.prototype={authorize:function(a,c){var d=this;this.extension.nativeAvailable?Cocoon.callNative(this.extension.nativeExtensionName,"authorize",[a,function(a,e){d.extension.token=b(a,e),c&&c(d.extension.token)}],!0):gapi.auth.authorize(a,function(a){d.extension.token=a,d.extension.onSessionChanged.notifyEventListeners(a,a?a.error:null),c&&c(a)})},disconnect:function(a){this.extension.nativeAvailable?Cocoon.callNative(this.extension.nativeExtensionName,"disconnect",[a],!0):a&&a({error:"Not implemented yet"})},init:function(a){this.extension.nativeAvailable?a():gapi.auth.init(a)},getToken:function(){return this.extension.nativeAvailable?this.extension.token:gapi.auth.getToken()},setToken:function(a){this.extension.nativeAvailable?this.extension.token=a:gapi.auth.setToken(a)}},a.GooglePlayGamesClientExtension=function(a){return this.extension=a,this},a.GooglePlayGamesClientExtension.prototype={setApiKey:function(a){this.extension.nativeAvailable?Cocoon.callNative(this.extension.nativeExtensionName,"setApiKey",[a],!0):gapi.client.setApiKey(a)},request:function(a){if(this.extension.nativeAvailable){if(a.callback)return Cocoon.callNative(this.extension.nativeExtensionName,"request",[a,function(b,c){var d=b;c&&(d=b||{},d.error=c),a.callback(d)}],!0),null;var b=this,c={execute:function(c){Cocoon.callNative(b.extension.nativeExtensionName,"request",[a,function(a,b){var d=a;b&&(d=a||{},d.error=b),c(d)}],!0)}};return c}return gapi.client.request(a)}},a.GooglePlayGames=new Cocoon.Social.GooglePlayGamesExtension,a.SocialGamingServiceGooglePlayGames=function(a){Cocoon.Social.SocialGamingServiceGooglePlayGames.superclass.constructor.call(this),this.gapi=a;var b=this;return this.gapi.onSessionChanged.addEventListener(function(a){var c=a||{};b.onLoginStatusChanged.notifyEventListeners(!!c.access_token,c.error)}),this},a.SocialGamingServiceGooglePlayGames.prototype={isLoggedIn:function(){return this.gapi.token&&this.gapi.token.access_token?!0:!1},login:function(a){var b=this;this.gapi.auth.authorize({client_id:this.gapi.settings.clientId,scope:this.gapi.defaultScopes},function(c){a&&a(b.isLoggedIn(),c.error)})},logout:function(a){this.gapi.auth.disconnect(a)},getLoggedInUser:function(){return this.gapi.currentPlayer?fromGPUserToCocoonUser(this.gapi.currentPlayer):null},requestUser:function(a,b){var d=b||"me";this.gapi.client.request({path:this.gapi.gamesAPI+"/players/"+d,callback:function(b){var d=b&&!b.error?c(b):null;a(d,b.error)}})},requestUserImage:function(a,b,c){this.requestUser(function(b,d){if(b&&b.userImage){var f=e(c||Cocoon.Social.ImageSize.MEDIUM);-1===b.userImage.indexOf("sz=")?b.userImage+="?sz="+f:b.userImage=b.userImage.replace(/sz=\d+/g,"sz="+f)}a(b?b.userImage:null,d)},b)},requestFriends:function(a,b){var c={orderBy:"best"},e=b||"me";this.gapi.client.request({path:this.gapi.plusAPI+"/people/"+e+"/people/visible",params:c,callback:function(b){if(b&&!b.error){for(var c=[],e=0;e<b.items.length;++e)c.push(d(b.items[e]));a(c)}else a([],b?b.error:null)}})},publishMessage:function(a,b){b&&b("Not supported... use publishMessageWithDialog method instead")},publishMessageWithDialog:function(a,b){if(this.gapi.nativeAvailable){var c={prefilledText:a.message,mediaUrl:a.mediaURL,mediaTitle:a.linkCaption,mediaDescription:a.linkText,url:a.linkURL};Cocoon.callNative(this.gapi.nativeExtensionName,"shareMessage",[c,b],!0)}else{var d=this,e=function(){var b={contenturl:"https://plus.google.com/pages/",contentdeeplinkid:"/pages",clientid:d.gapi.settings.clientId,cookiepolicy:"single_host_origin",prefilltext:a.message,calltoactionlabel:"CREATE",calltoactionurl:"http://plus.google.com/pages/create",calltoactiondeeplinkid:"/pages/create"};gapi.interactivepost.render("sharePost",b)};if(gapi.interactivepost)e();else{var f=document.createElement("script");f.type="text/javascript",f.async=!0,f.src="https://apis.google.com/js/plusone.js",f.onload=function(){e()},document.getElementsByTagName("head")[0].appendChild(f)}}},requestScore:function(a,b){b=b||{};var c=b.userID||"me",d=b.leaderboardID||this.gapi.settings.defaultLeaderboard;if(!d)throw"leaderboardID not provided in the params. You can also set the default leaderboard in the init method";this.gapi.client.request({path:this.gapi.gamesAPI+"/players/"+c+"/leaderboards/"+d+"/scores/ALL_TIME",callback:function(b){if(b&&b.error)a(null,b.error);else if(b&&b.items&&b.items.length>0){var d=b.items[0],e=new Cocoon.Social.Score(c,d.scoreValue,"","",d.leaderboard_id);a(e,null)}else a(null,null)}})},submitScore:function(a,b,c){c=c||{};var d=c.leaderboardID||this.gapi.settings.defaultLeaderboard;if(!d)throw"leaderboardID not provided in the params. You can also set the default leaderboard in the init method";this.gapi.client.request({path:this.gapi.gamesAPI+"/leaderboards/"+d+"/scores",method:"POST",params:{score:a},callback:function(a){b&&b(a?a.error:null)}})},showLeaderboard:function(a,b){b=b||{};var c=b.leaderboardID||this.gapi.settings.defaultLeaderboard;if(!c)throw"leaderboardID not provided in the params. You can also set the default leaderboard in the init method";
var d=/(iPad|iPhone|iPod)/gi.test(navigator.userAgent);if(!d&&this.gapi.nativeAvailable){var e=b.timeScope||0;Cocoon.callNative(this.gapi.nativeExtensionName,"showLeaderboard",[c,e,a],!0)}else{if(!this._leaderboardsTemplate)throw"Please, provide a html template for leaderboards with the setTemplates method";var f=new Cocoon.Widget.WebDialog,h=!1;f.show(this._leaderboardsTemplate,function(b){f.closed=!0,!h&&a&&a(b)});var i=b.friends?"SOCIAL":"PUBLIC",j="ALL_TIME";b.timeScope===Cocoon.Social.TimeScope.WEEK?j="WEEKLY":b.timeScope===Cocoon.Social.TimeScope.TODAY&&(j="DAILY"),this.gapi.client.request({path:this.gapi.gamesAPI+"/leaderboards/"+c+"/window/"+i,method:"GET",params:{timeSpan:j},callback:function(b){if(!f.closed){if(b.error)return void(a&&(h=!0,a(b.error),f.close()));var d=[],e=[];b&&b.items&&(e=b.items.slice(0)),b&&b.playerScore&&e.push(b.playerScore);for(var i=0;i<e.length;++i){var j=e[i],k=g(j,c);k.imageURL+="?sz=50",k.position=j.scoreRank||i+1,k.me=!1,d.push(k)}var l="addScores("+JSON.stringify(d)+")";f.eval(l)}}})}},prepareAchievements:function(a,b){if(!this._cachedAchievements||a){var c=this;this.gapi.client.request({path:this.gapi.gamesAPI+"/achievements",callback:function(a){if(a&&!a.error){var d=[];if(a&&a.items)for(var e=0;e<a.items.length;e++)d.push(f(a.items[e]));c.setCachedAchievements(d),b(d,null)}else b([],a?a.error:null)}})}else b(this._cachedAchievements,null)},requestAllAchievements:function(a){this.prepareAchievements(!0,a)},requestAchievements:function(a,b){var c=this;this.prepareAchievements(!1,function(d,e){if(e)return void a([],e);var f=b||"me";c.gapi.client.request({path:c.gapi.gamesAPI+"/players/"+f+"/achievements",params:{state:"UNLOCKED"},callback:function(b){if(b&&!b.error){var d=[];if(b.items)for(var e=0;e<b.items.length;e++){var f=c.findAchievement(b.items[e].id);f&&d.push(f)}a(d,null)}else a([],b?b.error:null)}})})},submitAchievement:function(a,b){if(null===a||"undefined"==typeof a)throw"No achievementID specified";var c=this.translateAchievementID(a);if(this.gapi.nativeAvailable){var d=!!this.gapi.settings.showAchievementNotifications;Cocoon.callNative(this.gapi.nativeExtensionName,"unlockAchievement",[c,d,b],!0)}else this.gapi.client.request({path:this.gapi.gamesAPI+"/achievements/"+c+"/unlock",method:"POST",callback:function(a){b&&b(a?a.error:null)}})},resetAchievements:function(a){this.gapi.client.request({path:"/games/v1management/achievements/reset",method:"POST",callback:function(b){a&&a(b?b.error:null)}})},showAchievements:function(a){var b=/(iPad|iPhone|iPod)/gi.test(navigator.userAgent);!b&&this.gapi.nativeAvailable?Cocoon.callNative(this.gapi.nativeExtensionName,"showAchievements",[a],!0):Cocoon.Social.SocialGamingServiceGooglePlayGames.superclass.showAchievements.call(this)}},Cocoon.extend(Cocoon.Social.SocialGamingServiceGooglePlayGames,Cocoon.Social.SocialGamingService),a}),Cocoon.define("Cocoon.Social",function(a){function b(a){return new Cocoon.Social.User(a.playerID,a.alias)}function c(a){return new Cocoon.Social.GameCenter.Achievement(a.identifier,a.title,a.achievedDescription,"",a.maximumPoints)}return a.GameCenterExtension=function(){this.nativeExtensionName="IDTK_SRV_GAMECENTER",this.extensionName="Social.GameCenter",this.nativeAvailable=!!window.ext&&!!window.ext[this.nativeExtensionName];var a=this;return this.nativeAvailable&&(this.onGameCenterLoginStateChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onGameCenterLoginStateChanged"),this.onGameCenterLoginStateChanged.addEventListener(function(b,c){a._currentPlayer=b})),this},a.GameCenterExtension.prototype={_currentPlayer:null,getSocialInterface:function(){return this._socialService||(this._socialService=new Cocoon.Social.SocialGamingServiceGameCenter(this)),this._socialService},getMultiplayerInterface:function(){return Cocoon.Multiplayer.GameCenter},isLoggedIn:function(){return this._currentPlayer&&this._currentPlayer.isAuthenticated},login:function(a){var b=this;if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"login",[function(c,d){b._currentPlayer=c,a&&a(c,d)}],!0)},getLocalPlayer:function(){if(this._currentPlayer)return this._currentPlayer;if(this.nativeAvailable)return this._currentPlayer=Cocoon.callNative(this.nativeExtensionName,"getLocalPlayer",[]),this._currentPlayer;throw"Game Center not available"},loadPlayers:function(a,b){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadPlayers",[a,b],!0)},loadFriends:function(a){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadFriends",[a],!0)},loadAchievements:function(a){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadAchievements",[a],!0)},loadAchievementDescriptions:function(a){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadAchievementDescriptions",[a],!0)},loadScores:function(a,b){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadScores",[b,a],!0)},submitScore:function(a,b){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"submitScore",[a,b],!0)},submitAchievements:function(a,b){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"submitAchievements",[a,b],!0)},resetAchievements:function(a){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"resetAchievements",[a],!0)},showAchievements:function(a){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"showAchievements",[a],!0)},showLeaderboards:function(a,b){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"showLeaderboards",[b,a],!0)}},a.GameCenter=new a.GameCenterExtension,a.GameCenter.Player=function(){this.playerID="",this.alias="",this.isFriend=!1},a.GameCenter.LocalPlayer=function(){this.playerID="",this.alias="",this.isAuthenticated=!1},a.GameCenter.Achievement=function(a,b){this.identifier=a,this.percentComplete=b,this.lastReportedDate=0},a.GameCenter.AchievementDescription=function(){this.identifier="",this.title="",this.achievedDescription="",this.unachievedDescription="",this.maximumPoints=0},a.GameCenter.Score=function(a,b,c,d,e,f){return this.userID=a,this.score=b||0,this.userName=c,this.imageURL=d,this.leaderboardID=e,this.rank=f.rank,this.originalScoreObject=f,this},a.GameCenter.Leaderboard=function(a,b,c,d,e,f){this.category=a,this.playerIDs=b,this.timeScope=c,this.playerScope=d,this.rangeStart=e,this.rangeLength=f,this.scores=[],this.localPlayerScore=[],this.localizedTitle=localizedTitle},a.GameCenter.TimeScope={TODAY:0,WEEK:1,ALL_TIME:2},a.GameCenter.PlayerScope={GLOBAL:0,FRIENDS:1},a.SocialGamingServiceGameCenter=function(a){Cocoon.Social.SocialGamingServiceGameCenter.superclass.constructor.call(this),this.gc=a;var b=this;return this.gc.onGameCenterLoginStateChanged.addEventListener(function(a,c){b.onLoginStatusChanged.notifyEventListeners(a.isAuthenticated,c)}),this},a.SocialGamingServiceGameCenter.prototype={_cachedAchievements:null,isLoggedIn:function(){return this.gc.isLoggedIn()},login:function(a){this.gc.login(function(b,c){a&&a(b.isAuthenticated,c)})},logout:function(a){a&&a({message:"User has to logout from the Game Center APP"})},getLoggedInUser:function(){return b(this.gc._currentPlayer?this.gc._currentPlayer:this.gc.getLocalPlayer())},requestUser:function(a,c){if(c)this.gc.loadPlayers([c],function(c,d){var e=c&&c.length?b(c[0]):null;a(e,d)});else{var d=this;setTimeout(function(){a(d.getLoggedInUser())})}},requestFriends:function(a,c){this.gc.loadFriends(function(c,d){var e=[];if(c&&c.length)for(var f=0;f<c.length;++f)e.push(b(c[f]));a(e,d)})},requestScore:function(a,b){var c={},d=b||{};d.leaderboardID&&(c.category=d.leaderboardID),c.playerIDs=[d.userID||this.getLoggedInUser().userID],this.gc.loadScores(function(b,c){var e=null;d.userID&&b&&b.scores&&b.scores.length?e=b.scores[0]:b&&b.localPlayerScore&&(e=b.localPlayerScore);var f=e?new Cocoon.Social.GameCenter.Score(e.playerID,e.value,"","",e.category,e):null;a(f,c)},c)},submitScore:function(a,b,c){var d=c||{};this.gc.submitScore({value:a,category:d.leaderboardID||""},function(a){b&&b(a)})},showLeaderboard:function(a,b){var c=b||{};this.gc.showLeaderboards(function(b){a&&a(b)},{category:c.leaderboardID||""})},prepareAchievements:function(a,b){if(!this._cachedAchievements||a){var d=this;this.gc.loadAchievementDescriptions(function(a,e){if(e)b([],e);else{var f=[];if(a&&a.length)for(var g=0;g<a.length;g++)f.push(c(a[g]));d.setCachedAchievements(f),b(f,null)}})}else b(this._cachedAchievements,null)},requestAllAchievements:function(a){this.prepareAchievements(!0,a)},requestAchievements:function(a,b){var c=this;this.prepareAchievements(!1,function(b,d){return d?void a([],d):void c.gc.loadAchievements(function(b,d){if(d)a([],b.error);else{var e=[];if(b&&b.length)for(var f=0;f<b.length;f++){var g=c.findAchievement(b[f].identifier);g&&e.push(g)}a(e,null)}})})},submitAchievement:function(a,b){if(null===a||"undefined"==typeof a)throw"No achievementID specified";var c=this.translateAchievementID(a);this.gc.submitAchievements([{identifier:c,percentComplete:100}],b)},resetAchievements:function(a){this.gc.resetAchievements(a)},showAchievements:function(a){this.gc.showAchievements(function(b){a&&a(b)})}},Cocoon.extend(a.SocialGamingServiceGameCenter,a.SocialGamingService),a}),Cocoon.define("Cocoon.Social",function(a){function b(a){return 0===a?"connected":1===a?"not_authorized":"unknown"}function c(a,c){var d=null;return 0===a.state&&(d={accessToken:a.accessToken,expirationDate:a.expirationDate,userID:a.user?a.userID:null,permissions:a.permissions,user:a.user}),{status:b(a.state),authResponse:d,error:c}}function d(a){return new Cocoon.Social.User(a.id,a.username?a.username:a.first_name+" "+a.last_name)}function e(a){return{link:a.linkURL,description:a.message,name:a.linkText,caption:a.linkCaption,picture:a.mediaURL}}function f(a,b){var c=new Cocoon.Social.Score(a.user.id,a.score,a.user.name);return b&&(c.leaderboardID=b.leaderboardID),c.imageURL="https://graph.facebook.com/"+a.user.id+"/picture",c}function g(a){var b=new Cocoon.Social.Achievement(a.id,a.title,a.description,a.image[0].url,a.data.points);return b.fbAchievementData=a,b}if(a.FacebookExtension=function(){this.nativeExtensionName="IDTK_SRV_FACEBOOK",this.extensionName="Social.Facebook",this.nativeAvailable=!!window.ext&&!!window.ext[this.nativeExtensionName],this.Event=new Cocoon.Social.FacebookEvent(this.nativeAvailable);var a=this;return this.nativeAvailable&&(this.onFacebookSessionStateChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onFacebookSessionStateChanged"),Cocoon.Social.Facebook=this,this.onFacebookSessionStateChanged.addEventListener(function(b,d){var e=c(b,d);0==b.state&&a.Event.notify("auth.login",e),a.Event.notify("auth.authResponseChange",e),a.Event.notify("auth.statusChange",e)})),this},a.FacebookExtension.prototype={_currentSession:null,_appId:null,_socialService:null,init:function(a){if(!a||!a.appId)throw"appId must be specified!";this._appId=a.appId,this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"init",[a],!0):FB.init(a);var b=this;this.Event.subscribe("auth.authResponseChange",function(a){b._currentSession=a,a.authResponse&&!a.authResponse.user&&b.api("me?fields=username",function(a){b._currentSession.authResponse.user=a})})},getSocialInterface:function(){if(!this._appId)throw"You must call init() before getting the Social Interface";return this._socialService||(this._socialService=new Cocoon.Social.SocialGamingServiceFacebook(this)),this._socialService},login:function(a,b){var d=this;this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"login",[b,function(b,e){d._currentSession=c(b,e),a&&a(d._currentSession)}],!0):FB.login(function(b){d._currentSession=b,a&&a(b)},b)},logout:function(a){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"logout",[function(b,d){a&&a(c(b,d))}],!0):FB.logout(function(b){a&&a(b)})},getAuthResponse:function(){if(this.nativeAvailable){var a=Cocoon.callNative(this.nativeExtensionName,"getFacebookSession",[]);return c(a)}return FB.getAuthResponse()},getLoginStatus:function(a,b){if(this.nativeAvailable){var d=this;setTimeout(function(){var b=Cocoon.callNative(d.nativeExtensionName,"getFacebookSession",[]);a&&a(c(b))},50)}else FB.getLoginStatus(a,b)},api:function(a,b,c,d){if(this.nativeAvailable){var e=arguments[0],f=arguments.length>3?arguments[1]:"GET",g=null;3==arguments.length&&(g=arguments[1]),4==arguments.length&&(g=arguments[2]);var h=arguments.length>1?arguments[arguments.length-1]:function(){};return Cocoon.callNative(this.nativeExtensionName,"api",[e,f,g,h],!0)}FB.api(a,b,c,d)},ui:function(a,b){if(this.nativeAvailable){var a=arguments[0],c=arguments.length>1?arguments[1]:function(){};return Cocoon.callNative(this.nativeExtensionName,"ui",[a,c],!0)}navigator.isCocoonJS||FB.ui(a,b)},requestAdditionalPermissions:function(a,b,d){if(this.nativeAvailable){var e=b.split(",");Cocoon.callNative(this.nativeExtensionName,"requestAdditionalPermissions",[a,e,function(a,b){d&&d(c(a,b))}],!0)}else FB.login(d,{scope:b})},getPermissions:function(a){this.api("me/permissions",function(b){a(b.data&&b.data[0]?b.data[0]:{})})},showShareDialog:function(a,b){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"showShareDialog",[a,b],!0):(a.method="feed",FB.ui(a,b))},uploadPhoto:function(a,b){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"uploadPhoto",[a,b],!0):b({error:{message:"Not implemented"}})},showFriendPicker:function(a){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"showFriendPicker",[a],!0):a({error:{message:"Not implemented"}})}},a.FacebookEvent=function(a){return this.nativeAvailable=a,this},a.FacebookEvent.prototype={subscribe:function(a,b){if(this.nativeAvailable){var c=a+"listeners";this[c]=this[c]||[],this[c].push(b)}else navigator.isCocoonJS||FB.Event.subscribe(a,b)},unsubscribe:function(a,b){if(this.nativeAvailable){var c=a+"listeners",d=this[c];if(d){var e=d.indexOf(b);-1!==e&&d.splice(e,1)}}else navigator.isCocoonJS||FB.Event.unsubscribe(a,b)},notify:function(a,b){var c=a+"listeners",d=this[c];if(d)for(var e=0;e<d.length;++e)d[e](b)}},a.Facebook=new a.FacebookExtension,a.SocialGamingServiceFacebook=function(a){Cocoon.Social.SocialGamingServiceFacebook.superclass.constructor.call(this),this.fb=a;var b=this;return this.fb.Event.subscribe("auth.authResponseChange",function(a){b.onLoginStatusChanged.notifyEventListeners("connected"==a.status,a.error)}),this},a.SocialGamingServiceFacebook.prototype={currentPermissions:null,isLoggedIn:function(){return this.fb._currentSession&&"connected"===this.fb._currentSession.status},login:function(a){var b=this;this.fb.login(function(c){a&&a(b.isLoggedIn(),c.error)})},logout:function(a){this.fb.logout(function(b){a&&a(b.error)})},getLoggedInUser:function(){var a=this.fb._currentSession?this.fb._currentSession.authResponse:null;return a&&a.user?d(a.user):a&&a.userID?new Cocoon.Social.Facebook.User(a.userID,"Loading..."):null},hasPublishPermissions:function(a){this.fb.getPermissions(function(b,c){a(b.publish_actions,c)})},requestPublishPermissions:function(a){var b=this;this.fb.requestAdditionalPermissions("publish","publish_actions",function(c){c.error?a(!1,error):b.hasPublishPermissions(function(b,c){a(b,c)})})},requestUser:function(a,b){var c=b||"me";this.fb.api(c,function(b){var c=b.error?null:d(b);a(c,b.error)})},requestUserImage:function(a,b,c){!b&&this.isLoggedIn()&&(b=this.fb._currentSession.authResponse.userID);var d="small";c===Cocoon.Social.ImageSize.THUMB?d="square":c===Cocoon.Social.ImageSize.MEDIUM?d="normal":c===Cocoon.Social.ImageSize.LARGE&&(d="large");var e="https://graph.facebook.com/"+b+"/picture?type="+d;a(e)},requestFriends:function(a,b){var c=(b||"me")+"/friends";this.fb.api(c,function(b){var c=[];if(!b.error)for(var e=0;e<b.data.length;e++)c.push(d(b.data[e]));a(c,b.error)})},preparePublishAction:function(a){if(this.currentPermissions)this.currentPermissions.publish_actions?a(!0):(this.currentPermissions=null,this.fb.requestAdditionalPermissions("publish","publish_actions",function(b){a(b.error?!1:!0)}));else{var b=this;this.fb.getPermissions(function(c){b.currentPermissions=c,c&&b.preparePublishAction(a)})}},publishMessage:function(a,b){this.preparePublishAction(function(c){if(c){var d=e(a),f="me/feed";this.fb.api(f,d,function(a){b&&b(a.error)})}else b&&b({message:"No publish_actions permission granted"})})},publishMessageWithDialog:function(a,b){this.fb.showShareDialog(e(a),function(a){b&&b(a.error)})},requestScore:function(a,b){var c=(b&&b.userID?b.userID:"me")+"/scores";this.fb.api(c,function(b){if(b.error)a(null,b.error);else if(b.data&&b.data.length>0){var c=f(b.data[0]);a(c,null)}else a(null,null)})},submitScore:function(a,b,c){var d=this;this.preparePublishAction(function(e){e?d.requestScore(function(e,f){if(f)return void(b&&b(f));var g=e?e.score:0;if(g>=a)return void(b&&b(null));var h="/"+(c&&c.userID?c.userID:"me")+"/scores";d.fb.api(h,"POST",{score:a},function(a){b&&b(a.error)})},c):b&&b({message:"No publish_actions permission granted"})})},showLeaderboard:function(a,b){if(!this._leaderboardsTemplate)throw"Please, provide a html template for leaderboards with the setTemplates method";var c=new Cocoon.Widget.WebDialog,d=!1;c.show(this._leaderboardsTemplate,function(b){c.closed=!0,!d&&a&&a(b)});var e=this;this.fb.api(e.fb._appId+"/scores",function(b){if(!c.closed){if(b.error)return void(a&&(d=!0,a(b.error),c.close()));var g=[];if(b.data&&b.data.length)for(var h=0;h<b.data.length;++h){var i=f(b.data[h]);i.position=h,i.imageURL="https://graph.facebook.com/"+i.userID+"/picture",i.me=i.userID===e.fb._currentSession.authResponse.userID,g.push(i)}var j="addScores("+JSON.stringify(g)+")";c.eval(j)}})},prepareAchievements:function(a,b){if(!this._cachedAchievements||a){var c=this;this.fb.api(this.fb._appId+"/achievements",function(a){if(a.error)b([],a.error);else{var d=[];if(a.data)for(var e=0;e<a.data.length;e++)d.push(g(a.data[e]));c.setCachedAchievements(d),b(d,null)}})}else b(this._cachedAchievements,null)},requestAllAchievements:function(a){this.prepareAchievements(!0,a)},requestAchievements:function(a,b){var c=this;this.prepareAchievements(!1,function(d,e){if(e)return void a([],e);var f=(b||"me")+"/achievements";c.fb.api(f,function(b){if(b.error)a([],b.error);else{var d=[];if(b.data)for(var e=0;e<b.data.length;e++){var f=c.findAchievement((b.data[e].achievement||b.data[e].data.achievement).id);f&&d.push(f)}a(d,null)}})})},submitAchievement:function(a,b){if(null===a||"undefined"==typeof a)throw"No achievementID specified";var c=this.translateAchievementID(a),d=this;this.preparePublishAction(function(a){a?d.fb.api("me/achievements","POST",{achievement:c},function(a){b&&b(a.error)}):b&&b({message:"No publish_actions permission granted"})})},resetAchievements:function(a){var b=this;this.preparePublishAction(function(c){c?b.requestAchievements(function(c,d){if(d)return void(a&&a(d));for(var e=null,f=c.length,g=0;g<c.length;++g)b.fb.api("me/achievements","DELETE",{achievement:c[g].fbAchievementData.url},function(b){b.error&&(e=b.error),f--,0==f&&a&&a(e)})}):a&&a({message:"No publish_actions permission granted"})})},showAchievements:function(a){if(!this._achievementsTemplate)throw"Please, provide a html template for achievements with the setTemplates method";var b=new Cocoon.Widget.WebDialog,c=!1;b.show(this._achievementsTemplate,function(d){b.closed=!0,!c&&a&&a(d)});var d=this;this.requestAchievements(function(e,f){if(!b.closed){if(f)return c=!0,void(a&&a(f));var g=[];if(d._cachedAchievements)for(var h=0;h<d._cachedAchievements.length;++h){var i=d._cachedAchievements[h];if(g.push(i),e&&e.length)for(var j=0;j<e.length;++j)if(e[j].achievementID===i.achievementID){i.achieved=!0;break}}var k="addAchievements("+JSON.stringify(g)+");";b.eval(k)}})}},Cocoon.extend(a.SocialGamingServiceFacebook,a.SocialGamingService),!(navigator.isCocoonJS||"undefined"!=typeof module&&module.exports)){var h=document.getElementsByTagName("script")[0],i=document.createElement("script"),j=location.protocol?location.protocol:"http:";i.src=j+"//connect.facebook.net/en_US/all.js",h.parentNode.insertBefore(i,h)}return a}),Cocoon.define("Cocoon.Multiplayer",function(a){return a.MultiplayerService=function(a,b){this.nativeExtensionName=a,this.extensionName=b,this.nativeAvailable=!!window.ext&&!!window.ext[this.nativeExtensionName];var c=this;this.onInvitationReceived=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onInvitationReceived"),this.onInvitationLoaded=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onInvitationLoaded",function(a,b){var d=b[0],e=b[1];d&&!e?(c.currentMatch=new Cocoon.Multiplayer.Match(c.nativeExtensionName,c.extensionName,d),a(c.currentMatch,null)):a(null,e)});var d=new Cocoon.Signal.createSignal;return d.register("invitation",{received:this.onInvitationReceived,loaded:this.onInvitationLoaded}),this.on=d.expose(),this},a.MultiplayerService.prototype={currentMatch:null,findMatch:function(a,b){var c=this;this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"findMatch",[a,function(a,d){a&&!d?(c.currentMatch=new Cocoon.Multiplayer.Match(c.nativeExtensionName,c.extensionName,a),b(c.currentMatch,null)):b(null,d)}],!0)},findAutoMatch:function(a,b){var c=this;this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"findAutoMatch",[a,function(a,d){a&&!d?(c.currentMatch=new Cocoon.Multiplayer.Match(c.nativeExtensionName,c.extensionName,a),b(c.currentMatch,null)):b(null,d)}],!0)},cancelAutoMatch:function(){this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"cancelAutoMatch",[],!0)},addPlayersToMatch:function(a,b,c){this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"addPlayersToMatch",[a,b.matchID,c],!0)},getMatch:function(){return this.currentMatch}},a.Match=function(a,b,c){if("string"!=typeof a)throw"The given native extension name '"+a+"' is not a string.";if("string"!=typeof b)throw"The given extension name '"+a+"' is not a string.";this.nativeExtensionName=a,this.extensionName=b,this.nativeAvailable=Cocoon.nativeAvailable&&"undefined"!=typeof window.ext[a],this.matchID=c;var d=this;this.onMatchDataReceived=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchDataReceived",function(a,b){d.matchID===b[0]&&a(d,b[1],b[2])}),this.onMatchStateChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchStateChanged",function(a,b){d.matchID===b[0]&&a(d,b[1],b[2])}),this.onMatchConnectionWithPlayerFailed=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchConnectionWithPlayerFailed",function(a,b){d.matchID===b[0]&&a(d,b[1],b[2])}),this.onMatchFailed=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchFailed",function(a,b){d.matchID===b[0]&&a(d,b[1])});var e=new Cocoon.Signal.createSignal;e.register("match",{dataReceived:this.onMatchDataReceived,stateChanged:this.onMatchStateChanged,connectionWithPlayerFailed:this.onMatchConnectionWithPlayerFailed,failed:this.onMatchFailed}),this.on=e.expose()},a.Match.prototype={start:function(){this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"startMatch",[this.matchID],!0)},sendDataToAllPlayers:function(a,b){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"sendDataToAllPlayers",[this.matchID,a,b]):void 0},sendData:function(a,b,c){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"sendData",[this.matchID,a,b,c]):void 0},disconnect:function(){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"disconnect",[this.matchID],!0):void 0},requestPlayersInfo:function(a){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"requestPlayersInfo",[this.matchID,a],!0):void 0},getExpectedPlayerCount:function(){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"getExpectedPlayerCount",[this.matchID]):void 0},getPlayerIDs:function(){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"getPlayerIDs",[this.matchID]):void 0},getLocalPlayerID:function(){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"getLocalPlayerID",[this.matchID]):""}},a.SendDataMode={RELIABLE:0,UNRELIABLE:1},a.ConnectionState={UNKNOWN:0,CONNECTED:1,DISCONNECTED:2},a.PlayerInfo=function(a,b){this.userID=a,this.userName=b},a.MatchRequest=function(a,b,c,d,e){return this.minPlayers=a,this.maxPlayers=b,this.playersToInvite=c,this.playerGroup=d,this.playerAttributes=e,this},a}),Cocoon.define("Cocoon.Multiplayer",function(a){var b=[],c=0,d=[],e=0;a.LoopbackService=function(){Cocoon.Multiplayer.LoopbackService.superclass.constructor.call(this,"dummy","dummy"),b.push(this),this.playerID=""+c,c++},a.LoopbackService.prototype={findMatch:function(a,b){this.findMatchCallback=b;for(var c=!1,e=0;e<d.length;++e)if(d[e]===this){c=!0;break}if(c||d.push(this),d.length>=a.minPlayers){for(var g=[],e=0;e<d.length;++e)g.push(d[e].getPlayerID());for(var e=0;e<d.length;++e){var h=new f(d[e]);h.playerIDs=g.slice(),d[e].currentMatch=h,d[e].findMatchCallback(h,null)}d=[]}},findAutoMatch:function(a,b){this.findMatch(a,b)},cancelAutoMatch:function(){},addPlayersToMatch:function(a,b,c){c({message:"Not implemmented"})},getPlayerID:function(){return this.playerID},getMatch:function(){return this.currentMatch}},Cocoon.extend(a.LoopbackService,a.MultiplayerService);var f=function(a){e++,f.superclass.constructor.call(this,"","",e),this.started=!1,this.disconnected=!1,this.pendingData=[],this.service=a};return f.prototype={start:function(){var a=this;setTimeout(function(){a.started=!0;for(var b=0;b<a.pendingData.length;++b)a.onMatchDataReceived.notifyEventListeners(a.matchID,a.pendingData[b].data,a.pendingData[b].player)},0)},sendDataToAllPlayers:function(a,b){this.sendData(a,this.playerIDs,b)},sendData:function(a,c,d){var e=this;setTimeout(function(){for(var d=0;d<b.length;++d){for(var f=null,g=0;g<c.length;++g)c[g]===b[d].getPlayerID()&&(f=b[d]);f&&f.getMatch().notifyDataReceived(a,e.service.getPlayerID())}},0)},disconnect:function(){this.disconnected=!0;for(var a=0;a<this.playerIDs.length;++a)for(var c=this.playerIDs[a],d=0;d<b.length;++d)if(b[d].getPlayerID()===c){var e=b[a].getMatch();e.disconnected||e.onMatchStateChanged.notifyEventListeners(e,this.service.getPlayerID(),Cocoon.Multiplayer.ConnectionState.DISCONNECTED)}},requestPlayersInfo:function(a){var b=this;setTimeout(function(){for(var c=[],d=0;d<b.playerIDs.length;++d)c[d]={userID:b.playerIDs[d],userName:"Player"+b.playerIDs[d]};a(c)},1)},getExpectedPlayerCount:function(){return 0},getPlayerIDs:function(){return this.playerIDs},getLocalPlayerID:function(){return this.service.playerID},notifyDataReceived:function(a,b){this.started?this.onMatchDataReceived.notifyEventListeners(this.matchID,a,b):this.pendingData.push({data:a,player:b})}},Cocoon.extend(f,Cocoon.Multiplayer.Match),a}),Cocoon.define("Cocoon.Multiplayer",function(a){return a.GooglePlayGames=new Cocoon.Multiplayer.MultiplayerService("IDTK_SRV_MULTIPLAYER_GPG","Multiplayer.GooglePlayGames"),a}),Cocoon.define("Cocoon.Multiplayer",function(a){return a.GameCenter=new Cocoon.Multiplayer.MultiplayerService("IDTK_SRV_MULTIPLAYER_GAMECENTER","Multiplayer.GameCenter"),a}),function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports=function(){throw Error("[BaseClass] Abstract method was called without definition.")}},{}],2:[function(a,b,c){function d(a){return a.extend=function(b){var c,d={base:a.base};b=b||{};for(c in a)"function"==typeof a[c]&&(d[c]=a[c].bind(a));for(c in b)"function"==typeof b[c]?a[c]=e(c,a,d,b):a[c]=b[c];return a.base=d,a},a.implement=function(){var b,c=arguments.length;for(b=0;c>b;b+=1)arguments[b](a);return a},a}var e=a("./rebind.js");d.Abstract=a("./abstract.js"),d.Stub=a("./stub.js"),d.Interface=a("./interface.js"),b.exports=d},{"./abstract.js":1,"./interface.js":3,"./rebind.js":4,"./stub.js":5}],3:[function(a,b,c){b.exports=function(a){return function(b){var c;for(c in a)b[c]=a[c];return b}}},{}],4:[function(a,b,c){b.exports=function(a,b,c,d){return function(){var e,f=b.base;return b.base=c,b.self=d,e=d[a].apply(b,arguments),b.base=f,e}}},{}],5:[function(a,b,c){b.exports=function(){}},{}],6:[function(a,b,c){arguments[4][1][0].apply(c,arguments)},{dup:1}],7:[function(a,b,c){arguments[4][2][0].apply(c,arguments)},{"./abstract.js":6,"./interface.js":8,"./rebind.js":9,"./stub.js":10,dup:2}],8:[function(a,b,c){arguments[4][3][0].apply(c,arguments)},{dup:3}],9:[function(a,b,c){arguments[4][4][0].apply(c,arguments)},{dup:4}],10:[function(a,b,c){arguments[4][5][0].apply(c,arguments)},{dup:5}],11:[function(a,b,c){b.exports=function(){var a,b=arguments[0],c=arguments.length;for(a=1;c>a;a+=1)b=b.replace(/%s/,arguments[a]);return b}},{}],12:[function(a,b,c){(function(a){b.exports=function(b){var c,d={},e={},f=[],g=a.localStorage||{};return c=function(a,c){var h,i,a,j,k="string"==typeof a,l=typeof c,m="undefined"!==l&&"function"!==l;if("on"===g.lumberjack||b){if(!k||!m)throw Error("Lumberjack Error: log(channel, data) requires an channel {String} and a payload {String|Object|Number|Boolean}.");for(j={time:new Date,data:c,channel:a,id:f.length},d[a]=d[a]||[],d[a].push(j),f.push(j),e[a]=e[a]||[],i=e[a].length,h=0;i>h;h+=1)e[a][h](c)}},c.clear=function(a){a?d[a]=[]:(d={},f=[])},c.readback=function(a,b){var c="string"==typeof a;if(c)return b?JSON.stringify(d[a],null,4):d[a]||[];throw Error("log.readback(channel, pretty) requires an channel {String}.")},c.readback.master=function(a){return a?JSON.stringify(f,null,4):f},c.readback.channels=function(a){var b=Object.keys(d);return a?JSON.stringify(b):b},c.on=function(a,b){var c="string"==typeof a,d="function"==typeof b;if(!c||!d)throw Error("log.on(channel, cb) requires an channel {String} and a callback {Function}.");e[a]=e[a]||[],e[a].push(b)},c.off=function(a){var b="string"==typeof a;if(!b)throw Error("log.off(channel) requires an channel {String}.");e[a]=[]},c.enable=function(){b=!0},c.disable=function(){b=!1},c}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],13:[function(a,b,c){var d=a("./dimension.js"),e=a("./point.js");a("./log.js");b.exports=function(a){var b,c=0,f=!1,g=a.frames||1,h=a.size||d(),i=a.start||e(),i=e(h.width*i.x,h.height*i.y),j=1;return{size:h,frame:0,speed:a.speed||0,load:function(b){a.sheet.load(b)},start:function(){b=Date.now(),f=!0},pause:function(){f=!1},stop:function(){f=!1,c=0,this.frame=0,j=1},update:function(){var a,d,e;f&&this.speed&&(e=1/this.speed*1e3,a=Date.now(),d=a-b,c+=d,c>=e&&(c=0,this.nextFrame()),b=a)},nextFrame:function(){return this.frame+=j,a.sinusoid?this.frame%(g-1)===0&&(j*=-1):this.frame%=g,this.frame},draw:function(b,c,e,f){var g,j=this.frame*h.width;e=e||d(1,1),f=f||0,g=d(h.width*e.width,h.height*e.height),b.save(),b.translate(c.x+g.width/2,c.y+g.height/2),b.rotate(f),b.drawImage(a.sheet,i.x+j,i.y,h.width,h.height,-g.width/2,-g.height/2,g.width,g.height),b.restore()}}}},{"./dimension.js":23,"./log.js":32,"./point.js":34}],14:[function(a,b,c){b.exports=function(a){var b=document.createElement("audio"),c=b.play;return b.loop=a.loop||!1,b.volume=a.volume||1,b.play=function(a){
a&&(this.currentTime=0),c.call(this)},b.stop=function(){this.pause(),this.currentTime=0},a.on=a.on||{},b.onloadeddata=a.on.load,b.onplay=a.on.play,b.onplaying=a.on.playing,b.onended=a.on.ended,b.src="assets/sound/"+a.src,b}},{}],15:[function(a,b,c){var d=a("./detect-mobile.js"),e=document.createElement("canvas");d?(e.width=window.innerWidth,e.height=window.innerHeight):("landscape"===localStorage.drago?(e.width=480,e.height=320):(e.width=320,e.height=480),e.style.border="1px solid #000"),document.body.appendChild(e),e.mobile=d,e.ctx=e.getContext("2d"),b.exports=e},{"./detect-mobile.js":22}],16:[function(a,b,c){var d=a("./shape.js"),e=a("./vector.js"),f=a("./point.js");a("./dimension.js");b.exports=function(a,b){return a=a||f(),b=b||0,d({pos:a,name:"circle",intersects:{rectangle:function(a){var b,c=f(this.x,this.y);return this.x>a.right?c.x=a.right:this.x<a.x&&(c.x=a.x),this.y>a.bottom?c.y=a.bottom:this.y<a.y&&(c.y=a.y),b=e(this.x-c.x,this.y-c.y),b.magnitude<this.radius},circle:function(a){var b=e(a.x-this.x,a.y-this.y);return b.magnitude<this.radius+a.radius}}}).extend({radius:b,width:2*b,height:2*b,top:a.y-b,right:a.x+b,bottom:a.y+b,left:a.x-b,draw:function(a){a.beginPath(),a.lineWidth=1,a.strokeStyle="rgba(250, 50, 50, 0.5)",a.arc(this.x,this.y,this.radius,0,2*Math.PI),a.stroke()},move:function(a,b){this.x=a,this.y=b,this.top=b-this.radius,this.right=a+this.radius,this.bottom=b+this.radius,this.left=a-this.radius},resize:function(a){this.radius=a,this.width=2*a,this.height=2*a,this.top=this.y-a,this.right=this.x+a,this.bottom=this.y+a,this.left=this.x-a}})}},{"./dimension.js":23,"./point.js":34,"./shape.js":38,"./vector.js":45}],17:[function(a,b,c){var d=a("baseclassjs"),e=a("./sprite.js");b.exports=function(a){return a=a||{},e(a).extend({load:function(a){a()},drawing:a.drawing===!1?!1:!0,updating:a.updating===!1?!1:!0,start:function(){this.drawing=!0,this.updating=!0},pause:function(){this.drawing=!0,this.updating=!1},stop:function(){this.drawing=!1,this.updating=!1},update:d.Stub,draw:d.Stub})}},{"./sprite.js":39,baseclassjs:7}],18:[function(a,b,c){var d=a("./id-counter.js"),e=a("./event-handler.js"),f=a("baseclassjs"),g=a("./rectangle.js"),h=a("./point.js");b.exports=function(a){var b={},c={},i=[],j=!1;return a.collisionSets&&(i=[].concat(a.collisionSets)),f({id:d.nextId,name:a.name,mask:a.mask||g(),offset:a.offset||h(),move:function(a){this.mask.move(a.x+this.offset.x,a.y+this.offset.y)},intersects:function(a){return this.mask.intersects(a)},update:function(){var a=this;j||(i.forEach(function(b){b.update(a)}),j=!0)},teardown:function(){j=!1,c={}},addCollision:function(a){b[a]=!0,c[a]=!0},removeCollision:function(a){b[a]=!1},clearCollisions:function(){b={}},isCollidingWith:function(a){return b[a]||!1},canCollideWith:function(a){var b=this.id===a,d=c[a];return!b&&!d}}).implement(e({events:a.on,singles:a.one}))}},{"./event-handler.js":25,"./id-counter.js":29,"./point.js":34,"./rectangle.js":36,baseclassjs:7}],19:[function(a,b,c){var d=a("./rectangle.js"),e=a("./point.js"),f=a("./dimension.js"),g=a("./canvas.js");b.exports=function(a){var b,c,h=[],i=[],j=a.gridSize||f(1,1);for(b=0;b<j.width;b+=1)for(c=0;c<j.height;c+=1)h.push(d(e(b/j.width*g.width,c/j.height*g.height),f(g.width/j.width,g.height/j.height)));for(b=0;b<h.length;b+=1)i.push([]);return{name:a.name,draw:function(a,b){b&&h.forEach(function(b){b.draw(a)}),i.forEach(function(b){b.forEach(function(b){b.mask.draw(a)})})},clearCollisions:function(){var a,b=i.length;for(a=0;b>a;a+=1)i[a]=[]},update:function(a){var b,c=i.length;for(b=0;c>b;b+=1)a.intersects(h[b])&&i[b].push(a)},handleCollisions:function(){var a,b,c=i.length;for(a=0;c>a;a+=1)b=i[a],b.forEach(function(a){b.forEach(function(b){var c,d,e=a.canCollideWith(b.id);e&&(c=a.intersects(b.mask),d=a.isCollidingWith(b.id),c?(a.addCollision(b.id),d||a.trigger("collide/"+b.name,b),a.trigger("colliding/"+b.name,b)):(d&&(a.removeCollision(b.id),a.trigger("separate/"+b.name,b)),a.trigger("miss/"+b.name,b)))})})},teardown:function(){this.clearCollisions()}}}},{"./canvas.js":15,"./dimension.js":23,"./point.js":34,"./rectangle.js":36}],20:[function(a,b,c){b.exports={Shape:a("./shape.js"),Circle:a("./circle.js"),Rectangle:a("./rectangle.js"),Dimension:a("./dimension.js"),Point:a("./point.js"),Vector:a("./vector.js"),Polar:a("./polar.js"),FrameCounter:a("./frame-counter.js"),IdCounter:a("./id-counter.js"),Mouse:a("./mouse.js"),Keyboard:a("./keyboard.js"),EventHandler:a("./event-handler.js"),SpriteSheet:a("./spritesheet.js"),AnimationStrip:a("./animation-strip.js"),Audio:a("./audio.js"),Font:a("./font.js"),CollisionHandler:a("./collision-handler.js"),collisions:a("./dragon-collisions.js"),Game:a("./game.js"),canvas:a("./canvas.js"),Screen:a("./screen.js"),Collidable:a("./collidable.js"),Sprite:a("./sprite.js"),ClearSprite:a("./clear-sprite.js"),ui:{Slider:a("./ui/slider.js"),Button:a("./ui/button.js"),Label:a("./ui/label.js"),Decal:a("./ui/decal.js")}}},{"./animation-strip.js":13,"./audio.js":14,"./canvas.js":15,"./circle.js":16,"./clear-sprite.js":17,"./collidable.js":18,"./collision-handler.js":19,"./dimension.js":23,"./dragon-collisions.js":24,"./event-handler.js":25,"./font.js":26,"./frame-counter.js":27,"./game.js":28,"./id-counter.js":29,"./keyboard.js":31,"./mouse.js":33,"./point.js":34,"./polar.js":35,"./rectangle.js":36,"./screen.js":37,"./shape.js":38,"./sprite.js":39,"./spritesheet.js":40,"./ui/button.js":41,"./ui/decal.js":42,"./ui/label.js":43,"./ui/slider.js":44,"./vector.js":45}],21:[function(a,b,c){b.exports={show:{fps:function(){}}}},{}],22:[function(a,b,c){b.exports="ontouchstart"in window},{}],23:[function(a,b,c){function d(a,b){return{width:a||0,height:b||0,clone:function(){return d(this.width,this.height)},equals:function(a){return this.width===a.width&&this.height===a.height},scale:function(a){return d(this.width*a,this.height*a)}}}b.exports=d},{}],24:[function(a,b,c){var d=a("./collision-handler.js"),e=a("./dimension.js");b.exports=d({name:"dragon",gridSize:e(4,4)})},{"./collision-handler.js":19,"./dimension.js":23}],25:[function(a,b,c){var d=a("baseclassjs");b.exports=function(a){var b,c={},e={};a=a||{};for(b in a.events)c[b]=[a.events[b]];for(b in a.singles)e[b]=[a.singles[b]];return d.Interface({on:function(a,b){c[a]=c[a]||[],c[a].push(b)},one:function(a,b){e[a]=e[a]||[],e[a].push(b)},off:function(a){c[a]=[],e[a]=[]},trigger:function(a,b){var d=this;a in c&&c[a].forEach(function(a){a.call(d,b)}),a in e&&(e[a].forEach(function(a){a.call(d,b)}),e[a]=[])}})}},{baseclassjs:7}],26:[function(a,b,c){var d=a("curb"),e="@font-face{font-family:'%s';font-style:%s;font-weight:%s;src:url(assets/fonts/%s);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2212,U+2215,U+E0FF,U+EFFD,U+F000}",f={};b.exports={load:function(a){var b;f[a.name]||(b=document.createElement("style"),b.innerHTML=d(e,a.name,a.style||"normal",a.weight||"400",a.src),document.body.appendChild(b),f[a.name]=!0)}}},{curb:11}],27:[function(a,b,c){var d=frameCountThisSecond=frameRate=0,e=Date.now();b.exports={countFrame:function(){var a=Date.now(),b=a-e;frameCountThisSecond+=1,e=a,d+=b,d>=1e3&&(d-=1e3,frameRate=frameCountThisSecond,frameCountThisSecond=0)},get frameRate(){return frameRate},draw:function(a){a.font="30px Verdana",a.fillStyle="rgba(250, 50, 50, 0.5)",a.fillText(frameRate,20,50)}}},{}],28:[function(a,b,c){var d=(a("./collision-handler.js"),a("./point.js")),e=a("./dimension.js"),f=a("./circle.js"),g=a("./rectangle.js"),h=a("./collidable.js"),i=a("./frame-counter.js"),j=a("./mouse.js"),k=a("./canvas.js"),l=k.ctx,m=a("./id-counter.js"),n=(a("./log.js"),a("./dragon-collisions.js")),o=!1,p=[],q={},r=[],s=!1,t={},u=!1,v={screentap:h({name:"screentap",mask:f(d(),8)}),screendrag:h({name:"screendrag",mask:f(d(),8)}),screenhold:h({name:"screenhold",mask:f(d(),8)}),screenedge:{top:h({name:"screenedge/top",mask:g(d(0,-9),e(k.width,10))}),right:h({name:"screenedge/right",mask:g(d(k.width-1,0),e(10,k.height))}),bottom:h({name:"screenedge/bottom",mask:g(d(0,k.height-1),e(k.width,10))}),left:h({name:"screenedge/left",mask:g(d(-9,0),e(10,k.height))})}};j.on.down(function(){v.screentap.move(j.offset),n.update(v.screentap)}),b.exports={debug:a("./debug-console.js"),screen:function(a){return q[a]},addScreens:function(a){var b;a&&(a=[].concat(a),b=m.nextId,t[b]=a.length,a.forEach(function(c){c.load(function(){t[b]-=1,0===t[b]&&(r=r.concat(a))})}))},removeScreen:function(a){a.removed=!0,s=!0},run:function(a){var b=this,c=function(){b.update(),b.draw(),b.teardown(),i.countFrame(),u&&window.requestAnimationFrame(c)};o=a,a&&(window.Dragon=this),u||(u=!0,window.requestAnimationFrame(c))},kill:function(){u=!1,p.forEach(function(a){a.stop()})},update:function(){j.is.dragging?(v.screendrag.move(j.offset),n.update(v.screendrag)):j.is.down&&(v.screenhold.move(j.offset),n.update(v.screenhold)),n.update(v.screenedge.top),n.update(v.screenedge.right),n.update(v.screenedge.bottom),n.update(v.screenedge.left),p.forEach(function(a){a.updating()&&a.update()}),n.handleCollisions(),r.length&&(r.forEach(function(a){p.push(a),a.name&&(q[a.name]=a),a.trigger("ready")}),p.sort(function(a,b){return b.depth-a.depth}),r=[])},draw:function(){p.forEach(function(a){a.drawing()&&a.draw(l,o)}),o&&(i.draw(l),n.draw(l))},teardown:function(){n.teardown(),p.forEach(function(a){a.teardown()}),s&&(p=p.filter(function(a){return!a.removed}),s=!1)}}},{"./canvas.js":15,"./circle.js":16,"./collidable.js":18,"./collision-handler.js":19,"./debug-console.js":21,"./dimension.js":23,"./dragon-collisions.js":24,"./frame-counter.js":27,"./id-counter.js":29,"./log.js":32,"./mouse.js":33,"./point.js":34,"./rectangle.js":36}],29:[function(a,b,c){var d=0;b.exports={get lastId(){return d},get nextId(){return d+=1}}},{}],30:[function(a,b,c){b.exports=function(a){var b=new Image;return b.ready=!1,b.cmd=[],b.processLoadEvents=function(){this.cmd.forEach(function(a){a(b)}),this.cmd=[]},b.onload=function(){this.ready=!0,this.processLoadEvents()},b.load=function(c){c=c||function(){},this.ready?c(b):(this.cmd.push(c),this.src="assets/img/"+a)},b}},{}],31:[function(a,b,c){function d(a){return a.charCode||a.keyCode||a.which}var e={alt:!1,ctrl:!1,shift:!1},f={};document.onkeydown=function(a){var b=d(a),c=String.fromCharCode(b);f[b]=!0,e[c]=!0,e.alt=a.altKey,e.ctrl=a.ctrlKey,e.shift=a.shiftKey},document.onkeyup=function(a){var b=d(a),c=String.fromCharCode(b);f[b]=!1,e[c]=!1,e.alt=a.altKey,e.ctrl=a.ctrlKey,e.shift=a.shiftKey},b.exports={get alt(){return e.alt},get ctrl(){return e.ctrl},get shift(){return e.shift},arrow:{get left(){return f[37]||!1},get up(){return f[38]||!1},get right(){return f[39]||!1},get down(){return f[40]||!1}},name:function(a){return e[a]||!1},code:function(a){return f[a]||!1}}},{}],32:[function(a,b,c){var d=a("lumberjackjs");b.exports=d()},{lumberjackjs:12}],33:[function(a,b,c){(function(c){function d(a){return j.mobile?h(a.touches[0].clientX,a.touches[0].clientY):h(a.offsetX,a.offsetY)}var e,f,g,h=a("./point.js"),i=a("./vector.js"),j=a("./canvas.js"),k=!1,l=!1,m=!1,n=h(),o=h(),p=i();j.mobile?(e="touchstart",f="touchmove",g="touchend"):(e="mousedown",f="mousemove",g="mouseup"),j.addEventListener(e,function(a){k=!0,n=d(a),c.setTimeout(function(){k&&(m=!0)},200)}),document.addEventListener(g,function(a){k=l=m=!1}),j.addEventListener(f,function(a){o=n,n=d(a),k&&(p.x=n.x-o.x,p.y=n.y-o.y,p.magnitude>1&&(l=!0))}),b.exports={is:{get down(){return k},get dragging(){return l},get holding(){return m}},get offset(){return n},on:{down:function(a){j.addEventListener(e,a)},click:function(a){},dclick:function(a){},up:function(a){document.addEventListener(g,a)},move:function(a){j.addEventListener(f,a)}},eventName:{start:e,move:f,end:g}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./canvas.js":15,"./point.js":34,"./vector.js":45}],34:[function(a,b,c){function d(a,b){return{x:a||0,y:b||0,clone:function(){return d(this.x,this.y)},equals:function(a){return this.x===a.x&&this.y===a.y}}}b.exports=d},{}],35:[function(a,b,c){function d(a,b,c,d){var e=a.magnitude===d*b.magnitude,f=(a.theta%Math.PI).toFixed(5),g=((b.theta+c)%Math.PI).toFixed(5);return e&&f===g}function e(a,b){return{theta:a||0,magnitude:b||0,invert:function(){return e(this.theta+Math.PI,-1*this.magnitude)},clone:function(){return e(this.theta,this.magnitude)},toVector:function(){return f(this.magnitude*Math.cos(this.theta),this.magnitude*Math.sin(this.theta))},equals:function(a){return d(this,a,0,1)||d(this,a,Math.PI,-1)}}}var f=a("./vector.js");b.exports=e},{"./vector.js":45}],36:[function(a,b,c){var d=a("./shape.js"),e=a("./point.js"),f=a("./dimension.js"),g=a("./vector.js");b.exports=function(a,b){return a=a||e(),b=b||f(),d({pos:a,name:"rectangle",intersects:{rectangle:function(a){return this.x<a.right&&this.right>a.x&&this.y<a.bottom&&this.bottom>a.y},circle:function(a){var b,c=e(a.x,a.y);return a.x>this.right?c.x=this.right:a.x<this.x&&(c.x=this.x),a.y>this.bottom?c.y=this.bottom:a.y<this.y&&(c.y=this.y),b=g(a.x-c.x,a.y-c.y),b.magnitude<a.radius}}}).extend({width:b.width||0,height:b.height||0,top:a.y||0,right:a.x+b.width||0,bottom:a.y+b.height||0,left:a.x||0,move:function(a,b){this.x=a,this.y=b,this.top=b,this.right=a+this.width,this.bottom=b+this.height,this.left=a},resize:function(a){this.width=a.width,this.height=a.height,this.right=this.x+a.width,this.bottom=this.y+a.height},draw:function(a){a.beginPath(),a.lineWidth=1,a.strokeStyle="rgba(250, 50, 50, 0.5)",a.rect(this.x,this.y,this.width,this.height),a.stroke()}})}},{"./dimension.js":23,"./point.js":34,"./shape.js":38,"./vector.js":45}],37:[function(a,b,c){var d=a("baseclassjs"),e=a("./event-handler.js"),f=a("./id-counter.js");b.exports=function(a){function b(){i.length&&(i.forEach(function(a){g.push(a),a.name&&(h[a.name]=a),a.trigger("ready")}),g.sort(function(a,b){return b.depth-a.depth}),i=[])}var c=!1,g=[],h={},i=[],j={},k=!1,l={},m=!1,n=!1;return d({name:a.name,updating:function(){return m},drawing:function(){return n},load:function(b){c||(this.addCollisionSets(a.collisionSets),this.addSprites({set:a.spriteSet,onload:b,force:!0}),c=!0)},start:function(){m=!0,n=!0,this.trigger("start")},pause:function(){m=!1,n=!0,this.trigger("pause")},stop:function(){m=!1,n=!1,this.trigger("stop")},depth:a.depth||0,collision:function(a){return l[a]},addCollisionSets:function(a){a&&(a=[].concat(a),a.forEach(function(a){l[a.name]=a}))},sprite:function(a){return h[a]},addSprites:function(a){var c,d,e;a=a||{},d=a.onload||function(){},e=[].concat(a.set),e.length?(c=f.nextId,j[c]=e.length,e.forEach(function(f){f.load(function(){j[c]-=1,0===j[c]&&(i=i.concat(e),a.force&&b(),d())})})):d()},removeSprite:function(a){a.removed=!0,k=!0},update:function(){var a;if(m){g.forEach(function(a){m&&!a.removed&&a.updating&&a.update()});for(a in l)l[a].handleCollisions()}b()},draw:function(a,b){var c;if(n&&(g.forEach(function(b){b.drawing&&b.draw(a)}),b))for(c in l)l[c].draw(a)},teardown:function(){var a;m&&g.forEach(function(a){a.removed||a.teardown()});for(a in l)l[a].teardown();k&&(g=g.filter(function(a){return!a.removed}),k=!1)}}).implement(e({events:a.on,singles:a.one}))}},{"./event-handler.js":25,"./id-counter.js":29,baseclassjs:7}],38:[function(a,b,c){var d=a("baseclassjs"),e=a("./point.js");b.exports=function(a){var b,c;return a=a||{},c=a.intersects||{},b=a.pos||e(),d({x:b.x,y:b.y,name:a.name,move:d.Abstract,resize:d.Abstract,intersects:function(a){return c[a.name].call(this,a)},draw:d.Stub})}},{"./point.js":34,baseclassjs:7}],39:[function(a,b,c){var d=(a("baseclassjs"),a("./collidable.js")),e=a("./point.js"),f=a("./dimension.js"),g=a("./rectangle.js");b.exports=function(a){var b=!1,c=a.strips||{},h=a.pos||e();return a.freemask||(a.mask=a.mask||g(),a.offset=e(a.mask.x,a.mask.y),a.mask.move(h.x+a.offset.x,h.x+a.offset.y)),a.one=a.one||{},a.one.ready=a.one.ready||function(){this.start()},d(a).extend({strip:c[a.startingStrip],updating:a.updating||!1,drawing:a.drawing||!1,useStrip:function(a){this.strip!==c[a]&&(this.strip.stop(),this.strip=c[a],this.strip.start())},getStrip:function(a){return c[a]},pos:h,scale:a.scale||1,size:a.size||(c[a.startingStrip]||{}).size,trueSize:function(){return this.size.scale(this.scale)},rotation:a.rotation||0,depth:a.depth||0,speed:a.speed||e(),start:function(){this.updating=!0,this.drawing=!0,this.strip.start(),this.trigger("start")},pause:function(){this.updating=!1,this.drawing=!0,this.strip.pause(),this.trigger("pause")},stop:function(){this.updating=!1,this.drawing=!1,this.strip.stop(),this.trigger("stop")},update:function(){this.updating&&(this.shift(),this.strip.update(),this.base.update())},draw:function(a){var b;this.drawing&&(b=this.strip.size,this.strip.draw(a,this.pos,f(this.scale*this.size.width/b.width,this.scale*this.size.height/b.height),this.rotation))},load:function(a){var d,e;if(a=a||function(){},!b){e=Object.keys(c).length;for(d in c)c[d].load(function(){e-=1,0===e&&(a(),b=!0)})}},move:function(b,c){this.pos.x=b,this.pos.y=c,a.freemask||this.base.move(this.pos)},shift:function(b,c){this.pos.x+=b||this.speed.x,this.pos.y+=c||this.speed.y,a.freemask||this.base.move(this.pos)}})}},{"./collidable.js":18,"./dimension.js":23,"./point.js":34,"./rectangle.js":36,baseclassjs:7}],40:[function(a,b,c){var d=a("./image.js"),e={};b.exports=function(a){var b,c=a.src;return c in e?b=e[c]:(b=d(c),e[c]=b),b}},{"./image.js":30}],41:[function(a,b,c){var d=a("../sprite.js"),e=(a("../dimension.js"),a("../rectangle.js")),f=a("../point.js"),g=a("../animation-strip.js"),h=a("../spritesheet.js"),i=a("../dragon-collisions.js");b.exports=function(a){return a.down=a.down||{},d({name:a.name||"dragon-ui-button",collisionSets:[i],mask:e(f(),a.size),strips:{up:g({sheet:h({src:a.up.src}),size:a.up.size}),down:g({sheet:h({src:a.down.src||a.up.src}),size:a.down.size||a.up.size})},startingStrip:"up",pos:a.pos,size:a.size,on:{"colliding/screentap":function(){this.useStrip("down"),a.onpress.call(this)},"colliding/screenhold":function(){this.useStrip("down")}}}).extend({update:function(){this.useStrip("up"),this.base.update()}})}},{"../animation-strip.js":13,"../dimension.js":23,"../dragon-collisions.js":24,"../point.js":34,"../rectangle.js":36,"../sprite.js":39,"../spritesheet.js":40}],42:[function(a,b,c){var d=a("../sprite.js"),e=a("../animation-strip.js"),f=a("../spritesheet.js");b.exports=function(a){return d({name:a.name||"dragon-ui-decal",strips:{decal:e({sheet:f({src:a.strip.src}),size:a.strip.size})},startingStrip:"decal",pos:a.pos,size:a.size,scale:a.scale})}},{"../animation-strip.js":13,"../sprite.js":39,"../spritesheet.js":40}],43:[function(a,b,c){var d=a("../clear-sprite.js");b.exports=function(a){return a.style=a.style||function(){},a.name=a.name||"dragon-ui-label",d(a).extend({text:a.text,draw:function(b){a.style(b),b.fillText(this.text,this.pos.x,this.pos.y)}})}},{"../clear-sprite.js":17}],44:[function(a,b,c){var d=a("../sprite.js"),e=a("../dimension.js"),f=a("../rectangle.js"),g=a("../point.js"),h=a("../animation-strip.js"),i=a("../spritesheet.js"),j=a("../clear-sprite.js"),k=a("../dragon-collisions.js");b.exports=function(a){var b=a.pos,c=a.size,l=5,m=e(16,32),n=d({name:"slider-lane",collisionSets:[k],mask:f(g(),e(c.width,c.height-2*l)),strips:{slider:h({sheet:i({src:a.src.lane}),size:e(32,8)})},startingStrip:"slider",pos:g(b.x-c.width/2,b.y-c.height/2+l),size:e(c.width,c.height-2*l),on:{"colliding/screentap":function(b){var c,d;c=Math.max(b.mask.x,this.mask.left),c=Math.min(c,this.mask.right),o.pos.x=c-m.width/2,d=c-this.mask.left,d=(d/this.mask.width).toFixed(3),a.onslide(d)}}}),o=d({name:"slider-knob",collisionSets:[k],mask:f(g(),m),strips:{slider:h({sheet:i({src:a.src.knob}),size:e(8,16)})},startingStrip:"slider",pos:g(b.x-m.width/2,b.y-m.height/2),size:m,on:{"colliding/screendrag":function(b){var c,d;c=Math.max(b.mask.x,n.mask.left),c=Math.min(c,n.mask.right),this.pos.x=c-m.width/2,d=c-n.mask.left,d=(d/n.mask.width).toFixed(3),a.onslide(d)}}});return a.onslide=a.onslide||function(){},j().extend({load:function(a){var b=2,c=function(){b-=1,b||a()};n.load(c),o.load(c)},start:function(){n.start(),o.start()},pause:function(){n.pause(),o.start()},stop:function(){n.stop(),o.stop()},update:function(){n.update(),o.update()},draw:function(a){n.draw(a),o.draw(a)},teardown:function(){n.teardown(),o.teardown()}})}},{"../animation-strip.js":13,"../clear-sprite.js":17,"../dimension.js":23,"../dragon-collisions.js":24,"../point.js":34,"../rectangle.js":36,"../sprite.js":39,"../spritesheet.js":40}],45:[function(a,b,c){function d(a,b){return{x:a||0,y:b||0,get magnitude(){return Math.abs(Math.sqrt(this.y*this.y+this.x*this.x))},clone:function(){return d(this.x,this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},scale:function(a){return d(this.x*a,this.y*a)},toPolar:function(){return e(Math.atan(this.y/this.x),this.magnitude)}}}var e=a("./polar.js");b.exports=d},{"./polar.js":35}],46:[function(a,b,c){var d=a("dragonjs");b.exports=d.CollisionHandler({name:"racetrack",gridSize:d.Dimension(5,5)})},{dragonjs:20}],47:[function(a,b,c){(function(b){var c=a("dragonjs"),d=a("./screens/tracks/riverton.js");b.Cocoon.Utils.setAntialias(!1),c.canvas.ctx.webkitImageSmoothingEnabled=!1,c.canvas.ctx.mozImageSmoothingEnabled=!1,c.canvas.ctx.imageSmoothingEnabled=!1,c.Font.load({name:"Wonder",src:"8-bit-wonder.TTF"}),c.Game.addScreens([a("./screens/gear.js"),a("./screens/train.js"),a("./screens/care.js"),d]),c.Game.run()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./screens/care.js":53,"./screens/gear.js":54,"./screens/tracks/riverton.js":56,"./screens/train.js":57,dragonjs:20}],48:[function(a,b,c){function d(a){return a=a||{},{body:a.body||1,mind:a.mind||1,health:a.health||1,clone:function(){return d(this)}}}b.exports=d},{}],49:[function(a,b,c){b.exports={none:function(){},flu:function(a){a.speed*=.8,a.jump*=.8,a.strength*=.8},thrush:function(a){a.speed*=.2},tetanus:function(){},rainRot:function(){},swampFever:function(){}}},{}],50:[function(a,b,c){function d(a){return a=a||{},{body:a.body||1,mind:a.mind||1,temper:a.temper||1,clone:function(){return d(this)}}}b.exports=d},{}],51:[function(a,b,c){b.exports={next:{get horse(){return"clydesdale"},get jockey(){return"jimmy"}}}},{}],52:[function(a,b,c){var d=a("./sprites/horse.js"),e=a("./sprites/jockey.js");b.exports={money:100,stats:a("./shop-stats.js"),refreshStats:function(){this.horse.refreshStats(),this.jockey.refreshStats()},horse:d(),jockey:e()}},{"./shop-stats.js":58,"./sprites/horse.js":65,"./sprites/jockey.js":66}],53:[function(a,b,c){var d=a("dragonjs");b.exports=d.Screen({name:"care",spriteSet:[a("../sprites/buttons/open-gear.js"),a("../sprites/buttons/open-train.js"),a("../sprites/buttons/open-care.js"),a("../sprites/buttons/race.js")],depth:0}).extend({draw:function(a){a.fillStyle="#fde142",a.fillRect(0,0,d.canvas.width,d.canvas.height),this.base.draw(a)}})},{"../sprites/buttons/open-care.js":60,"../sprites/buttons/open-gear.js":61,"../sprites/buttons/open-train.js":62,"../sprites/buttons/race.js":63,dragonjs:20}],54:[function(a,b,c){var d=a("dragonjs");b.exports=d.Screen({name:"gear",spriteSet:[a("../sprites/buttons/open-gear.js"),a("../sprites/buttons/open-train.js"),a("../sprites/buttons/open-care.js"),a("../sprites/buttons/race.js")],depth:0}).extend({draw:function(a){a.fillStyle="#fde142",a.fillRect(0,0,d.canvas.width,d.canvas.height),this.base.draw(a)}})},{"../sprites/buttons/open-care.js":60,"../sprites/buttons/open-gear.js":61,"../sprites/buttons/open-train.js":62,"../sprites/buttons/race.js":63,dragonjs:20}],55:[function(a,b,c){(function(c){var d=a("dragonjs"),e=a("../player.js"),f=a("../util.js"),g=a("../sprites/raceresult.js"),h=a("../sprites/countdown.js");b.exports=function(b){var i=b.horses.concat(e.horse),j=f.range(i.length);return f.shuffle(j),d.Screen({name:b.name,collisionSets:[a("../collisions/racetrack.js")],spriteSet:[h].concat(i)}).extend({horses:i,start:function(){function a(d){return h.start(),function(){d>0?(h.text=d,c.setTimeout(a(d-1),1e3)):(h.text="and they're off!",c.setTimeout(function(){h.stop()},1e3),b())}}var b=this.race;i.forEach(function(a,b){a.pos.x=0,a.pos.y=45*j[b]+40,a.scale=1}),a(4)(),this.base.start()},race:function(){i.forEach(function(a){a.race()})},endRace:function(a,b){var e=this,f=a?g.win:g.lose;i.forEach(function(a){a.speed.x=0}),this.addSprites({set:f}),c.setTimeout(function(){e.removeSprite(f),d.Game.screen("riverton").stop(),d.Game.screen("train").start()},2e3)},draw:function(a){a.fillStyle="#67fb04",a.fillRect(0,0,d.canvas.width,d.canvas.height),this.base.draw(a)}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../collisions/racetrack.js":46,"../player.js":52,"../sprites/countdown.js":64,"../sprites/raceresult.js":67,"../util.js":71,dragonjs:20}],56:[function(a,b,c){var d=a("../track.js"),e=a("../../sprites/horse.js"),f=(a("../../player.js"),a("../../horse-stats.js"));b.exports=d({name:"riverton",horses:[e({stats:f({body:2})})]})},{"../../horse-stats.js":48,"../../player.js":52,"../../sprites/horse.js":65,"../track.js":55}],57:[function(a,b,c){var d=a("dragonjs"),e=a("../sprites/buttons/open-train.js"),f=a("../player.js"),g=a("../sprites/shop/ranks.js"),h=a("../sprites/shop/train-label.js"),i=a("../sprites/shop/stat-label.js"),j=a("../sprites/buttons/add-rank.js");b.exports=d.Screen({name:"train",spriteSet:[a("../sprites/buttons/open-gear.js"),e,a("../sprites/buttons/open-care.js"),a("../sprites/buttons/race.js"),j("gym",function(){f.jockey.coreStats.body+=1,f.jockey.refreshStats()}),j("coach"),j("facility",function(){f.horse.coreStats.body+=1,f.horse.refreshStats()}),j("groom"),j("doctor"),h("Gym"),h("Coach"),h("Facility"),h("Groom"),h("Doctor"),i("horse","body"),i("horse","mind"),i("horse","health"),i("jockey","body"),i("jockey","mind"),i("jockey","temper")],one:{ready:function(){this.start(),e.pause(),e.useStrip("down")}},depth:0}).extend({draw:function(a){a.fillStyle="#fde142",a.fillRect(0,0,d.canvas.width,d.canvas.height),g.draw(a),this.base.draw(a)}})},{"../player.js":52,"../sprites/buttons/add-rank.js":59,"../sprites/buttons/open-care.js":60,"../sprites/buttons/open-gear.js":61,"../sprites/buttons/open-train.js":62,"../sprites/buttons/race.js":63,"../sprites/shop/ranks.js":68,"../sprites/shop/stat-label.js":69,"../sprites/shop/train-label.js":70,dragonjs:20}],58:[function(a,b,c){var d={};b.exports={groom:d.groom||0,facility:d.facility||0,doctor:d.doctor||0,gym:d.gym||0,coach:d.coach||0}},{}],59:[function(a,b,c){var d=a("dragonjs"),e=.1*d.canvas.height,f=a("../../player.js"),g=a("../shop/ranks.js");b.exports=function(a,b){return b=b||function(){},d.ui.Button({pos:d.Point(g.pos[a].x+g.realWidth-e,g.pos[a].y-e-2),size:d.Dimension(e,e),up:{src:"buttons/plus.png",size:d.Dimension(8,8)},down:{src:"buttons/plus.null.png",size:d.Dimension(8,8)},onpress:function(){f.stats[a]<5&&(f.stats[a]+=1,b())}}).extend({update:function(){f.stats[a]<5?this.base.update():(this.useStrip("down"),this.base.base.update())}})}},{"../../player.js":52,"../shop/ranks.js":68,dragonjs:20}],60:[function(a,b,c){var d=a("dragonjs"),e=.32*d.canvas.height,f=.1;b.exports=d.ui.Button({name:"open-care",pos:d.Point(0,d.canvas.height-e),size:d.Dimension(d.canvas.width*f,e),up:{src:"buttons/care.png",size:d.Dimension(11,35)},down:{src:"buttons/care.down.png",size:d.Dimension(11,35)},onpress:function(){d.Game.screen("train").stop(),d.Game.screen("gear").stop(),d.Game.screen("care").start(),this.pause(),a("./open-gear.js").start(),a("./open-train.js").start()}}).extend({width:f,realWidth:d.canvas.width*f})},{"./open-gear.js":61,"./open-train.js":62,dragonjs:20}],61:[function(a,b,c){var d=a("dragonjs");b.exports=d.ui.Button({name:"open-gear",pos:d.Point(0,0),size:d.Dimension(.1*d.canvas.width,.32*d.canvas.height),up:{src:"buttons/gear.png",size:d.Dimension(11,35)},down:{src:"buttons/gear.down.png",size:d.Dimension(11,35)},onpress:function(){d.Game.screen("train").stop(),d.Game.screen("care").stop(),d.Game.screen("gear").start(),this.pause(),a("./open-train.js").start(),a("./open-care.js").start()}})},{"./open-care.js":60,"./open-train.js":62,dragonjs:20}],62:[function(a,b,c){var d=a("dragonjs");b.exports=d.ui.Button({name:"open-train",pos:d.Point(0,.32*d.canvas.height),size:d.Dimension(.1*d.canvas.width,.36*d.canvas.height),up:{src:"buttons/train.png",size:d.Dimension(11,43)},down:{src:"buttons/train.down.png",size:d.Dimension(11,43)},onpress:function(){d.Game.screen("gear").stop(),d.Game.screen("care").stop(),d.Game.screen("train").start(),this.pause(),a("./open-gear.js").start(),a("./open-care.js").start()}})},{"./open-care.js":60,"./open-gear.js":61,dragonjs:20}],63:[function(a,b,c){var d=a("dragonjs"),e=.18;b.exports=d.ui.Button({pos:d.Point(d.canvas.width*(1-e),0),size:d.Dimension(d.canvas.width*e,d.canvas.height),up:{src:"buttons/start-race.png",size:d.Dimension(11,35)},down:{src:"buttons/start-race.down.png",size:d.Dimension(11,35)},onpress:function(){d.Game.screen("train").stop(),d.Game.screen("gear").stop(),d.Game.screen("care").stop(),d.Game.screen("riverton").start()}}).extend({width:e,realWidth:d.canvas.width*e})},{dragonjs:20}],64:[function(a,b,c){var d=a("dragonjs"),e=a("baseclassjs");b.exports=d.ui.Label({name:"countdown",text:"-99",drawing:!1,pos:d.Point(d.canvas.width/2,d.canvas.height/2),style:function(a){a.font="16px Wonder",a.textBaseline="middle",a.textAlign="center",a.fillStyle="black"},one:{ready:e.Stub}})},{baseclassjs:2,dragonjs:20}],65:[function(a,b,c){var d=a("dragonjs"),e=a("../namer.js"),f=a("../illness.js"),g=a("../horse-stats.js");a("../shop-stats.js");b.exports=function(b){return b=b||{},d.Sprite({name:"horse",collisionSets:[a("../collisions/racetrack.js"),d.collisions],mask:d.Rectangle(d.Point(),d.Dimension(50,37)),strips:{horse:d.AnimationStrip({sheet:d.SpriteSheet({src:"horse.png"}),size:d.Dimension(50,37)})},startingStrip:"horse",on:{"collide/screenedge/right":function(){this.speed.x=0,this.scale=2,this.pos.x=d.canvas.width/2-this.trueSize().width/2,this.pos.y=d.canvas.height/2-this.trueSize().height/2,d.Game.screen("riverton").endRace(this===a("../player.js").horse,this)}}}).extend({showname:b.showname||e.next.horse,coreStats:b.stats||g(),adjStats:g(),refreshStats:function(a){var b=this.coreStats.clone();a=a||function(){},a(b),this.sickness(b),this.adjStats=b},sickness:f.none,race:function(){this.refreshStats(),this.speed.x=this.adjStats.body}})}},{"../collisions/racetrack.js":46,"../horse-stats.js":48,"../illness.js":49,"../namer.js":51,"../player.js":52,"../shop-stats.js":58,dragonjs:20}],66:[function(a,b,c){var d=a("dragonjs"),e=a("../namer.js"),f=a("../jockey-stats.js");b.exports=function(a){return a=a||{},d.Sprite({name:"jockey",strips:{jockey:d.AnimationStrip({sheet:d.SpriteSheet({src:"jockey.png"}),size:d.Dimension(64,64)})},startingStrip:"jockey",pos:d.Point(100,100),depth:2}).extend({showname:a.showname||e.next.jockey,coreStats:a.stats||f(),adjStats:f(),refreshStats:function(a){var b=this.coreStats.clone();a=a||function(){},a(b),this.adjStats=b}})}},{"../jockey-stats.js":50,"../namer.js":51,dragonjs:20}],67:[function(a,b,c){var d=a("dragonjs");b.exports={win:d.ui.Decal({strip:{src:"win.png",size:d.Dimension(50,9)},scale:3,pos:d.Point(d.canvas.width/2-75,d.canvas.height/2-12),name:"raceresult"}),lose:d.ui.Decal({strip:{src:"lost.png",size:d.Dimension(57,9)},scale:3,pos:d.Point(d.canvas.width/2-84,d.canvas.height/2-12),name:"raceresult"})}},{dragonjs:20}],68:[function(a,b,c){var d=a("dragonjs"),e=d.AnimationStrip({sheet:d.SpriteSheet({src:"icons/train-pips.png"}),size:d.Dimension(16,4),frames:6}),f=a("../../shop-stats.js"),g=a("../buttons/race.js"),h=a("../buttons/open-care.js"),i=d.canvas.width,j=d.canvas.height,k=(i-g.realWidth-h.realWidth)/2+h.realWidth,l=.3*i,m=.02*i,n=l/16,o={facility:d.Point(k-m-l,.5*j),groom:d.Point(k-m-l,.7*j),doctor:d.Point(k-m-l,.9*j),gym:d.Point(k+m,.5*j),coach:d.Point(k+m,.7*j)
};e.load(),b.exports={draw:function(a){var b;for(b in f)e.frame=f[b],e.draw(a,o[b],d.Dimension(n,3))},pos:o,realWidth:l,realHeight:12}},{"../../shop-stats.js":58,"../buttons/open-care.js":60,"../buttons/race.js":63,dragonjs:20}],69:[function(a,b,c){var d=a("dragonjs"),e=a("../../player.js"),f=a("../buttons/race.js"),g=a("../buttons/open-care.js"),h=d.canvas.width,i=d.canvas.height,j=((h-f.realWidth-g.realWidth)/2+g.realWidth,.01*h),k={horse:{body:{name:"Body",pos:d.Point(g.realWidth+j,.1*i),side:"left"},mind:{name:"Mind",pos:d.Point(g.realWidth+j,.2*i),side:"left"},health:{name:"Health",pos:d.Point(g.realWidth+j,.3*i),side:"left"}},jockey:{body:{name:"Body",pos:d.Point(f.pos.x-j,.1*i),side:"right"},mind:{name:"Mind",pos:d.Point(f.pos.x-j,.2*i),side:"right"},temper:{name:"Temper",pos:d.Point(f.pos.x-j,.3*i),side:"right"}}};b.exports=function(a,b){return d.ui.Label({text:k[a][b].name+" "+e[a].adjStats[b],pos:k[a][b].pos,style:function(c){c.font="12px Wonder",c.textBaseline="bottom",c.textAlign=k[a][b].side,c.fillStyle="black"}}).extend({update:function(){this.text=k[a][b].name+" "+e[a].adjStats[b]}})}},{"../../player.js":52,"../buttons/open-care.js":60,"../buttons/race.js":63,dragonjs:20}],70:[function(a,b,c){var d=a("dragonjs"),e=.1*d.canvas.height,f=a("./ranks.js");b.exports=function(a){var b=a.toLowerCase();return d.ui.Label({text:a,pos:d.Point(f.pos[b].x+f.realWidth-e,f.pos[b].y-5),style:function(a){a.font="16px Wonder",a.textBaseline="bottom",a.textAlign="right",a.fillStyle="black"}})}},{"./ranks.js":68,dragonjs:20}],71:[function(a,b,c){b.exports={shuffle:function(a){var b,c,d;for(b=0;b<a.length;b+=1)c=parseInt(Math.random()*(b+1)),d=a[b],a[b]=a[c],a[c]=d;return a},range:function(a,b){var c,d,e=[];for(b||(b=a,a=0),d=b-a,c=0;d>c;c+=1)e.push(c+a);return e}}},{}]},{},[47,48,49,50,51,52,58,71]);