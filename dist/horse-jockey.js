(function(){Cocoon=window.Cocoon?window.Cocoon:{};Cocoon.version="3.0.5";Cocoon.nativeAvailable=!!window.ext;Cocoon.extend=function(a,b){var c=a.prototype;var d=function(){};d.prototype=b.prototype;a.prototype=new d;a.superclass=b.prototype;a.prototype.constructor=a;if(b.prototype.constructor===Object.prototype.constructor){b.prototype.constructor=b}for(var e in c){if(c.hasOwnProperty(e)){a.prototype[e]=c[e]}}};Cocoon.clone=function(a,b){if(null==a||"object"!=typeof a)return a;var c=[];for(var d in a){if(b.hasOwnProperty(d)){c.push(b[d])}else{c.push(a[d])}}return c};Cocoon.callNative=function(a,b,c,d){if(Cocoon.nativeAvailable){var e=Array.prototype.slice.call(c);e.unshift(b);var f=ext[a];var g=d?f.makeCallAsync:f.makeCall;var h=g.apply(f,e);var i=h;if(typeof h==="string"){try{i=JSON.parse(h)}catch(j){console.log(j)}}return i}};Cocoon.getObjectFromPath=function(a,b){var c=b.split(".");var d=a;for(var e=0,f=c.length;e<f;++e){d[c[e]]=d[c[e]]||undefined;d=d[c[e]]}return d};Cocoon.EventHandler=function(a,b,c,d){this.listeners=[];this.listenersOnce=[];this.chainFunction=d;this.addEventListener=function(e){if(d){var f=function(){d.call(this,arguments.callee.sourceListener,Array.prototype.slice.call(arguments))};e.CocoonEventHandlerChainFunction=f;f.sourceListener=e;e=f}var g=Cocoon.getObjectFromPath(Cocoon,b);if(g&&g.nativeAvailable){ext[a].addEventListener(c,e)}else{var h=this.listeners.indexOf(e);if(h<0){this.listeners.push(e)}}};this.addEventListenerOnce=function(e){if(d){var f=function(){d(arguments.callee.sourceListener,Array.prototype.slice.call(arguments))};f.sourceListener=e;e=f}var g=Cocoon.getObjectFromPath(Cocoon,b);if(g.nativeAvailable){ext[a].addEventListenerOnce(c,e)}else{var h=this.listeners.indexOf(e);if(h<0){this.listenersOnce.push(e)}}};this.removeEventListener=function(e){if(d){e=e.CocoonEventHandlerChainFunction;delete e.CocoonEventHandlerChainFunction}var f=Cocoon.getObjectFromPath(Cocoon,b);if(f.nativeAvailable){ext[a].removeEventListener(c,e)}else{var g=this.listeners.indexOf(e);if(g>=0){this.listeners.splice(g,1)}}};this.removeEventListenerOnce=function(e){if(d){e=e.CocoonEventHandlerChainFunction;delete e.CocoonEventHandlerChainFunction}var f=Cocoon.getObjectFromPath(Cocoon,b);if(f.nativeAvailable){ext[a].removeEventListenerOnce(c,e)}else{var g=this.listenersOnce.indexOf(e);if(g>=0){this.listenersOnce.splice(g,1)}}};this.notifyEventListeners=function(){var d=Cocoon.getObjectFromPath(Cocoon,b);if(d&&d.nativeAvailable){ext[a].notifyEventListeners(c)}else{var e=Array.prototype.slice.call(arguments);var f=Array.prototype.slice.call(this.listeners);var g=Array.prototype.slice.call(this.listenersOnce);var h=this;setTimeout(function(){for(var a=0;a<f.length;a++){f[a].apply(h,e)}for(var a=0;a<g.length;a++){g[a].apply(h,e)}},0);h.listenersOnce=[]}};return this};Cocoon.define=function(a,b){var c=a.substring(0,7)=="Cocoon."?a.substr(7):a;var d=window.Cocoon;var e=c.split(".");var f=d;for(var g=0;g<e.length;g++){var h=e[g];!f[h]?console.log("Created namespace: "+a):console.log("Updated namespace: - "+a);f=f[h]=g==e.length-1?b(f[h]||{}):{};if(!f){throw"Unable to create class "+a}}return true};console.log("Created namespace: Cocoon")})();Cocoon.define("Cocoon.Signal",function(a){"use strict";a.createSignal=function(){this.handle=null;this.signals={};this.register=function(a,b){if(!a&&!b)throw new Error("Can't create signal "+(a||""));if(b.addEventListener){this.signals[a]=b;return true}if(!b.addEventListener){this.signals[a]={};for(var c in b){if(b.hasOwnProperty(c)){this.signals[a][c]=b[c]}}return true}throw new Error("Can't create handler for "+a+" signal.");return false},this.expose=function(){return function(a,b,c){var d=false;if(arguments.length===1){var e=this;var f=function(a){this.signal=a};f.prototype.remove=function(a){var b=e.signals[this.signal];if(b&&b.removeEventListener){b.removeEventListener.apply(e,[a]);e.signals[this.signal]=undefined}};return new f(a)}if(c&&c.once){d=true}if(!this.signals[a])throw new Error("The signal "+a+" does not exists.");var g=this.signals[a];if(g.addEventListener){if(d){g.addEventListenerOnce(function(){b.apply(this||window,arguments)})}else{g.addEventListener(function(){b.apply(this||window,arguments)})}}if(!this.signals[a].addEventListener){for(var h in this.signals[a]){if(!this.signals[a].hasOwnProperty(h))continue;var g=this.signals[a][h];if(d){g.addEventListenerOnce(function(){this.clbk[this.name].apply(this||window,arguments)}.bind({name:h,clbk:b}))}else{g.addEventListener(function(){this.clbk[this.name].apply(this||window,arguments)}.bind({name:h,clbk:b}))}}}}.bind(this)}};return a});Cocoon.define("Cocoon.App",function(a){a.nativeAvailable=!!window.ext&&!!window.ext.IDTK_APP;a.isBridgeAvailable=function(){if(Cocoon.App.forward.nativeAvailable==="boolean"){return Cocoon.App.forward.nativeAvailable}else{var a=Cocoon.callNative("IDTK_APP","forwardAvailable",arguments);a=!!a;Cocoon.App.forward.nativeAvailable=a;return a}};a.forward=function(a){if(Cocoon.App.nativeAvailable&&Cocoon.App.isBridgeAvailable()){return Cocoon.callNative("IDTK_APP","forward",arguments)}else if(!navigator.isCocoonJS){if(window.name=="CocoonJS_App_ForCocoonJS_WebViewIFrame"){return window.parent.eval(a)}else{return window.frames["CocoonJS_App_ForCocoonJS_WebViewIFrame"].window.eval(a)}}};a.forwardAsync=function(a,b){if(Cocoon.App.nativeAvailable&&Cocoon.App.isBridgeAvailable()){if(typeof b!=="undefined"){return ext.IDTK_APP.makeCallAsync("forward",a,b)}else{return ext.IDTK_APP.makeCallAsync("forward",a)}}else{setTimeout(function(){var c;window.name=="CocoonJS_App_ForCocoonJS_WebViewIFrame"?(c=window.parent.eval(a),typeof b==="function"&&b(c)):(c=window.parent.frames["CocoonJS_App_ForCocoonJS_WebViewIFrame"].window.eval(a),typeof b==="function"&&b(c))},1)}};a.load=function(a,b){if(Cocoon.App.nativeAvailable){return Cocoon.callNative("IDTK_APP","loadPath",arguments)}else if(!navigator.isCocoonJS){var c=new XMLHttpRequest;c.onreadystatechange=function(b){if(c.readyState===4){if(c.status===200){var d;if(!Cocoon.App.EmulatedWebViewIFrame){d="window.Cocoon && window.Cocoon.App.onLoadInTheWebViewSucceed.notifyEventListeners('"+a+"');"}else{d="window.Cocoon && window.Cocoon.App.onLoadInCocoonJSSucceed.notifyEventListeners('"+a+"');"}Cocoon.App.forwardAsync(d);window.location.href=a}else if(c.status===404){this.onreadystatechange=null;var d;if(!Cocoon.App.EmulatedWebViewIFrame){d="Cocoon && Cocoon.App.onLoadInTheWebViewFailed.notifyEventListeners('"+a+"');"}else{d="Cocoon && Cocoon.App.onLoadInCocoonJSFailed.notifyEventListeners('"+a+"');"}Cocoon.App.forwardAsync(d)}}};c.open("GET",a,true);c.send()}};a.reload=function(){if(Cocoon.App.nativeAvailable){return Cocoon.callNative("IDTK_APP","reload",arguments)}else if(!navigator.isCocoonJS){if(window.name=="CocoonJS_App_ForCocoonJS_WebViewIFrame"){return window.parent.location.reload()}else{return window.parent.frames["CocoonJS_App_ForCocoonJS_WebViewIFrame"].window.location.reload()}}};a.openURL=function(a){if(Cocoon.App.nativeAvailable){return Cocoon.callNative("IDTK_APP","openURL",arguments,true)}else if(!navigator.isCocoonJS){window.open(a,"_blank")}};a.exit=function(){if(Cocoon.App.nativeAvailable){return Cocoon.callNative("IDTK_APP","forceToFinish",arguments)}else if(!navigator.isCocoonJS){window.close()}};a.StorageType={APP_STORAGE:"APP_STORAGE",INTERNAL_STORAGE:"INTERNAL_STORAGE",EXTERNAL_STORAGE:"EXTERNAL_STORAGE",TEMPORARY_STORAGE:"TEMPORARY_STORAGE"};a.onSuspended=new Cocoon.EventHandler("IDTK_APP","App","onsuspended");a.onActivated=new Cocoon.EventHandler("IDTK_APP","App","onactivated");a.onSuspending=new Cocoon.EventHandler("IDTK_APP","App","onsuspending");a.onMemoryWarning=new Cocoon.EventHandler("IDTK_APP","App","onmemorywarning");var b=new Cocoon.Signal.createSignal;b.register("suspended",a.onSuspended);b.register("activated",a.onActivated);b.register("suspending",a.onSuspending);b.register("memorywarning",a.onMemoryWarning);a.on=b.expose();return a});Cocoon.define("Cocoon.App",function(a){function b(){var a=Cocoon.App.EmulatedWebView;if(a){return}a=document.createElement("div");a.setAttribute("id","CocoonJS_App_ForCocoonJS_WebViewDiv");a.style.width=0;a.style.height=0;a.style.position="absolute";a.style.left=0;a.style.top=0;a.style.backgroundColor="transparent";a.style.border="0px solid #000";var b=document.createElement("IFRAME");b.setAttribute("id","CocoonJS_App_ForCocoonJS_WebViewIFrame");b.setAttribute("name","CocoonJS_App_ForCocoonJS_WebViewIFrame");b.style.width=0;b.style.height=0;b.frameBorder=0;b.allowtransparency=true;a.appendChild(b);Cocoon.App.EmulatedWebView=a;Cocoon.App.EmulatedWebViewIFrame=b;if(!document.body){document.body=document.createElement("body")}document.body.appendChild(Cocoon.App.EmulatedWebView)}a.pause=function(){if(Cocoon.App.nativeAvailable){return Cocoon.callNative("IDTK_APP","pause",arguments)}};a.resume=function(){if(Cocoon.App.nativeAvailable){return Cocoon.callNative("IDTK_APP","resume",arguments)}};a.loadInTheWebView=function(a,c){if(navigator.isCocoonJS&&Cocoon.App.nativeAvailable){Cocoon.callNative("IDTK_APP","loadInTheWebView",arguments)}else{var d=new XMLHttpRequest;d.onreadystatechange=function(c){if(d.readyState===4){if(d.status>=200&&d.status<=299||d.status===0){b();var e=function(b){Cocoon.App.onLoadInTheWebViewSucceed.notifyEventListeners(a);Cocoon.App.EmulatedWebViewIFrame.removeEventListener("load",e)};Cocoon.App.EmulatedWebViewIFrame.addEventListener("load",e);Cocoon.App.EmulatedWebViewIFrame.contentWindow.location.href=a}else{this.onreadystatechange=null;Cocoon.App.onLoadInTheWebViewFailed.notifyEventListeners(a)}}};d.open("GET",a,true);d.send()}};a.reloadWebView=function(){if(Cocoon.App.nativeAvailable&&navigator.isCocoonJS){Cocoon.callNative("IDTK_APP","reloadWebView",arguments)}else{b();Cocoon.App.EmulatedWebViewIFrame.contentWindow.location.reload()}};a.showTheWebView=function(a,c,d,e){if(Cocoon.App.nativeAvailable&&navigator.isCocoonJS){Cocoon.callNative("IDTK_APP","showTheWebView",arguments)}else{b();Cocoon.App.EmulatedWebViewIFrame.style.width=(d?d/window.devicePixelRatio:window.innerWidth)+"px";Cocoon.App.EmulatedWebViewIFrame.style.height=(e?e/window.devicePixelRatio:window.innerHeight)+"px";Cocoon.App.EmulatedWebView.style.left=(a?a:0)+"px";Cocoon.App.EmulatedWebView.style.top=(c?c:0)+"px";Cocoon.App.EmulatedWebView.style.width=(d?d/window.devicePixelRatio:window.innerWidth)+"px";Cocoon.App.EmulatedWebView.style.height=(e?e/window.devicePixelRatio:window.innerHeight)+"px";Cocoon.App.EmulatedWebView.style.display="block"}};a.hideTheWebView=function(){if(Cocoon.App.nativeAvailable&&navigator.isCocoonJS){var a="ext.IDTK_APP.makeCall('hide');";return Cocoon.App.forwardAsync(a)}else{b();Cocoon.App.EmulatedWebView.style.display="none"}};a.exitCallback=function(a){if(navigator.isCocoonJS&&Cocoon.App.nativeAvailable){window.onidtkappfinish=a}};a.forwardedEventFromTheWebView=function(a,b){var c=JSON.parse(b);c.target=window;var d=new Event(a);for(var e in c){d[e]=c[e]}d.target=window;window.dispatchEvent(d);var f=document.getElementsByTagName("canvas");for(var g=0;g<f.length;g++){d.target=f[g];f[g].dispatchEvent(d)}};a.onLoadInTheWebViewSucceed=new Cocoon.EventHandler("IDTK_APP","App","forwardpageload");a.onLoadInTheWebViewFailed=new Cocoon.EventHandler("IDTK_APP","App","forwardpagefail");var c=new Cocoon.Signal.createSignal;c.register("load",{success:a.onLoadInTheWebViewSucceed,error:a.onLoadInTheWebViewFailed});a.WebView=Cocoon.WebView||{};a.WebView.on=c.expose();return a});Cocoon.define("Cocoon.Utils",function(a){"use strict";a.logMemoryInfo=function(){if(Cocoon.nativeAvailable&&navigator.isCocoonJS){return Cocoon.callNative("IDTK_APP","logMemoryInfo",arguments)}};a.textureReduction=function(a,b,c){if(Cocoon.nativeAvailable&&navigator.isCocoonJS){return Cocoon.callNative("IDTK_APP","setDefaultTextureReducerThreshold",arguments)}};a.markAsMusic=function(a){if(Cocoon.nativeAvailable){return Cocoon.callNative("IDTK_APP","addForceMusic",arguments)}};a.captureScreen=function(a,b,c,d){if(Cocoon.nativeAvailable){return Cocoon.callNative("IDTK_APP","captureScreen",arguments)}};a.captureScreenAsync=function(a,b,c,d,e){if(Cocoon.nativeAvailable){Cocoon.callNative("IDTK_APP","captureScreen",arguments,true)}};a.setAntialias=function(a){if(Cocoon.nativeAvailable&&navigator.isCocoonJS){return Cocoon.callNative("IDTK_APP","setDefaultAntialias",arguments)}};a.setWebGLEnabled=function(a){if(Cocoon.nativeAvailable){return Cocoon.callNative("IDTK_APP","setDefaultAntialias",arguments)}};a.setNPOTEnabled=function(a){if(Cocoon.nativeAvailable&&navigator.isCocoonJS){return window.ext.IDTK_APP.makeCall("setNPOTEnabled",a)}};a.setMaxMemory=function(a){if(Cocoon.nativeAvailable&&navigator.isCocoonJS){return window.ext.IDTK_APP.makeCall("setMaxMemory",a)}};a.CaptureType={EVERYTHING:0,COCOONJS_GL_SURFACE:1,JUST_SYSTEM_VIEWS:2};a.existsPath=function(a,b){if(Cocoon.nativeAvailable){return Cocoon.callNative("IDTK_APP","existsPath",arguments)}return false};a.setTextCacheSize=function(a){if(Cocoon.nativeAvailable&&navigator.isCocoonJS){return Cocoon.callNative("IDTK_APP","setTextCacheSize",arguments)}};return a});Cocoon.define("Cocoon.Dialog",function(a){"use strict";a.keyboardType={TEXT:"text",NUMBER:"num",PHONE:"phone",EMAIL:"email",URL:"url"};a.prompt=function(a,b){if(!b)throw"Callback missing for Cocoon.Dialog.prompt();";var c=Cocoon.Dialog.keyboardType.TEXT;switch(a.type){case Cocoon.Dialog.keyboardType.TEXT:c=Cocoon.Dialog.keyboardType.TEXT;break;case Cocoon.Dialog.keyboardType.NUMBER:c=Cocoon.Dialog.keyboardType.NUMBER;break;case Cocoon.Dialog.keyboardType.PHONE:c=Cocoon.Dialog.keyboardType.PHONE;break;case Cocoon.Dialog.keyboardType.EMAIL:c=Cocoon.Dialog.keyboardType.EMAIL;break;case Cocoon.Dialog.keyboardType.URL:c=Cocoon.Dialog.keyboardType.URL;break}var d={title:"",message:"",text:"",type:c,cancelText:"Cancel",confirmText:"Ok"};var e=Cocoon.clone(d,a);var f=function(){Cocoon.Dialog.onTextDialogCancelled.removeEventListener(g);Cocoon.Dialog.onTextDialogFinished.removeEventListener(f);b.success.apply(window,Array.prototype.slice.call(arguments))};var g=function(){Cocoon.Dialog.onTextDialogCancelled.removeEventListener(g);Cocoon.Dialog.onTextDialogFinished.removeEventListener(f);b.cancel.apply(window,Array.prototype.slice.call(arguments))};Cocoon.Dialog.onTextDialogCancelled.addEventListener(g);Cocoon.Dialog.onTextDialogFinished.addEventListener(f);if(Cocoon.App.nativeAvailable){return Cocoon.callNative("IDTK_APP","showTextDialog",e,true)}else{setTimeout(function(){var a=prompt(d.message,d.text);var b=a?Cocoon.Dialog.onTextDialogFinished:Cocoon.Dialog.onTextDialogCancelled;b.notifyEventListeners(a)},0)}};a.confirm=function(a,b){if(!b)throw"Callback missing for Cocoon.Dialog.confirm();";var c={title:"",message:"",cancelText:"Cancel",confirmText:"Ok"};var d=Cocoon.clone(c,a);var e=function(){Cocoon.Dialog.onMessageBoxDenied.removeEventListenerOnce(f);b(true)};var f=function(){Cocoon.Dialog.onMessageBoxConfirmed.removeEventListenerOnce(e);b(false)};Cocoon.Dialog.onMessageBoxDenied.addEventListenerOnce(f);Cocoon.Dialog.onMessageBoxConfirmed.addEventListenerOnce(e);if(Cocoon.nativeAvailable){return Cocoon.callNative("IDTK_APP","showMessageBox",d,true)}else{setTimeout(function(){var a=confirm(c.message);var b=a?Cocoon.Dialog.onMessageBoxConfirmed:Cocoon.Dialog.onMessageBoxDenied;b.notifyEventListeners()},0)}};a.showKeyboard=function(a,b){a=a||{};a.type=a.type||Cocoon.Dialog.keyboardType.TEXT;var c=b&&b.insertText;var d=b&&b.deleteBackward;var e=b&&b.done;var f=b&&b.cancel;if(Cocoon.nativeAvailable){Cocoon.callNative("IDTK_APP","showKeyboard",[a,c,d,e,f],true)}};a.dismissKeyboard=function(){if(Cocoon.nativeAvailable){Cocoon.callNative("IDTK_APP","dismissKeyboard",[],true)}};a.onTextDialogFinished=new Cocoon.EventHandler("IDTK_APP","App","ontextdialogfinish");a.onTextDialogCancelled=new Cocoon.EventHandler("IDTK_APP","App","ontextdialogcancel");a.onMessageBoxConfirmed=new Cocoon.EventHandler("IDTK_APP","App","onmessageboxconfirmed");a.onMessageBoxDenied=new Cocoon.EventHandler("IDTK_APP","App","onmessageboxdenied");return a});Cocoon.define("Cocoon.WebView",function(a){if(typeof Cocoon==="undefined"||Cocoon===null)return a;if(typeof Cocoon.App==="undefined"||Cocoon.App===null)return a;if(navigator.isCocoonJS)return a;a.show=function(a,b,c,d){if(Cocoon.App.nativeAvailable){return Cocoon.callNative("IDTK_APP","show",arguments)}else{var e=window.parent.document.getElementById("CocoonJS_App_ForCocoonJS_WebViewDiv");e.style.left=(a?a:e.style.left)+"px";e.style.top=(b?b:e.style.top)+"px";e.style.width=(c?c/window.devicePixelRatio:window.parent.innerWidth)+"px";e.style.height=(d?d/window.devicePixelRatio:window.parent.innerHeight)+"px";e.style.display="block";var f=window.parent.document.getElementById("CocoonJS_App_ForCocoonJS_WebViewIFrame");f.style.width=(c?c/window.devicePixelRatio:window.parent.innerWidth)+"px";f.style.height=(d?d/window.devicePixelRatio:window.parent.innerHeight)+"px"}};a.hide=function(){if(Cocoon.App.nativeAvailable){return Cocoon.callNative("IDTK_APP","hide",arguments)}else{window.parent.document.getElementById("CocoonJS_App_ForCocoonJS_WebViewDiv").style.display="none"}};a.loadInCocoon=function(a,b,c){if(Cocoon.App.nativeAvailable){var d="ext.IDTK_APP.makeCall('loadPath'";if(typeof a!=="undefined"){d+=", '"+a+"'";if(typeof c!=="undefined"){d+=", '"+c+"'"}}d+=");";return Cocoon.App.forwardAsync(d)}else{Cocoon.App.forwardAsync("Cocoon.App.load('"+a+"');")}};a.reloadCocoonJS=function(){if(Cocoon.App.nativeAvailable){return Cocoon.App.forwardAsync("ext.IDTK_APP.makeCall('reload');")}else if(!navigator.isCocoonJS){window.parent.location.reload()}};window.addEventListener("load",function(){if(!Cocoon.App.nativeAvailable&&window.name=="CocoonJS_App_ForCocoonJS_WebViewIFrame"){Cocoon.App.forwardEventsToCocoonJSEnabled=false;var a=["timeStamp","button","type","x","y","pageX","pageY","clientX","clientY","offsetX","offsetY"];var b=["dblclick","touchmove","mousemove","touchend","touchcancel","mouseup","touchstart","mousedown","release","dragleft","dragright","swipeleft","swiperight"];function c(b,c){var d={};var e,f;for(var e in c){f=a.indexOf(e);if(f>=0){d[e]=c[e]}}var g="Cocoon && Cocoon.App && Cocoon.App.forwardedEventFromTheWebView && Cocoon.App.forwardedEventFromTheWebView("+JSON.stringify(b)+", '"+JSON.stringify(d)+"');";Cocoon.App.forward(g)}for(i=0;i<b.length;i++){window.addEventListener(b[i],function(a){return function(b){if(Cocoon.App.forwardEventsToCocoonJSEnabled){c(a,b)}}}(b[i]))}}});a.onLoadInCocoonJSSucceed=new Cocoon.EventHandler("IDTK_APP","App","forwardpageload");a.onLoadInCocoonJSFailed=new Cocoon.EventHandler("IDTK_APP","App","forwardpagefail");return a});Cocoon.define("Cocoon.Proxify",function(a){"use strict";a.getKeyForValueInDictionary=function(a,b){var c=null;for(var d in a){if(a[d]===b){c=d;break}}return c};a.setupOriginProxyType=function(b,c,d,e){if(Cocoon.nativeAvailable){if(!b)throw"The given typeName must be valid.";if(!c&&!d&&!e)throw"There is no point on setting up a proxy for no attributes, functions nor eventHandlers.";c=c?c:[];d=d?d:[];e=e?e:[];var f=window;var g="Cocoon.Proxify.setupDestinationProxyType("+JSON.stringify(b)+", "+JSON.stringify(e)+");";Cocoon.App.forward(g);var h=f[b];f[b]=function(){var a=this;this._cocoonjs_proxy_object_data={};var g="Cocoon.Proxify.newDestinationProxyObject("+JSON.stringify(b)+");";this._cocoonjs_proxy_object_data.id=Cocoon.App.forward(g);this._cocoonjs_proxy_object_data.eventHandlers={};this._cocoonjs_proxy_object_data.typeName=b;this._cocoonjs_proxy_object_data.eventListeners={};f[b]._cocoonjs_proxy_type_data.proxyObjects[this._cocoonjs_proxy_object_data.id]=this;for(var h=0;h<c.length;h++){(function(c){a.__defineSetter__(c,function(d){var e="Cocoon.Proxify.setDestinationProxyObjectAttribute("+JSON.stringify(b)+", "+a._cocoonjs_proxy_object_data.id+", "+JSON.stringify(c)+", "+JSON.stringify(d)+");";return Cocoon.App.forward(e)});a.__defineGetter__(c,function(){var d="Cocoon.Proxify.getDestinationProxyObjectAttribute("+JSON.stringify(b)+", "+a._cocoonjs_proxy_object_data.id+", "+JSON.stringify(c)+");";return Cocoon.App.forward(d)})})(c[h])}for(var h=0;h<d.length;h++){(function(c){a[c]=function(){var a=Array.prototype.slice.call(arguments);a.unshift(c);a.unshift(this._cocoonjs_proxy_object_data.id);a.unshift(b);var d="Cocoon.Proxify.callDestinationProxyObjectFunction(";for(var e=0;e<a.length;e++){d+=(e!==1?JSON.stringify(a[e]):a[e])+(e<a.length-1?", ":"")}d+=");";var f=Cocoon.App.forwardAsync(d);return f}})(d[h])}for(var h=0;h<e.length;h++){(function(b){a.__defineSetter__(b,function(c){a._cocoonjs_proxy_object_data.eventHandlers[b]=c});a.__defineGetter__(b,function(){return a._cocoonjs_proxy_object_data.eventHandlers[b]})})(e[h])}a.addEventListener=function(b,c){var d=true;var e=a._cocoonjs_proxy_object_data.eventListeners[b];if(e){d=e.indexOf(c)<0}else{e=[];a._cocoonjs_proxy_object_data.eventListeners[b]=e;var f="Cocoon.Proxify.addDestinationProxyObjectEventListener("+JSON.stringify(a._cocoonjs_proxy_object_data.typeName)+", "+a._cocoonjs_proxy_object_data.id+", "+JSON.stringify(b)+");";Cocoon.App.forwardAsync(f)}if(d){e.push(c)}};a.removeEventListener=function(b,c){var d=a._cocoonjs_proxy_object_data.eventListeners[b];if(d){var e=d.indexOf(c);if(e>=0){d.splice(e,1)}}};return this};f[b]._cocoonjs_proxy_type_data={originalType:h,proxyObjects:[]};f[b]._cocoonjs_proxy_type_data.deleteProxyObject=function(c){var d=a.getKeyForValueInDictionary(this.proxyObjects,c);if(d){var e="Cocoon.Proxify.deleteDestinationProxyObject("+JSON.stringify(b)+", "+c._cocoonjs_proxy_object_data.id+");";Cocoon.App.forwardAsync(e);c._cocoonjs_proxy_object_data=null;delete this.proxyObjects[d]}};f[b]._cocoonjs_proxy_type_data.callProxyObjectEventHandler=function(a,b){var c=this.proxyObjects[a];var d=c._cocoonjs_proxy_object_data.eventHandlers[b];if(d){d({target:c})}};f[b]._cocoonjs_proxy_type_data.callProxyObjectEventListeners=function(a,b){var c=this.proxyObjects[a];var d=c._cocoonjs_proxy_object_data.eventListeners[b].slice();for(var e=0;e<d.length;e++){d[e]({target:c})}}}};a.takedownOriginProxyType=function(a){if(Cocoon.App.nativeAvailable){var b=window;if(b[a]&&b[a]._cocoonjs_proxy_type_data){b[a]=b[a]._cocoonjs_proxy_type_data.originalType}}};a.deleteOriginProxyObject=function(a){if(Cocoon.App.nativeAvailable){var b=window;if(a&&a._cocoonjs_proxy_object_data){b[a._cocoonjs_proxy_object_data.typeName]._cocoonjs_proxy_type_data.deleteProxyObject(a)}}};a.callOriginProxyObjectEventHandler=function(a,b,c){if(Cocoon.App.nativeAvailable){var d=window;d[a]._cocoonjs_proxy_type_data.callProxyObjectEventHandler(b,c)}};a.callOriginProxyObjectEventListeners=function(a,b,c){if(Cocoon.App.nativeAvailable){var d=window;d[a]._cocoonjs_proxy_type_data.callProxyObjectEventListeners(b,c)}};a.setupDestinationProxyType=function(a,b){if(Cocoon.App.nativeAvailable){var c=window;c[a]._cocoonjs_proxy_type_data={nextId:0,proxyObjects:{},eventHandlerNames:b}}};a.takedownDestinationProxyType=function(a){if(Cocoon.App.nativeAvailable){var b=window;if(parent[a]&&b[a]._cocoonjs_proxy_type_data){delete b[a]._cocoonjs_proxy_type_data}}};a.newDestinationProxyObject=function(a){if(Cocoon.App.nativeAvailable){var b=window;var c=new b[a];c._cocoonjs_proxy_object_data={};c._cocoonjs_proxy_object_data.typeName=a;var d=b[a]._cocoonjs_proxy_type_data.nextId;b[a]._cocoonjs_proxy_type_data.proxyObjects[d]=c;c._cocoonjs_proxy_object_data.id=d;b[a]._cocoonjs_proxy_type_data.nextId++;for(var e=0;e<b[a]._cocoonjs_proxy_type_data.eventHandlerNames.length;e++){(function(a){c[a]=function(b){var c=this;var d="Cocoon.App.callOriginProxyObjectEventHandler("+JSON.stringify(c._cocoonjs_proxy_object_data.typeName)+", "+c._cocoonjs_proxy_object_data.id+", "+JSON.stringify(a)+");";Cocoon.App.forwardAsync(d)}})(b[a]._cocoonjs_proxy_type_data.eventHandlerNames[e])}c._cocoonjs_proxy_object_data.eventListeners={};return d}};a.callDestinationProxyObjectFunction=function(a,b,c){if(Cocoon.App.nativeAvailable){var d=window;var e=Array.prototype.slice.call(arguments);e.splice(0,3);var f=d[a]._cocoonjs_proxy_type_data.proxyObjects[b];var g=f[c].apply(f,e);return g}};a.setDestinationProxyObjectAttribute=function(a,b,c,d){if(Cocoon.App.nativeAvailable){var e=window;var f=e[a]._cocoonjs_proxy_type_data.proxyObjects[b];f[c]=d}};a.getDestinationProxyObjectAttribute=function(a,b,c){if(Cocoon.App.nativeAvailable){var d=window;var e=d[a]._cocoonjs_proxy_type_data.proxyObjects[b];return e[c]}};a.deleteDestinationProxyObject=function(a,b){if(Cocoon.App.nativeAvailable){var c=window;delete c[a]._cocoonjs_proxy_type_data.proxyObjects[b]}};a.addDestinationProxyObjectEventListener=function(a,b,c){if(Cocoon.App.nativeAvailable){var d=window;var e=d[a]._cocoonjs_proxy_type_data.proxyObjects[b];var f=function(a){var b=this;var d="Cocoon.Proxify.callOriginProxyObjectEventListeners("+JSON.stringify(b._cocoonjs_proxy_object_data.typeName)+", "+b._cocoonjs_proxy_object_data.id+", "+JSON.stringify(c)+");";Cocoon.App.forwardAsync(d)};e._cocoonjs_proxy_object_data.eventListeners[c]=f;e.addEventListener(c,f)}};a.xhr=function(){var a=["timeout","withCredentials","upload","status","statusText","responseType","response","responseText","responseXML","readyState"];var b=["open","setRequestHeader","send","abort","getResponseHeader","getAllResponseHeaders","overrideMimeType"];var c=["onloadstart","onprogress","onabort","onerror","onload","ontimeout","onloadend","onreadystatechange"];Cocoon.Proxify.setupOriginProxyType("XMLHttpRequest",a,b,c)};a.audio=function(){var a=["src","loop","volume","preload"];var b=["play","pause","load","canPlayType"];var c=["onended","oncanplay","oncanplaythrough","onerror"];Cocoon.Proxify.setupOriginProxyType("Audio",a,b,c)};a.console=function(){if(!Cocoon.nativeAvailable)return;if(typeof Cocoon.originalConsole==="undefined"){Cocoon.originalConsole=window.console}var a=["log","error","info","debug","warn"];var b={};for(var c=0;c<a.length;c++){b[a[c]]=function(a){return function(a){try{var b="Proxified log: "+JSON.stringify(a);Cocoon.originalConsole.log(b);ext.IDTK_APP.makeCallAsync("forward",b)}catch(c){console.log("Proxified log: "+c)}}}(a[c])}if(!b.assert){b.assert=function d(){if(arguments.length>0&&!arguments[0]){var a="Assertion failed: "+(arguments.length>1?arguments[1]:"");b.error(a)}}}window.console=b};a.deproxifyConsole=function(){if(window.navigator.isCocoonJS||!Cocoon.nativeAvailable)return;if(typeof Cocoon.originalConsole!=="undefined"){window.console=Cocoon.originalConsole;Cocoon.originalConsole=undefined}};return a});Cocoon.define("Cocoon.Device",function(a){"use strict";a.DeviceInfo={os:null,version:null,dpi:null,brand:null,model:null,imei:null,platformId:null,odin:null,openudid:null};a.getDeviceId=function(){if(Cocoon.nativeAvailable){return window.ext.IDTK_APP.makeCall("getDeviceId")}};a.getDeviceInfo=function(){if(Cocoon.nativeAvailable){return window.ext.IDTK_APP.makeCall("getDeviceInfo")}};a.getOrientation=function(){if(Cocoon.nativeAvailable){return window.ext.IDTK_APP.makeCall("getPreferredOrientation")}else{return 0}};a.setOrientation=function(a){if(Cocoon.nativeAvailable){window.ext.IDTK_APP.makeCall("setPreferredOrientation",a)}};a.Orientations={PORTRAIT:1,PORTRAIT_UPSIDE_DOWN:2,LANDSCAPE_LEFT:4,LANDSCAPE_RIGHT:8,LANDSCAPE:4|8,BOTH:1|2|4|8};a.autoLock=function(a){if(Cocoon.nativeAvailable){return Cocoon.callNative("IDTK_APP","setAutoLockEnabled",arguments)}};return a});Cocoon.define("Cocoon.Motion",function(a){"use strict";a.nativeAvailable=Cocoon.nativeAvailable;a.setAccelerometerInterval=function(a){if(Cocoon.Motion.nativeAvailable){return window.ext.IDTK_APP.makeCall("setAccelerometerUpdateIntervalInSeconds",a)}};a.getAccelerometerInterval=function(){if(Cocoon.Motion.nativeAvailable){return window.ext.IDTK_APP.makeCall("getAccelerometerUpdateIntervalInSeconds")}};a.setGyroscopeInterval=function(a){if(Cocoon.Motion.nativeAvailable){return window.ext.IDTK_APP.makeCall("setGyroscopeUpdateIntervalInSeconds",a)}};a.getGyroscopeInterval=function(){if(Cocoon.Motion.nativeAvailable){window.ext.IDTK_APP.makeCall("getGyroscopeUpdateIntervalInSeconds")}};return a});Cocoon.define("Cocoon.Touch",function(a){a.addADivToDisableInput=function(){var a=document.createElement("div");a.id="CocoonJSInputBlockingDiv";a.style.left=0;a.style.top=0;a.style.width="100%";a.style.height="100%";a.style.position="absolute";a.style.backgroundColor="transparent";a.style.border="0px solid #000";a.style.zIndex=999999999;document.body.appendChild(a)};a.removeTheDivToEnableInput=function(){var a=document.getElementById("CocoonJSInputBlockingDiv");if(a)document.body.removeChild(a)};a.disable=function(){if(Cocoon.nativeAvailable){window.ext.IDTK_APP.makeCall("disableTouchLayer","CocoonJSView")}else if(!navigator.isCocoonJS){if(!Cocoon.App.EmulatedWebViewIFrame){Cocoon.App.forwardEventsToCocoonJSEnabled=false;Cocoon.App.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.disable();")}}};a.enable=function(){if(Cocoon.nativeAvailable){window.ext.IDTK_APP.makeCall("enableTouchLayer","CocoonJSView")}else if(!navigator.isCocoonJS){if(!Cocoon.App.EmulatedWebViewIFrame){Cocoon.App.forwardEventsToCocoonJSEnabled=true;Cocoon.App.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.enable();")}}};a.disableInWebView=function(){if(Cocoon.nativeAvailable){window.ext.IDTK_APP.makeCall("disableTouchLayer","WebView")}else if(!navigator.isCocoonJS){if(!Cocoon.App.EmulatedWebViewIFrame){Cocoon.Touch.addADivToDisableInput()}else{Cocoon.App.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.disableInWebView();")}}};a.enableInWebView=function(){if(Cocoon.nativeAvailable){window.ext.IDTK_APP.makeCall("enableTouchLayer","WebView")}else if(!navigator.isCocoonJS){if(!Cocoon.App.EmulatedWebViewIFrame){Cocoon.Touch.removeTheDivToEnableInput()}else{Cocoon.Touch.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.enableInWebView();")}}};return a});Cocoon.define("Cocoon.Widget",function(a){"use strict";a.WebDialog=function(){if(Cocoon.App.nativeAvailable){this.webDialogID=window.ext.IDTK_APP.makeCall("createWebDialog")}else{var a=document.createElement("iframe");a.id="CocoonJSWebDialogIFrame";a.name="CocoonJSWebDialogIFrame";a.style.cssText="position:fixed;left:0;top:0;bottom:0;right:0; width:100%; height:100%;margin:0;padding:0;";var b=this;a.onload=function(){b.iframeloaded=true;var a="Cocoon = {}; Cocoon.Widget = {}; Cocoon.Widget.WebDialog = {} Cocoon.Widget.WebDialog.close = function()"+"{"+"   window.parent.CocoonJSCloseWebDialog();"+"};";b.evalIframe(a);for(var c=0;c<b.pendingEvals.length;++c){b.evalIframe(b.pendingEvals[c])}b.pendingEvals=[]};a.onerror=function(){b.close()};this.iframe=a;this.pendingEvals=[];window.CocoonJSCloseWebDialog=function(){b.close()}}};a.WebDialog.prototype={show:function(a,b){this.closeCallback=function(){Cocoon.Touch.enable();if(b)b()};if(Cocoon.App.nativeAvailable){Cocoon.Touch.disable();return window.ext.IDTK_APP.makeCallAsync("showWebDialog",this.webDialogID,a,this.closeCallback)}else{this.iframe.src=a;document.body.appendChild(this.iframe)}},close:function(){if(Cocoon.App.nativeAvailable){return window.ext.IDTK_APP.makeCallAsync("closeWebDialog",this.webDialogID)}else{if(this.iframe.parentNode){this.iframe.parentNode.removeChild(this.iframe)}}if(this.closeCallback)this.closeCallback()},evalIframe:function(a){window.frames["CocoonJSWebDialogIFrame"].eval(a)},eval:function(a){if(Cocoon.App.nativeAvailable){return window.ext.IDTK_APP.makeCallAsync("evalWebDialog",this.webDialogID,a)}else{if(this.iframeloaded)this.evalIframe(a);else this.pendingEvals.push(a)}}};return a});Cocoon.define("Cocoon.Camera",function(a){navigator.getUserMedia_=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;a.CameraType={FRONT:"FRONT",BACK:"BACK"};a.CaptureFormatType={JPEG:"JPEG",RGB_565:"RGB_565",NV21:"NV21",NV16:"NV16",YUY2:"YUY2",YV12:"YV12",BGRA32:"32BGRA"};a.CameraInfo={cameraIndex:0,cameraType:a.CameraType.BACK,supportedVideoSizes:[],supportedVideoFrameRates:[],supportedVideoCaptureImageFormats:[]};
a.getNumberOfCameras=function(){if(Cocoon.nativeAvailable&&navigator.isCocoonJS){return Cocoon.callNative("IDTK_SRV_CAMERA","getNumberOfCameras",arguments)}else{return navigator.getUserMedia_?1:0}};a.getAllCamerasInfo=function(){if(Cocoon.nativeAvailable&&navigator.isCocoonJS){return Cocoon.callNative("IDTK_SRV_CAMERA","getAllCamerasInfo",arguments)}};a.getCameraInfoByIndex=function(a){if(Cocoon.nativeAvailable&&navigator.isCocoonJS){return Cocoon.callNative("IDTK_SRV_CAMERA","getCameraInfoByIndex",arguments)}};a.getCameraInfoByType=function(a){if(Cocoon.nativeAvailable&&navigator.isCocoonJS){return Cocoon.callNative("IDTK_SRV_CAMERA","getCameraInfoByType",arguments)}};a.start=function(a){if(!(Boolean(a.success)&&Boolean(a.error)))throw new Error("Missing callbacks for Cocoon.Camera.start();");if(Cocoon.nativeAvailable){var b={cameraIndex:0,width:50,height:50,frameRate:25};var c=Cocoon.clone(b,a);var d=Cocoon.callNative("IDTK_SRV_CAMERA","startCapturing",c);if(Boolean(d)){a.success(d)}else{a.error(false)}}else{navigator.getUserMedia_({video:true,audio:false},function(b){a.success(b)},function(b){a.error(b)})}};a.stop=function(a){if(Cocoon.nativeAvailable&&navigator.isCocoonJS){return Cocoon.callNative("IDTK_SRV_CAMERA","stopCapturing",arguments)}};a.isCapturing=function(a){if(Cocoon.nativeAvailable&&navigator.isCocoonJS){return Cocoon.callNative("IDTK_SRV_CAMERA","isCapturing",arguments)}};return a});Cocoon.define("Cocoon.Ad",function(a){"use strict";a.nativeAvailable=!!Cocoon.nativeAvailable&&!!window.ext.IDTK_SRV_AD;a.BannerLayout={TOP_CENTER:"TOP_CENTER",BOTTOM_CENTER:"BOTTOM_CENTER"};a.Rectangle=function(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d};a.Banner=function(a){if(typeof a!=="number")throw"The given ad ID is not a number.";this.id=a;var b=this;this.onBannerShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannershow",function(a,c){if(b.id===c[0]){a()}});this.onBannerHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerhide",function(a,c){if(b.id===c[0]){a()}});this.onBannerReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerready",function(a,c){if(b.id===c[0]){a(c[1],c[2])}});var c=new Cocoon.Signal.createSignal;c.register("ready",this.onBannerReady);c.register("shown",this.onBannerShown);c.register("hidden",this.onBannerHidden);this.on=c.expose()};a.Banner.prototype={showBanner:function(){if(Cocoon.Ad.nativeAvailable){Cocoon.callNative("IDTK_SRV_AD","showBanner",[this.id],true)}},hideBanner:function(){if(Cocoon.Ad.nativeAvailable){Cocoon.callNative("IDTK_SRV_AD","hideBanner",[this.id],true)}},load:function(){if(Cocoon.Ad.nativeAvailable){Cocoon.callNative("IDTK_SRV_AD","refreshBanner",[this.id],true)}},getRectangle:function(){if(Cocoon.Ad.nativeAvailable){return Cocoon.callNative("IDTK_SRV_AD","getRectangle",[this.id])}},setRectangle:function(a){if(Cocoon.Ad.nativeAvailable){return Cocoon.callNative("IDTK_SRV_AD","setRectangle",[this.id,a])}},setBannerLayout:function(a){if(Cocoon.Ad.nativeAvailable){return Cocoon.callNative("IDTK_SRV_AD","setBannerLayout",[this.id,a])}}};a.Interstitial=function(a){if(typeof a!=="number")throw"The given ad ID is not a number.";this.id=a;var b=this;this.onFullScreenShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenshow",function(a,c){if(b.id===c[0]){a()}});this.onFullScreenHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenhide",function(a,c){if(b.id===c[0]){a()}});this.onFullScreenReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenready",function(a,c){if(b.id===c[0]){a()}});var c=new Cocoon.Signal.createSignal;c.register("ready",this.onFullScreenReady);c.register("shown",this.onFullScreenShown);c.register("hidden",this.onFullScreenHidden);this.on=c.expose()};a.Interstitial.prototype={showInterstitial:function(){if(Cocoon.Ad.nativeAvailable){return Cocoon.callNative("IDTK_SRV_AD","showFullScreen",[this.id],true)}},refreshInterstitial:function(){if(Cocoon.Ad.nativeAvailable){return Cocoon.callNative("IDTK_SRV_AD","refreshFullScreen",[this.id],true)}}};a.configure=function(a){if(typeof a==="undefined"){a={}}if(Cocoon.Ad.nativeAvailable){return Cocoon.callNative("IDTK_SRV_AD","requestInitialization",arguments,true)}};a.createBanner=function(b){if(typeof b==="undefined"){b={}}if(Cocoon.Ad.nativeAvailable){var c=Cocoon.callNative("IDTK_SRV_AD","createBanner",[b]);var d=new a.Banner(c);return d}};a.releaseBanner=function(a){if(typeof a==="undefined"){throw"The banner ad object to be released is undefined"}if(Cocoon.Ad.nativeAvailable){Cocoon.callNative("IDTK_SRV_AD","releaseBanner",[a.id])}};a.createInterstitial=function(a){if(typeof a==="undefined"){a={}}if(Cocoon.Ad.nativeAvailable){var b=Cocoon.callNative("IDTK_SRV_AD","createFullscreen",[a]);var c=new Cocoon.Ad.Interstitial(b);return c}};a.releaseInterstitial=function(a){if(!a){throw"The fullscreen ad object to be released is undefined"}if(Cocoon.Ad.nativeAvailable){Cocoon.callNative("IDTK_SRV_AD","releaseFullscreen",[a.id])}};a.showBanner=function(){if(Cocoon.Ad.nativeAvailable){return Cocoon.callNative("IDTK_SRV_AD","showBanner",arguments,true)}};a.hideBanner=function(){if(Cocoon.Ad.nativeAvailable){return Cocoon.callNative("IDTK_SRV_AD","hideBanner",arguments,true)}};a.refreshBanner=function(){if(Cocoon.Ad.nativeAvailable){return Cocoon.callNative("IDTK_SRV_AD","refreshBanner",arguments,true)}};a.showInterstitial=function(){if(Cocoon.Ad.nativeAvailable){return Cocoon.callNative("IDTK_SRV_AD","showFullScreen",arguments,true)}};a.refreshInterstitial=function(){if(Cocoon.Ad.nativeAvailable){return Cocoon.callNative("IDTK_SRV_AD","refreshFullScreen",arguments,true)}};a.preloadedBanner=false;a.loadBanner=function(){if(Cocoon.Ad.nativeAvailable){if(Cocoon.Ad.preloadedBanner){return Cocoon.Ad.refreshBanner()}else{Cocoon.Ad.preloadedBanner=true;return Cocoon.callNative("IDTK_SRV_AD","preloadBanner",arguments,true)}}};a.preloadedInterstitial=false;a.loadInterstitial=function(){if(Cocoon.Ad.nativeAvailable){if(Cocoon.Ad.preloadedInterstitial){return Cocoon.Ad.refreshInterstitial()}else{Cocoon.Ad.preloadedInterstitial=true;return Cocoon.callNative("IDTK_SRV_AD","preloadFullScreen",arguments,true)}}};a.setRectangle=function(){if(Cocoon.Ad.nativeAvailable){return Cocoon.callNative("IDTK_SRV_AD","setRectangle",arguments)}};a.getRectangle=function(){if(Cocoon.Ad.nativeAvailable){return Cocoon.callNative("IDTK_SRV_AD","getRectangle",arguments)}};a.setBannerLayout=function(a){if(Cocoon.Ad.nativeAvailable){return Cocoon.callNative("IDTK_SRV_AD","setBannerLayout",arguments)}};a.onBannerShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannershow");a.onBannerHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerhide");a.onBannerReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerready");a.onFullScreenShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenshow");a.onFullScreenHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenhide");a.onFullScreenReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenready");var b=new Cocoon.Signal.createSignal;b.register("ready",a.onBannerReady);b.register("shown",a.onBannerShown);b.register("hidden",a.onBannerHidden);a.banner={};a.banner.on=b.expose();var b=new Cocoon.Signal.createSignal;b.register("ready",a.onFullScreenReady);b.register("shown",a.onFullScreenShown);b.register("hidden",a.onFullScreenHidden);a.interstitial={};a.interstitial.on=b.expose();return a});Cocoon.define("Cocoon.Store",function(a){"use strict";a.nativeAvailable=!!Cocoon.nativeAvailable&&!!window.ext.IDTK_SRV_STORE;a.ProductInfo={productId:"productId",productAlias:"productAlias",productType:"productType",title:"title",description:"description",price:"price",localizedPrice:"localizedPrice",downloadURL:"downloadURL"};a.ProductType={CONSUMABLE:0,NON_CONSUMABLE:1,AUTO_RENEWABLE_SUBSCRIPTION:2,FREE_SUBSCRIPTION:3,NON_RENEWABLE_SUBSCRIPTION:4};a.StoreType={APP_STORE:0,PLAY_STORE:1,MOCK_STORE:2,CHROME_STORE:3,AMAZON_STORE:4,NOOK_STORE:5};a.PurchaseInfo=function(a,b,c,d,e){this.transactionId=a;this.purchaseTime=b;this.purchaseState=c;this.productId=d;this.quantity=e;return this};a.PurchaseState={PURCHASED:0,CANCELED:1,REFUNDED:2,EXPIRED:3};a.getStoreType=function(){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","getStoreType",arguments)}else{return false}};a.initialize=function(a){a=a||{};var b={sandbox:false,managed:true};var c=Cocoon.clone(b,a);Cocoon.Store.requestInitialization({sandbox:c[0],managed:c[1]});Cocoon.Store.start()};a.requestInitialization=function(a){if(typeof a==="undefined"){a={}}else{if(a["managed"]!==undefined)a["remote"]=a["managed"];if(a["sandbox"]!==undefined)a["debug"]=a["sandbox"]}if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","requestInitialization",arguments,true)}};a.start=function(){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","start",arguments)}};a.canPurchase=function(){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","canPurchase",arguments)}else{return false}};a.fetchProductsFromServer=function(){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","fetchProductsFromServer",arguments,true)}};a.loadProducts=function(a){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","fetchProductsFromStore",arguments,true)}};a.finish=function(a){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","finishPurchase",arguments,true)}};a.consume=function(a,b){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","consumePurchase",arguments,true)}};a.purchase=function(a){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","purchaseFeature",arguments,true)}};a.puchaseProductModal=function(a){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","purchaseFeatureModal",arguments,true)}};a.purchaseProductModalWithPreview=function(a){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","purchaseFeatureModalWithPreview",arguments,true)}};a.isProductPurchased=function(a){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","isFeaturePurchased",arguments)}};a.restore=function(){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","restorePurchases",arguments,true)}};a.restorePurchasesModal=function(){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","restorePurchasesModal",arguments,true)}};a.getProducts=function(){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","getProducts",arguments)}};a.addProduct=function(a){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","addProduct",arguments)}};a.removeProduct=function(a){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","removeProduct",arguments)}};a.getPurchases=function(){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","getPurchases",arguments)}};a.addPurchase=function(a){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","addPurchase",arguments)}};a.removePurchase=function(a){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","removePurchase",arguments)}};a.cancelPurchase=function(a){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","cancelPurchase",arguments)}};a.refundPurchase=function(a){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","refundPurchase",arguments)}};a.expirePurchase=function(a){if(Cocoon.Store.nativeAvailable){return Cocoon.callNative("IDTK_SRV_STORE","expirePurchase",arguments)}};a.onProductsFetchStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductsFetchStarted");a.onProductsFetchCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductsFetchCompleted");a.onProductsFetchFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductsFetchFailed");a.onProductPurchaseStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseStarted");a.onProductPurchaseVerificationRequestReceived=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseVerificationRequestReceived");a.onProductPurchaseCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseCompleted");a.onProductPurchaseFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseFailed");a.onRestorePurchasesStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onRestorePurchasesStarted");a.onRestorePurchasesCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onRestorePurchasesCompleted");a.onRestorePurchasesFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onRestorePurchasesFailed");a.onConsumePurchaseStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onConsumePurchaseStarted");a.onConsumePurchaseCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onConsumePurchaseCompleted");a.onConsumePurchaseFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onConsumePurchaseFailed");var b=new Cocoon.Signal.createSignal;b.register("load",{started:a.onProductsFetchStarted,success:a.onProductsFetchCompleted,error:a.onProductsFetchFailed});b.register("purchase",{started:a.onProductPurchaseStarted,success:a.onProductPurchaseCompleted,verification:a.onProductPurchaseVerificationRequestReceived,error:a.onProductPurchaseFailed});b.register("consume",{started:a.onConsumePurchaseStarted,success:a.onConsumePurchaseCompleted,error:a.onConsumePurchaseFailed});b.register("restore",{started:a.onRestorePurchasesStarted,success:a.onRestorePurchasesCompleted,error:a.onRestorePurchasesFailed});a.on=b.expose();return a});Cocoon.define("Cocoon.Notification",function(a){a.nativeAvailable=!!window.ext&&!!window.ext.IDTK_SRV_NOTIFICATION;a.Local={};a.Push={};a.Local.create=function(a){var b={message:"",soundEnabled:true,badgeNumber:0,userData:{},contentBody:"",contentTitle:"",date:(new Date).valueOf()+1e3};var c=Cocoon.clone(b,a);if(Cocoon.Notification.nativeAvailable){return Cocoon.callNative("IDTK_SRV_NOTIFICATION","createLocalNotification",c)}};a.Push.create=function(a){var b={message:"",soundEnabled:true,badgeNumber:0,userData:{},channels:[],expirationTime:0,expirationTimeInterval:0};for(var c in b){if(!a[c]){a[c]=b[c]}}return a};a.start=function(){if(Cocoon.Notification.nativeAvailable){return Cocoon.callNative("IDTK_SRV_NOTIFICATION","start",arguments)}};a.Push.register=function(){if(Cocoon.Notification.nativeAvailable){return Cocoon.callNative("IDTK_SRV_NOTIFICATION","registerForPushNotifications",arguments,true)}};a.Push.unregister=function(){if(Cocoon.Notification.nativeAvailable){return Cocoon.callNative("IDTK_SRV_NOTIFICATION","unregisterForPushNotifications",arguments,true)}};a.Local.cancel=function(){if(Cocoon.Notification.nativeAvailable){return Cocoon.callNative("IDTK_SRV_NOTIFICATION","cancelLocalNotification",arguments)}};a.Local.cancelLast=function(){if(Cocoon.Notification.nativeAvailable){return Cocoon.callNative("IDTK_SRV_NOTIFICATION","cancelLocalNotification",arguments,true)}};a.Local.cancelAllNotifications=function(){if(Cocoon.Notification.nativeAvailable){return Cocoon.callNative("IDTK_SRV_NOTIFICATION","cancelAllLocalNotifications",arguments)}};a.Local.send=function(a){if(Cocoon.Notification.nativeAvailable){return Cocoon.callNative("IDTK_SRV_NOTIFICATION","sendLocalNotification",arguments,true)}};a.subscribe=function(a){if(Cocoon.Notification.nativeAvailable){return Cocoon.callNative("IDTK_SRV_NOTIFICATION","subscribe",arguments,true)}};a.unsubscribe=function(a){if(Cocoon.Notification.nativeAvailable){return Cocoon.callNative("IDTK_SRV_NOTIFICATION","unsubscribe",arguments,true)}};a.Push.send=function(a){if(Cocoon.Notification.nativeAvailable){return Cocoon.callNative("IDTK_SRV_NOTIFICATION","sendPushNotification",arguments,true)}};a.setBadgeNumber=function(a){if(Cocoon.Notification.nativeAvailable){return Cocoon.callNative("IDTK_SRV_NOTIFICATION","setBadgeNumber",arguments)}};a.getBadgeNumber=function(){if(Cocoon.Notification.nativeAvailable){return Cocoon.callNative("IDTK_SRV_NOTIFICATION","getBadgeNumber",arguments)}};a.Local.getLastNotificationData=function(){if(Cocoon.Notification.nativeAvailable){return Cocoon.callNative("IDTK_SRV_NOTIFICATION","getLastReceivedLocalNotificationData",arguments)}};a.Push.getLastNotificationData=function(){if(Cocoon.Notification.nativeAvailable){return Cocoon.callNative("IDTK_SRV_NOTIFICATION","getLastReceivedPushNotificationData",arguments)}};a.onRegisterForPushNotificationsSucceed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationServiceRegistered");a.onUnregisterForPushNotificationsSucceed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationServiceUnregistered");a.onRegisterForPushNotificationsFailed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationServiceFailedToRegister");a.onPushNotificationReceived=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationReceived");a.onLocalNotificationReceived=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","localNotificationReceived");a.onPushNotificationDeliverySucceed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationSuccessfullyDelivered");a.onPushNotificationDeliveryFailed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationDeliveryError");var b=new Cocoon.Signal.createSignal;b.register("notification",{received:a.onLocalNotificationReceived});a.Local.on=b.expose();var b=new Cocoon.Signal.createSignal;b.register("register",{success:a.onRegisterForPushNotificationsSucceed,unregister:a.onUnregisterForPushNotificationsSucceed,error:a.onRegisterForPushNotificationsFailed});b.register("notification",{received:a.onPushNotificationReceived});b.register("deliver",{success:a.onPushNotificationDeliverySucceed,error:a.onPushNotificationDeliveryFailed});a.Push.on=b.expose();return a});Cocoon.define("Cocoon.Social",function(a){a.Interface=function(){this.onLoginStatusChanged=new Cocoon.EventHandler("","dummy","onLoginStatusChanged");var a=new Cocoon.Signal.createSignal;a.register("loginStatusChanged",this.onLoginStatusChanged);this.on=a.expose();return this};a.Interface.prototype={isLoggedIn:function(){return false},login:function(a){if(a)a(false,{message:"Not implemented!"})},logout:function(a){if(a)a({message:"Not implemented!"})},getLoggedInUser:function(){return null},hasPublishPermissions:function(a){a(true)},requestPublishPermissions:function(a){if(a)a(true,null)},requestUser:function(a,b){a(null,{message:"Not implemented!"})},requestUserImage:function(a,b,c){a("",{message:"Not implemented!"})},requestFriends:function(a,b){a([],{message:"Not implemented!"})},publishMessage:function(a,b){b({message:"Not implemented!"})},publishMessageWithDialog:function(a,b){b({message:"Not implemented!"})}};a.SocialGamingService=function(){Cocoon.Social.SocialGamingService.superclass.constructor.call(this);return this};a.SocialGamingService.prototype={_cachedAchievements:null,_achievementsMap:null,_leaderboardsTemplate:null,_achievementsTemplate:null,requestScore:function(a,b){a(null,{message:"Not implemented!"})},submitScore:function(a,b,c){if(b)b({message:"Not implemented!"})},showLeaderboard:function(a,b){if(a)a({message:"Not implemented!"})},requestAllAchievements:function(a){a([],{message:"Not implemented!"})},requestAchievements:function(a,b){a([],{message:"Not implemented!"})},submitAchievement:function(a,b){if(b)b({message:"Not implemented!"})},resetAchievements:function(a){if(a)a([],{message:"Not implemented!"})},showAchievements:function(a){if(!this._achievementsTemplate)throw"Please, provide a html template for achievements with the setTemplates method";var b=new Cocoon.Widget.WebDialog;var c=false;b.show(this._achievementsTemplate,function(d){b.closed=true;if(!c&&a)a(d)});var d=this;this.requestAchievements(function(e,f){if(b.closed)return;if(f){c=true;if(a)a(f);return}var g=[];if(d._cachedAchievements){for(var h=0;h<d._cachedAchievements.length;++h){var i=d._cachedAchievements[h];g.push(i);if(e&&e.length){for(var j=0;j<e.length;++j){if(e[j].achievementID===i.achievementID){i.achieved=true;break}}}}}var k="addAchievements("+JSON.stringify(g)+");";b.eval(k)})},setAchievementsMap:function(a){this._achievementsMap=a;if(this._cachedAchievements){this.syncAchievementsMap(this._cachedAchievements)}},setTemplates:function(a,b){this._leaderboardsTemplate=a;this._achievementsTemplate=b},setCachedAchievements:function(a){this._cachedAchievements=a;if(a&&this._achievementsMap){this.syncAchievementsMap(this._cachedAchievements)}},findAchievement:function(a){if(!this._cachedAchievements)return null;for(var b=0;b<this._cachedAchievements.length;++b){if(a===this._cachedAchievements[b].achievementID){return this._cachedAchievements[b]}}return null},translateAchievementID:function(a){if(this._achievementsMap){for(var b in this._achievementsMap){if(b==a){return this._achievementsMap[b]}}}return a},syncAchievementsMap:function(a){if(!this._achievementsMap)return;for(var b=0;b<a.length;++b){for(var c in this._achievementsMap){if(this._achievementsMap[c]===a[b].achievementID){a[b].customID=c}}}}};Cocoon.extend(a.SocialGamingService,a.Interface);a.ImageSize={THUMB:"thumb",SMALL:"small",MEDIUM:"medium",LARGE:"large"};a.User=function(a,b,c){this.userID=a;this.userName=b;this.userImage=c;return this};a.Message=function(a,b,c,d,e){this.message=a;this.mediaURL=b;this.linkURL=c;this.linkText=d;this.linkCaption=e;return this};a.Score=function(a,b,c,d,e){this.userID=a;this.score=b||0;this.userName=c;this.imageURL=d;this.leaderboardID=e;return this};a.ScoreParams=function(a,b,c,d){this.userID=a;this.leaderboardID=b;this.friends=!!c;this.timeScope=d||2};a.TimeScope={ALL_TIME:0,WEEK:1,TODAY:2};a.Achievement=function(a,b,c,d,e){this.achievementID=a;this.customID=a;this.title=b;this.description=c;this.imageURL=d;this.points=e||0;return this};a.share=function(a){if(Cocoon.nativeAvailable){return Cocoon.callNative("IDTK_APP","share",arguments,true)}else{}};return a});Cocoon.define("Cocoon.Social",function(a){a.ManagerService=function(){this.services=[]};a.ManagerService.prototype={services:null,registerSocialService:function(a){this.services.push(a)},submitAchievement:function(a){for(var b=0;b<this.services.length;++b){var c=this.services[b];if(!c.readOnlyHint&&c.isLoggedIn()){c.submitAchievement(a,function(a){if(a)console.error("Error submitting achievement: "+a.message)})}}},submitScore:function(a,b){for(var c=0;c<this.services.length;++c){var d=this.services[c];if(!d.readOnlyHint&&d.isLoggedIn()){d.submitScore(a,function(a){if(a)console.error("Error submitting score: "+a.message)},b)}}},getLoggedInServices:function(){var a=[];for(var b=0;b<this.services.length;++b){var c=this.services[b];if(!c.fakeSocialService&&c.isLoggedIn()){a.push(c)}}return a},isLoggedInAnySocialService:function(){return this.getLoggedInServices().length>0}};a.Manager=new a.ManagerService;return a});Cocoon.define("Cocoon.Social",function(a){a.LocalStorageService=function(){Cocoon.Social.LocalStorageService.superclass.constructor.call(this);this.fakeSocialService=true};a.LocalStorageService.prototype={loggedIn:false,keys:{score:"Cocoon.Social.LocalStorageService.score",earnedAchievements:"Cocoon.Social.LocalStorageService.earned"},isLoggedIn:function(){return this.loggedIn},login:function(a){if(!this.loggedIn)this.onLoginStatusChanged.notifyEventListeners(true);this.loggedIn=true;if(a)setTimeout(function(){a(true)},0)},logout:function(a){if(this.loggedIn)this.onLoginStatusChanged.notifyEventListeners(true);this.loggedIn=false;if(a)setTimeout(function(){a()},0)},getLoggedInUser:function(){return new Cocoon.Social.User("me","LocalStorage")},requestUser:function(a,b){var c=new Cocoon.Social.User(b||"me","LocalStorage");if(a)setTimeout(function(){a(c)},0)},requestScore:function(a,b){var c=localStorage.getItem(this.keys.score);var d=parseInt(c)||0;setTimeout(function(){a(new Cocoon.Social.Score("me",d))},0)},submitScore:function(a,b,c){var d=localStorage.getItem(this.keys.score);var e=parseInt(d)||0;if(a>e)localStorage.setItem(this.keys.score,a);if(b)setTimeout(function(){b()},0)},getLocalStorageEarnedAchievements:function(){var a=localStorage.getItem(this.keys.earnedAchievements);var b=[];if(a){var c=JSON.stringify(a);if(c&&c.length){b=c}}return b},requestAchievements:function(a,b){var c=this.getLocalStorageEarnedAchievements();setTimeout(function(){a(c)},0)},submitAchievement:function(a,b){if(a===null||typeof a==="undefined")throw"No achievementID specified";var c=this.getLocalStorageEarnedAchievements();var d=false;for(var e=0;e<c.length;++e){if(c[e]===a){d=true;break}}if(!d){c.push(a);localStorage.setItem(this.keys.earnedAchievements,JSON.stringify(c))}if(b)setTimeout(function(){b()},0)},resetAchievements:function(a){localStorage.removeItem(this.keys.earnedAchievements);if(a)setTimeout(function(){a()},0)}};Cocoon.extend(a.LocalStorageService,a.SocialGamingService);a.LocalStorage=new a.LocalStorageService;return a});Cocoon.define("Cocoon.Social",function(a){a.GooglePlayGamesExtension=function(){this.nativeExtensionName="IDTK_SRV_GOOGLE_PLAY_GAMES";this.extensionName="Social.GooglePlayGames";this.nativeAvailable=Cocoon.nativeAvailable&&typeof window.ext[this.nativeExtensionName]!=="undefined";this.auth=new Cocoon.Social.GooglePlayGamesAuthExtension(this);this.client=new Cocoon.Social.GooglePlayGamesClientExtension(this);this.defaultScopes=["https://www.googleapis.com/auth/games","https://www.googleapis.com/auth/plus.login"];this.gamesAPI="/games/v1";this.plusAPI="/plus/v1";this.onSessionChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onSessionChanged");Cocoon.Social.GooglePlayGames=this;var a=this;this.onSessionChanged.addEventListener(function(c,d){a.token=b(c,d);if(c&&c.access_token){a.client.request({path:a.gamesAPI+"/players/me",callback:function(b){a.currentPlayer=b}})}});return this};a.GooglePlayGamesExtension.prototype={token:null,settings:{},socialService:null,currentPlayer:null,initialized:false,auth:null,client:null,init:function(a){if(!a||typeof a!=="object")throw"Invalid params argument";this.settings=a;this.initialized=true;if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"init",[this.settings.clientId],true)}else{var b=this;var c=function(){gapi.auth.authorize({immediate:true,scope:b.defaultScopes,client_id:b.settings.clientId},function(a){b.token=a;if(a&&a.access_token){b.onSessionChanged.notifyEventListeners(a)}})};if(!window.gapi){window.onGapiLoadCallback=function(){window.setTimeout(c,1)};var d=document.createElement("script");d.src="https://apis.google.com/js/client.js?onload=onGapiLoadCallback";document.getElementsByTagName("head")[0].appendChild(d)}else{c()}}},getSocialInterface:function(){if(!this.initialized){throw"You must call init() before getting the Social Interface"}if(!this.socialService){this.socialService=new Cocoon.Social.SocialGamingServiceGooglePlayGames(this)}return this.socialService},getMultiplayerInterface:function(){return Cocoon.Multiplayer.GooglePlayGames},share:function(){window.open(this.href,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600");return false}};a.GooglePlayGamesAuthExtension=function(a){this.extension=a;return this};a.GooglePlayGamesAuthExtension.prototype={authorize:function(a,c){var d=this;if(this.extension.nativeAvailable){Cocoon.callNative(this.extension.nativeExtensionName,"authorize",[a,function(a,e){d.extension.token=b(a,e);if(c){c(d.extension.token)}}],true)}else{gapi.auth.authorize(a,function(a){d.extension.token=a;d.extension.onSessionChanged.notifyEventListeners(a,a?a.error:null);if(c)c(a)})}},disconnect:function(a){if(this.extension.nativeAvailable){Cocoon.callNative(this.extension.nativeExtensionName,"disconnect",[a],true)}else{if(a)a({error:"Not implemented yet"})}},init:function(a){if(this.extension.nativeAvailable){a()}else{gapi.auth.init(a)}},getToken:function(){if(this.extension.nativeAvailable){return this.extension.token}else{return gapi.auth.getToken()}},setToken:function(a){if(this.extension.nativeAvailable){this.extension.token=a}else{gapi.auth.setToken(a)}}};a.GooglePlayGamesClientExtension=function(a){this.extension=a;return this};a.GooglePlayGamesClientExtension.prototype={setApiKey:function(a){if(this.extension.nativeAvailable){Cocoon.callNative(this.extension.nativeExtensionName,"setApiKey",[a],true)}else{gapi.client.setApiKey(a)}},request:function(a){if(this.extension.nativeAvailable){if(a.callback){Cocoon.callNative(this.extension.nativeExtensionName,"request",[a,function(b,c){var d=b;if(c){d=b||{};d.error=c}a.callback(d)}],true);return null}else{var b=this;var c={execute:function(c){Cocoon.callNative(b.extension.nativeExtensionName,"request",[a,function(a,b){var d=a;if(b){d=a||{};d.error=b}c(d)}],true)}};return c}}else{return gapi.client.request(a)}}};a.GooglePlayGames=new Cocoon.Social.GooglePlayGamesExtension;function b(a,b){var c=a||{};return{access_token:a.access_token,state:a.state,error:b,expires_in:a.expirationDate?a.expirationDate-Date.now():0,player_id:a.playerId}}a.SocialGamingServiceGooglePlayGames=function(a){Cocoon.Social.SocialGamingServiceGooglePlayGames.superclass.constructor.call(this);this.gapi=a;var b=this;this.gapi.onSessionChanged.addEventListener(function(a){var c=a||{};b.onLoginStatusChanged.notifyEventListeners(!!c.access_token,c.error)});return this};a.SocialGamingServiceGooglePlayGames.prototype={isLoggedIn:function(){return this.gapi.token&&this.gapi.token.access_token?true:false},login:function(a){var b=this;this.gapi.auth.authorize({client_id:this.gapi.settings.clientId,scope:this.gapi.defaultScopes},function(c){if(a){a(b.isLoggedIn(),c.error)}})},logout:function(a){this.gapi.auth.disconnect(a)},getLoggedInUser:function(){return this.gapi.currentPlayer?fromGPUserToCocoonUser(this.gapi.currentPlayer):null},requestUser:function(a,b){var d=b||"me";this.gapi.client.request({path:this.gapi.gamesAPI+"/players/"+d,callback:function(b){var d=b&&!b.error?c(b):null;a(d,b.error)}})},requestUserImage:function(a,b,c){this.requestUser(function(b,d){if(b&&b.userImage){var f=e(c||Cocoon.Social.ImageSize.MEDIUM);if(b.userImage.indexOf("sz=")===-1){b.userImage+="?sz="+f}else{b.userImage=b.userImage.replace(/sz=\d+/g,"sz="+f)}}a(b?b.userImage:null,d)},b)},requestFriends:function(a,b){var c={orderBy:"best"};var e=b||"me";this.gapi.client.request({path:this.gapi.plusAPI+"/people/"+e+"/people/visible",params:c,callback:function(b){if(b&&!b.error){var c=[];for(var e=0;e<b.items.length;++e){c.push(d(b.items[e]))}a(c)}else{a([],b?b.error:null)}}})},publishMessage:function(a,b){if(b)b("Not supported... use publishMessageWithDialog method instead")},publishMessageWithDialog:function(a,b){if(this.gapi.nativeAvailable){var c={prefilledText:a.message,mediaUrl:a.mediaURL,mediaTitle:a.linkCaption,mediaDescription:a.linkText,url:a.linkURL};Cocoon.callNative(this.gapi.nativeExtensionName,"shareMessage",[c,b],true)}else{var d=this;var e=function(){var b={contenturl:"https://plus.google.com/pages/",contentdeeplinkid:"/pages",clientid:d.gapi.settings.clientId,cookiepolicy:"single_host_origin",prefilltext:a.message,calltoactionlabel:"CREATE",calltoactionurl:"http://plus.google.com/pages/create",calltoactiondeeplinkid:"/pages/create"};gapi.interactivepost.render("sharePost",b)};if(!gapi.interactivepost){var f=document.createElement("script");f.type="text/javascript";f.async=true;f.src="https://apis.google.com/js/plusone.js";f.onload=function(){e()};document.getElementsByTagName("head")[0].appendChild(f)}else{e()}}},requestScore:function(a,b){b=b||{};var c=b.userID||"me";var d=b.leaderboardID||this.gapi.settings.defaultLeaderboard;if(!d)throw"leaderboardID not provided in the params. You can also set the default leaderboard in the init method";this.gapi.client.request({path:this.gapi.gamesAPI+"/players/"+c+"/leaderboards/"+d+"/scores/ALL_TIME",callback:function(b){if(b&&b.error){a(null,b.error)
}else if(b&&b.items&&b.items.length>0){var d=b.items[0];var e=new Cocoon.Social.Score(c,d.scoreValue,"","",d.leaderboard_id);a(e,null)}else{a(null,null)}}})},submitScore:function(a,b,c){c=c||{};var d=c.leaderboardID||this.gapi.settings.defaultLeaderboard;if(!d)throw"leaderboardID not provided in the params. You can also set the default leaderboard in the init method";this.gapi.client.request({path:this.gapi.gamesAPI+"/leaderboards/"+d+"/scores",method:"POST",params:{score:a},callback:function(a){if(b){b(a?a.error:null)}}})},showLeaderboard:function(a,b){b=b||{};var c=b.leaderboardID||this.gapi.settings.defaultLeaderboard;if(!c)throw"leaderboardID not provided in the params. You can also set the default leaderboard in the init method";var d=/(iPad|iPhone|iPod)/gi.test(navigator.userAgent);if(!d&&this.gapi.nativeAvailable){var e=b.timeScope||0;Cocoon.callNative(this.gapi.nativeExtensionName,"showLeaderboard",[c,e,a],true)}else{if(!this._leaderboardsTemplate)throw"Please, provide a html template for leaderboards with the setTemplates method";var f=new Cocoon.Widget.WebDialog;var h=false;f.show(this._leaderboardsTemplate,function(b){f.closed=true;if(!h&&a)a(b)});var i=this;var j=b.friends?"SOCIAL":"PUBLIC";var k="ALL_TIME";if(b.timeScope===Cocoon.Social.TimeScope.WEEK){k="WEEKLY"}else if(b.timeScope===Cocoon.Social.TimeScope.TODAY){k="DAILY"}this.gapi.client.request({path:this.gapi.gamesAPI+"/leaderboards/"+c+"/window/"+j,method:"GET",params:{timeSpan:k},callback:function(b){if(f.closed)return;if(b.error){if(a){h=true;a(b.error);f.close()}return}var d=[];var e=[];if(b&&b.items){e=b.items.slice(0)}if(b&&b.playerScore){e.push(b.playerScore)}for(var i=0;i<e.length;++i){var j=e[i];var k=g(j,c);k.imageURL+="?sz=50";k.position=j.scoreRank||i+1;k.me=false;d.push(k)}var l="addScores("+JSON.stringify(d)+")";f.eval(l)}})}},prepareAchievements:function(a,b){if(!this._cachedAchievements||a){var c=this;this.gapi.client.request({path:this.gapi.gamesAPI+"/achievements",callback:function(a){if(a&&!a.error){var d=[];if(a&&a.items){for(var e=0;e<a.items.length;e++){d.push(f(a.items[e]))}}c.setCachedAchievements(d);b(d,null)}else{b([],a?a.error:null)}}})}else{b(this._cachedAchievements,null)}},requestAllAchievements:function(a){this.prepareAchievements(true,a)},requestAchievements:function(a,b){var c=this;this.prepareAchievements(false,function(d,e){if(e){a([],e);return}var f=b||"me";c.gapi.client.request({path:c.gapi.gamesAPI+"/players/"+f+"/achievements",params:{state:"UNLOCKED"},callback:function(b){if(b&&!b.error){var d=[];if(b.items){for(var e=0;e<b.items.length;e++){var f=c.findAchievement(b.items[e].id);if(f)d.push(f)}}a(d,null)}else{a([],b?b.error:null)}}})})},submitAchievement:function(a,b){if(a===null||typeof a==="undefined")throw"No achievementID specified";var c=this.translateAchievementID(a);if(this.gapi.nativeAvailable){var d=!!this.gapi.settings.showAchievementNotifications;Cocoon.callNative(this.gapi.nativeExtensionName,"unlockAchievement",[c,d,b],true)}else{this.gapi.client.request({path:this.gapi.gamesAPI+"/achievements/"+c+"/unlock",method:"POST",callback:function(a){if(b){b(a?a.error:null)}}})}},resetAchievements:function(a){this.gapi.client.request({path:"/games/v1management/achievements/reset",method:"POST",callback:function(b){if(a){a(b?b.error:null)}}})},showAchievements:function(a){var b=/(iPad|iPhone|iPod)/gi.test(navigator.userAgent);if(!b&&this.gapi.nativeAvailable){Cocoon.callNative(this.gapi.nativeExtensionName,"showAchievements",[a],true)}else{Cocoon.Social.SocialGamingServiceGooglePlayGames.superclass.showAchievements.call(this)}}};Cocoon.extend(Cocoon.Social.SocialGamingServiceGooglePlayGames,Cocoon.Social.SocialGamingService);function c(a){return new Cocoon.Social.User(a.playerId,a.displayName,a.avatarImageUrl)}function d(a){var b=a.image?a.image.url:"";b=b.replace(/sz=\d+/g,"sz=100");return new Cocoon.Social.User(a.id,a.displayName,b)}function e(a){if(a===Cocoon.Social.ImageSize.THUMB){return 100}else if(a===Cocoon.Social.ImageSize.MEDIUM){return 200}else if(a===Cocoon.Social.ImageSize.LARGE){return 512}}function f(a){var b=new Cocoon.Social.Achievement(a.id,a.name,a.description,a.revealedIconUrl,0);b.gpAchievementData=a;return b}function g(a,b){return new Cocoon.Social.Score(a.player.playerId,a.scoreValue,a.player.displayName,a.player.avatarImageUrl,b)}return a});Cocoon.define("Cocoon.Social",function(a){a.GameCenterExtension=function(){this.nativeExtensionName="IDTK_SRV_GAMECENTER";this.extensionName="Social.GameCenter";this.nativeAvailable=!!window.ext&&!!window.ext[this.nativeExtensionName];var a=this;if(this.nativeAvailable){this.onGameCenterLoginStateChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onGameCenterLoginStateChanged");this.onGameCenterLoginStateChanged.addEventListener(function(b,c){a._currentPlayer=b})}return this};a.GameCenterExtension.prototype={_currentPlayer:null,getSocialInterface:function(){if(!this._socialService){this._socialService=new Cocoon.Social.SocialGamingServiceGameCenter(this)}return this._socialService},getMultiplayerInterface:function(){return Cocoon.Multiplayer.GameCenter},isLoggedIn:function(){return this._currentPlayer&&this._currentPlayer.isAuthenticated},login:function(a){var b=this;if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"login",[function(c,d){b._currentPlayer=c;if(a){a(c,d)}}],true)}else{throw"Game Center not available"}},getLocalPlayer:function(){if(this._currentPlayer)return this._currentPlayer;if(this.nativeAvailable){this._currentPlayer=Cocoon.callNative(this.nativeExtensionName,"getLocalPlayer",[]);return this._currentPlayer}else{throw"Game Center not available"}},loadPlayers:function(a,b){if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"loadPlayers",[a,b],true)}else{throw"Game Center not available"}},loadFriends:function(a){if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"loadFriends",[a],true)}else{throw"Game Center not available"}},loadAchievements:function(a){if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"loadAchievements",[a],true)}else{throw"Game Center not available"}},loadAchievementDescriptions:function(a){if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"loadAchievementDescriptions",[a],true)}else{throw"Game Center not available"}},loadScores:function(a,b){if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"loadScores",[b,a],true)}else{throw"Game Center not available"}},submitScore:function(a,b){if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"submitScore",[a,b],true)}else{throw"Game Center not available"}},submitAchievements:function(a,b){if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"submitAchievements",[a,b],true)}else{throw"Game Center not available"}},resetAchievements:function(a){if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"resetAchievements",[a],true)}else{throw"Game Center not available"}},showAchievements:function(a){if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"showAchievements",[a],true)}else{throw"Game Center not available"}},showLeaderboards:function(a,b){if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"showLeaderboards",[b,a],true)}else{throw"Game Center not available"}}};a.GameCenter=new a.GameCenterExtension;a.GameCenter.Player=function(){this.playerID="";this.alias="";this.isFriend=false};a.GameCenter.LocalPlayer=function(){this.playerID="";this.alias="";this.isAuthenticated=false};a.GameCenter.Achievement=function(a,b){this.identifier=a;this.percentComplete=b;this.lastReportedDate=0};a.GameCenter.AchievementDescription=function(){this.identifier="";this.title="";this.achievedDescription="";this.unachievedDescription="";this.maximumPoints=0};a.GameCenter.Score=function(a,b,c,d,e,f){this.userID=a;this.score=b||0;this.userName=c;this.imageURL=d;this.leaderboardID=e;this.rank=f.rank;this.originalScoreObject=f;return this};a.GameCenter.Leaderboard=function(a,b,c,d,e,f){this.category=a;this.playerIDs=b;this.timeScope=c;this.playerScope=d;this.rangeStart=e;this.rangeLength=f;this.scores=[];this.localPlayerScore=[];this.localizedTitle=localizedTitle};a.GameCenter.TimeScope={TODAY:0,WEEK:1,ALL_TIME:2};a.GameCenter.PlayerScope={GLOBAL:0,FRIENDS:1};a.SocialGamingServiceGameCenter=function(a){Cocoon.Social.SocialGamingServiceGameCenter.superclass.constructor.call(this);this.gc=a;var b=this;this.gc.onGameCenterLoginStateChanged.addEventListener(function(a,c){b.onLoginStatusChanged.notifyEventListeners(a.isAuthenticated,c)});return this};a.SocialGamingServiceGameCenter.prototype={_cachedAchievements:null,isLoggedIn:function(){return this.gc.isLoggedIn()},login:function(a){this.gc.login(function(b,c){if(a)a(b.isAuthenticated,c)})},logout:function(a){if(a)a({message:"User has to logout from the Game Center APP"})},getLoggedInUser:function(){return b(this.gc._currentPlayer?this.gc._currentPlayer:this.gc.getLocalPlayer())},requestUser:function(a,c){if(c){this.gc.loadPlayers([c],function(c,d){var e=c&&c.length?b(c[0]):null;a(e,d)})}else{var d=this;setTimeout(function(){a(d.getLoggedInUser())})}},requestFriends:function(a,c){this.gc.loadFriends(function(c,d){var e=[];if(c&&c.length){for(var f=0;f<c.length;++f){e.push(b(c[f]))}}a(e,d)})},requestScore:function(a,b){var c={};var d=b||{};if(d.leaderboardID)c.category=d.leaderboardID;c.playerIDs=[d.userID||this.getLoggedInUser().userID];this.gc.loadScores(function(b,c){var e=null;if(d.userID&&b&&b.scores&&b.scores.length)e=b.scores[0];else if(b&&b.localPlayerScore)e=b.localPlayerScore;var f=e?new Cocoon.Social.GameCenter.Score(e.playerID,e.value,"","",e.category,e):null;a(f,c)},c)},submitScore:function(a,b,c){var d=c||{};this.gc.submitScore({value:a,category:d.leaderboardID||""},function(a){if(b)b(a)})},showLeaderboard:function(a,b){var c=b||{};this.gc.showLeaderboards(function(b){if(a)a(b)},{category:c.leaderboardID||""})},prepareAchievements:function(a,b){if(!this._cachedAchievements||a){var d=this;this.gc.loadAchievementDescriptions(function(a,e){if(e){b([],e)}else{var f=[];if(a&&a.length){for(var g=0;g<a.length;g++){f.push(c(a[g]))}}d.setCachedAchievements(f);b(f,null)}})}else{b(this._cachedAchievements,null)}},requestAllAchievements:function(a){this.prepareAchievements(true,a)},requestAchievements:function(a,b){var c=this;this.prepareAchievements(false,function(b,d){if(d){a([],d);return}c.gc.loadAchievements(function(b,d){if(!d){var e=[];if(b&&b.length){for(var f=0;f<b.length;f++){var g=c.findAchievement(b[f].identifier);if(g)e.push(g)}}a(e,null)}else{a([],b.error)}})})},submitAchievement:function(a,b){if(a===null||typeof a==="undefined")throw"No achievementID specified";var c=this.translateAchievementID(a);this.gc.submitAchievements([{identifier:c,percentComplete:100}],b)},resetAchievements:function(a){this.gc.resetAchievements(a)},showAchievements:function(a){this.gc.showAchievements(function(b){if(a)a(b)})}};Cocoon.extend(a.SocialGamingServiceGameCenter,a.SocialGamingService);function b(a){return new Cocoon.Social.User(a.playerID,a.alias)}function c(a){return new Cocoon.Social.GameCenter.Achievement(a.identifier,a.title,a.achievedDescription,"",a.maximumPoints)}return a});Cocoon.define("Cocoon.Social",function(a){a.FacebookExtension=function(){this.nativeExtensionName="IDTK_SRV_FACEBOOK";this.extensionName="Social.Facebook";this.nativeAvailable=!!window.ext&&!!window.ext[this.nativeExtensionName];this.Event=new Cocoon.Social.FacebookEvent(this.nativeAvailable);var a=this;if(this.nativeAvailable){this.onFacebookSessionStateChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onFacebookSessionStateChanged");Cocoon.Social.Facebook=this;this.onFacebookSessionStateChanged.addEventListener(function(b,d){var e=c(b,d);if(b.state==0){a.Event.notify("auth.login",e)}a.Event.notify("auth.authResponseChange",e);a.Event.notify("auth.statusChange",e)})}return this};a.FacebookExtension.prototype={_currentSession:null,_appId:null,_socialService:null,init:function(a){if(!a||!a.appId){throw"appId must be specified!"}this._appId=a.appId;if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"init",[a],true)}else{FB.init(a)}var b=this;this.Event.subscribe("auth.authResponseChange",function(a){b._currentSession=a;if(a.authResponse&&!a.authResponse.user){b.api("me?fields=username",function(a){b._currentSession.authResponse.user=a})}})},getSocialInterface:function(){if(!this._appId){throw"You must call init() before getting the Social Interface"}if(!this._socialService){this._socialService=new Cocoon.Social.SocialGamingServiceFacebook(this)}return this._socialService},login:function(a,b){var d=this;if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"login",[b,function(b,e){d._currentSession=c(b,e);if(a){a(d._currentSession)}}],true)}else{FB.login(function(b){d._currentSession=b;if(a)a(b)},b)}},logout:function(a){if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"logout",[function(b,d){if(a){a(c(b,d))}}],true)}else{FB.logout(function(b){if(a){a(b)}})}},getAuthResponse:function(){if(this.nativeAvailable){var a=Cocoon.callNative(this.nativeExtensionName,"getFacebookSession",[]);return c(a)}else{return FB.getAuthResponse()}},getLoginStatus:function(a,b){if(this.nativeAvailable){var d=this;setTimeout(function(){var b=Cocoon.callNative(d.nativeExtensionName,"getFacebookSession",[]);if(a){a(c(b))}},50)}else{FB.getLoginStatus(a,b)}},api:function(a,b,c,d){if(this.nativeAvailable){var e=arguments[0];var f=arguments.length>3?arguments[1]:"GET";var g=null;if(arguments.length==3)g=arguments[1];if(arguments.length==4)g=arguments[2];var h=arguments.length>1?arguments[arguments.length-1]:function(){};return Cocoon.callNative(this.nativeExtensionName,"api",[e,f,g,h],true)}else{FB.api(a,b,c,d)}},ui:function(a,b){if(this.nativeAvailable){var a=arguments[0];var c=arguments.length>1?arguments[1]:function(){};return Cocoon.callNative(this.nativeExtensionName,"ui",[a,c],true)}else if(!navigator.isCocoonJS){FB.ui(a,b)}},requestAdditionalPermissions:function(a,b,d){if(this.nativeAvailable){var e=b.split(",");Cocoon.callNative(this.nativeExtensionName,"requestAdditionalPermissions",[a,e,function(a,b){if(d){d(c(a,b))}}],true)}else{FB.login(d,{scope:b})}},getPermissions:function(a){this.api("me/permissions",function(b){a(b.data&&b.data[0]?b.data[0]:{})})},showShareDialog:function(a,b){if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"showShareDialog",[a,b],true)}else{a.method="feed";FB.ui(a,b)}},uploadPhoto:function(a,b){if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"uploadPhoto",[a,b],true)}else{b({error:{message:"Not implemented"}})}},showFriendPicker:function(a){if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"showFriendPicker",[a],true)}else{a({error:{message:"Not implemented"}})}}};a.FacebookEvent=function(a){this.nativeAvailable=a;return this};a.FacebookEvent.prototype={subscribe:function(a,b){if(this.nativeAvailable){var c=a+"listeners";this[c]=this[c]||[];this[c].push(b)}else if(!navigator.isCocoonJS){FB.Event.subscribe(a,b)}},unsubscribe:function(a,b){if(this.nativeAvailable){var c=a+"listeners";var d=this[c];if(d){var e=d.indexOf(b);if(e!==-1){d.splice(e,1)}}}else if(!navigator.isCocoonJS){FB.Event.unsubscribe(a,b)}},notify:function(a,b){var c=a+"listeners";var d=this[c];if(d){for(var e=0;e<d.length;++e){d[e](b)}}}};a.Facebook=new a.FacebookExtension;function b(a){if(a===0){return"connected"}else if(a===1){return"not_authorized"}else{return"unknown"}}function c(a,c){var d=null;if(a.state===0){d={accessToken:a.accessToken,expirationDate:a.expirationDate,userID:a.user?a.userID:null,permissions:a.permissions,user:a.user}}return{status:b(a.state),authResponse:d,error:c}}a.SocialGamingServiceFacebook=function(a){Cocoon.Social.SocialGamingServiceFacebook.superclass.constructor.call(this);this.fb=a;var b=this;this.fb.Event.subscribe("auth.authResponseChange",function(a){b.onLoginStatusChanged.notifyEventListeners(a.status=="connected",a.error)});return this};a.SocialGamingServiceFacebook.prototype={currentPermissions:null,isLoggedIn:function(){return this.fb._currentSession&&this.fb._currentSession.status==="connected"},login:function(a){var b=this;this.fb.login(function(c){if(a)a(b.isLoggedIn(),c.error)})},logout:function(a){this.fb.logout(function(b){if(a)a(b.error)})},getLoggedInUser:function(){var a=this.fb._currentSession?this.fb._currentSession.authResponse:null;if(a&&a.user){return d(a.user)}else if(a&&a.userID){return new Cocoon.Social.Facebook.User(a.userID,"Loading...")}return null},hasPublishPermissions:function(a){this.fb.getPermissions(function(b,c){a(b.publish_actions,c)})},requestPublishPermissions:function(a){var b=this;this.fb.requestAdditionalPermissions("publish","publish_actions",function(c){if(c.error)a(false,error);else{b.hasPublishPermissions(function(b,c){a(b,c)})}})},requestUser:function(a,b){var c=b||"me";this.fb.api(c,function(b){var c=b.error?null:d(b);a(c,b.error)})},requestUserImage:function(a,b,c){if(!b&&this.isLoggedIn()){b=this.fb._currentSession.authResponse.userID}var d="small";if(c===Cocoon.Social.ImageSize.THUMB){d="square"}else if(c===Cocoon.Social.ImageSize.MEDIUM){d="normal"}else if(c===Cocoon.Social.ImageSize.LARGE){d="large"}var e="https://graph.facebook.com/"+b+"/picture?type="+d;a(e)},requestFriends:function(a,b){var c=(b||"me")+"/friends";this.fb.api(c,function(b){var c=[];if(!b.error){for(var e=0;e<b.data.length;e++){c.push(d(b.data[e]))}}a(c,b.error)})},preparePublishAction:function(a){if(!this.currentPermissions){var b=this;this.fb.getPermissions(function(c){b.currentPermissions=c;if(c)b.preparePublishAction(a)})}else if(this.currentPermissions.publish_actions){a(true)}else{this.currentPermissions=null;this.fb.requestAdditionalPermissions("publish","publish_actions",function(b){a(b.error?false:true)})}},publishMessage:function(a,b){this.preparePublishAction(function(c){if(c){var d=e(a);var f="me/feed";this.fb.api(f,d,function(a){if(b)b(a.error)})}else{if(b)b({message:"No publish_actions permission granted"})}})},publishMessageWithDialog:function(a,b){this.fb.showShareDialog(e(a),function(a){if(b){b(a.error)}})},requestScore:function(a,b){var c=(b&&b.userID?b.userID:"me")+"/scores";this.fb.api(c,function(b){if(b.error){a(null,b.error)}else if(b.data&&b.data.length>0){var c=f(b.data[0]);a(c,null)}else{a(null,null)}})},submitScore:function(a,b,c){var d=this;this.preparePublishAction(function(e){if(e){d.requestScore(function(e,f){if(f){if(b)b(f);return}var g=e?e.score:0;if(a<=g){if(b)b(null);return}var h="/"+(c&&c.userID?c.userID:"me")+"/scores";d.fb.api(h,"POST",{score:a},function(a){if(b)b(a.error)})},c)}else{if(b)b({message:"No publish_actions permission granted"})}})},showLeaderboard:function(a,b){if(!this._leaderboardsTemplate)throw"Please, provide a html template for leaderboards with the setTemplates method";var c=new Cocoon.Widget.WebDialog;var d=false;c.show(this._leaderboardsTemplate,function(b){c.closed=true;if(!d&&a)a(b)});var e=this;this.fb.api(e.fb._appId+"/scores",function(b){if(c.closed)return;if(b.error){if(a){d=true;a(b.error);c.close()}return}var g=[];if(b.data&&b.data.length){for(var h=0;h<b.data.length;++h){var i=f(b.data[h]);i.position=h;i.imageURL="https://graph.facebook.com/"+i.userID+"/picture";i.me=i.userID===e.fb._currentSession.authResponse.userID;g.push(i)}}var j="addScores("+JSON.stringify(g)+")";c.eval(j)})},prepareAchievements:function(a,b){if(!this._cachedAchievements||a){var c=this;this.fb.api(this.fb._appId+"/achievements",function(a){if(!a.error){var d=[];if(a.data){for(var e=0;e<a.data.length;e++){d.push(g(a.data[e]))}}c.setCachedAchievements(d);b(d,null)}else{b([],a.error)}})}else{b(this._cachedAchievements,null)}},requestAllAchievements:function(a){this.prepareAchievements(true,a)},requestAchievements:function(a,b){var c=this;this.prepareAchievements(false,function(d,e){if(e){a([],e);return}var f=(b||"me")+"/achievements";c.fb.api(f,function(b){if(!b.error){var d=[];if(b.data){for(var e=0;e<b.data.length;e++){var f=c.findAchievement((b.data[e].achievement||b.data[e].data.achievement).id);if(f)d.push(f)}}a(d,null)}else{a([],b.error)}})})},submitAchievement:function(a,b){if(a===null||typeof a==="undefined")throw"No achievementID specified";var c=this.translateAchievementID(a);var d=this;this.preparePublishAction(function(a){if(a){d.fb.api("me/achievements","POST",{achievement:c},function(a){if(b){b(a.error)}})}else{if(b)b({message:"No publish_actions permission granted"})}})},resetAchievements:function(a){var b=this;this.preparePublishAction(function(c){if(c){b.requestAchievements(function(c,d){if(d){if(a)a(d);return}var e=null;var f=c.length;for(var g=0;g<c.length;++g){b.fb.api("me/achievements","DELETE",{achievement:c[g].fbAchievementData.url},function(b){if(b.error){e=b.error}f--;if(f==0&&a){a(e)}})}})}else{if(a)a({message:"No publish_actions permission granted"})}})},showAchievements:function(a){if(!this._achievementsTemplate)throw"Please, provide a html template for achievements with the setTemplates method";var b=new Cocoon.Widget.WebDialog;var c=false;b.show(this._achievementsTemplate,function(d){b.closed=true;if(!c&&a)a(d)});var d=this;this.requestAchievements(function(e,f){if(b.closed)return;if(f){c=true;if(a)a(f);return}var g=[];if(d._cachedAchievements){for(var h=0;h<d._cachedAchievements.length;++h){var i=d._cachedAchievements[h];g.push(i);if(e&&e.length){for(var j=0;j<e.length;++j){if(e[j].achievementID===i.achievementID){i.achieved=true;break}}}}}var k="addAchievements("+JSON.stringify(g)+");";b.eval(k)})}};Cocoon.extend(a.SocialGamingServiceFacebook,a.SocialGamingService);function d(a){return new Cocoon.Social.User(a.id,a.username?a.username:a.first_name+" "+a.last_name)}function e(a){return{link:a.linkURL,description:a.message,name:a.linkText,caption:a.linkCaption,picture:a.mediaURL}}function f(a,b){var c=new Cocoon.Social.Score(a.user.id,a.score,a.user.name);if(b){c.leaderboardID=b.leaderboardID}c.imageURL="https://graph.facebook.com/"+a.user.id+"/picture";return c}function g(a){var b=new Cocoon.Social.Achievement(a.id,a.title,a.description,a.image[0].url,a.data.points);b.fbAchievementData=a;return b}if(!navigator.isCocoonJS&&!(typeof module!=="undefined"&&module.exports)){var h=document.getElementsByTagName("script")[0];var i=document.createElement("script");var j=location.protocol?location.protocol:"http:";i.src=j+"//connect.facebook.net/en_US/all.js";h.parentNode.insertBefore(i,h)}return a});Cocoon.define("Cocoon.Multiplayer",function(a){a.MultiplayerService=function(a,b){this.nativeExtensionName=a;this.extensionName=b;this.nativeAvailable=!!window.ext&&!!window.ext[this.nativeExtensionName];var c=this;this.onInvitationReceived=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onInvitationReceived");this.onInvitationLoaded=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onInvitationLoaded",function(a,b){var d=b[0];var e=b[1];if(d&&!e){c.currentMatch=new Cocoon.Multiplayer.Match(c.nativeExtensionName,c.extensionName,d);a(c.currentMatch,null)}else{a(null,e)}});var d=new Cocoon.Signal.createSignal;d.register("invitation",{received:this.onInvitationReceived,loaded:this.onInvitationLoaded});this.on=d.expose();return this};a.MultiplayerService.prototype={currentMatch:null,findMatch:function(a,b){var c=this;if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"findMatch",[a,function(a,d){if(a&&!d){c.currentMatch=new Cocoon.Multiplayer.Match(c.nativeExtensionName,c.extensionName,a);b(c.currentMatch,null)}else{b(null,d)}}],true)}},findAutoMatch:function(a,b){var c=this;if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"findAutoMatch",[a,function(a,d){if(a&&!d){c.currentMatch=new Cocoon.Multiplayer.Match(c.nativeExtensionName,c.extensionName,a);b(c.currentMatch,null)}else{b(null,d)}}],true)}},cancelAutoMatch:function(){if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"cancelAutoMatch",[],true)}},addPlayersToMatch:function(a,b,c){if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"addPlayersToMatch",[a,b.matchID,c],true)}},getMatch:function(){return this.currentMatch}};a.Match=function(a,b,c){if(typeof a!=="string")throw"The given native extension name '"+a+"' is not a string.";if(typeof b!=="string")throw"The given extension name '"+a+"' is not a string.";this.nativeExtensionName=a;this.extensionName=b;this.nativeAvailable=Cocoon.nativeAvailable&&typeof window.ext[a]!=="undefined";this.matchID=c;var d=this;this.onMatchDataReceived=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchDataReceived",function(a,b){if(d.matchID===b[0]){a(d,b[1],b[2])}});this.onMatchStateChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchStateChanged",function(a,b){if(d.matchID===b[0]){a(d,b[1],b[2])}});this.onMatchConnectionWithPlayerFailed=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchConnectionWithPlayerFailed",function(a,b){if(d.matchID===b[0]){a(d,b[1],b[2])}});this.onMatchFailed=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchFailed",function(a,b){if(d.matchID===b[0]){a(d,b[1])}});var e=new Cocoon.Signal.createSignal;e.register("match",{dataReceived:this.onMatchDataReceived,stateChanged:this.onMatchStateChanged,connectionWithPlayerFailed:this.onMatchConnectionWithPlayerFailed,failed:this.onMatchFailed});this.on=e.expose()};a.Match.prototype={start:function(){if(this.nativeAvailable){Cocoon.callNative(this.nativeExtensionName,"startMatch",[this.matchID],true)}},sendDataToAllPlayers:function(a,b){if(this.nativeAvailable){return Cocoon.callNative(this.nativeExtensionName,"sendDataToAllPlayers",[this.matchID,a,b])}},sendData:function(a,b,c){if(this.nativeAvailable){return Cocoon.callNative(this.nativeExtensionName,"sendData",[this.matchID,a,b,c])}},disconnect:function(){if(this.nativeAvailable){return Cocoon.callNative(this.nativeExtensionName,"disconnect",[this.matchID],true)}},requestPlayersInfo:function(a){if(this.nativeAvailable){return Cocoon.callNative(this.nativeExtensionName,"requestPlayersInfo",[this.matchID,a],true)}},getExpectedPlayerCount:function(){if(this.nativeAvailable){return Cocoon.callNative(this.nativeExtensionName,"getExpectedPlayerCount",[this.matchID])}},getPlayerIDs:function(){if(this.nativeAvailable){return Cocoon.callNative(this.nativeExtensionName,"getPlayerIDs",[this.matchID])}},getLocalPlayerID:function(){if(this.nativeAvailable){return Cocoon.callNative(this.nativeExtensionName,"getLocalPlayerID",[this.matchID])}return""}};a.SendDataMode={RELIABLE:0,UNRELIABLE:1};a.ConnectionState={UNKNOWN:0,CONNECTED:1,DISCONNECTED:2};a.PlayerInfo=function(a,b){this.userID=a;this.userName=b};a.MatchRequest=function(a,b,c,d,e){this.minPlayers=a;this.maxPlayers=b;this.playersToInvite=c;this.playerGroup=d;this.playerAttributes=e;return this};return a});Cocoon.define("Cocoon.Multiplayer",function(a){var b=[];var c=0;var d=[];var e=0;a.LoopbackService=function(){Cocoon.Multiplayer.LoopbackService.superclass.constructor.call(this,"dummy","dummy");b.push(this);this.playerID=""+c;c++};a.LoopbackService.prototype={findMatch:function(a,b){this.findMatchCallback=b;var c=false;for(var e=0;e<d.length;++e){if(d[e]===this){c=true;break}}if(!c)d.push(this);if(d.length>=a.minPlayers){var g=[];for(var e=0;e<d.length;++e){g.push(d[e].getPlayerID())}for(var e=0;e<d.length;++e){var h=new f(d[e]);h.playerIDs=g.slice();d[e].currentMatch=h;d[e].findMatchCallback(h,null)}d=[]}},findAutoMatch:function(a,b){this.findMatch(a,b)},cancelAutoMatch:function(){},addPlayersToMatch:function(a,b,c){c({message:"Not implemmented"})},getPlayerID:function(){return this.playerID},getMatch:function(){return this.currentMatch}};Cocoon.extend(a.LoopbackService,a.MultiplayerService);var f=function(a){e++;f.superclass.constructor.call(this,"","",e);this.started=false;this.disconnected=false;this.pendingData=[];this.service=a};f.prototype={start:function(){var a=this;setTimeout(function(){a.started=true;for(var b=0;b<a.pendingData.length;++b){a.onMatchDataReceived.notifyEventListeners(a.matchID,a.pendingData[b].data,a.pendingData[b].player)}},0)},sendDataToAllPlayers:function(a,b){this.sendData(a,this.playerIDs,b)},sendData:function(a,c,d){var e=this;setTimeout(function(){for(var d=0;d<b.length;++d){var f=null;for(var g=0;g<c.length;++g){if(c[g]===b[d].getPlayerID()){f=b[d]}}if(f){f.getMatch().notifyDataReceived(a,e.service.getPlayerID())}}},0)},disconnect:function(){this.disconnected=true;for(var a=0;a<this.playerIDs.length;++a){var c=this.playerIDs[a];for(var d=0;d<b.length;++d){if(b[d].getPlayerID()===c){var e=b[a].getMatch();if(!e.disconnected){e.onMatchStateChanged.notifyEventListeners(e,this.service.getPlayerID(),Cocoon.Multiplayer.ConnectionState.DISCONNECTED)}}}}},requestPlayersInfo:function(a){var b=this;setTimeout(function(){var c=[];for(var d=0;d<b.playerIDs.length;++d){c[d]={userID:b.playerIDs[d],userName:"Player"+b.playerIDs[d]}}a(c)},1)},getExpectedPlayerCount:function(){return 0},getPlayerIDs:function(){return this.playerIDs},getLocalPlayerID:function(){return this.service.playerID},notifyDataReceived:function(a,b){if(!this.started){this.pendingData.push({data:a,player:b})}else{this.onMatchDataReceived.notifyEventListeners(this.matchID,a,b)}}};Cocoon.extend(f,Cocoon.Multiplayer.Match);return a});Cocoon.define("Cocoon.Multiplayer",function(a){a.GooglePlayGames=new Cocoon.Multiplayer.MultiplayerService("IDTK_SRV_MULTIPLAYER_GPG","Multiplayer.GooglePlayGames");return a});Cocoon.define("Cocoon.Multiplayer",function(a){a.GameCenter=new Cocoon.Multiplayer.MultiplayerService("IDTK_SRV_MULTIPLAYER_GAMECENTER","Multiplayer.GameCenter");return a});(function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i=typeof require=="function"&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}var f=typeof require=="function"&&require;for(var g=0;g<d.length;g++)e(d[g]);return e})({1:[function(a,b,c){b.exports=function(){throw Error("[BaseClass] Abstract method was called without definition.")}},{}],2:[function(a,b,c){var d=a("./rebind.js");function e(a){a.extend=function(b){var c,e={base:a.base};b=b||{};for(c in a){if(typeof a[c]==="function"){e[c]=a[c].bind(a)}}for(c in b){if(typeof b[c]==="function"){a[c]=d(c,a,e,b)}else{a[c]=b[c]}}a.base=e;return a};a.implement=function(){var b,c=arguments.length;for(b=0;b<c;b+=1){arguments[b](a)}return a};return a}e.Abstract=a("./abstract.js");e.Stub=a("./stub.js");e.Interface=a("./interface.js");b.exports=e},{"./abstract.js":1,"./interface.js":3,"./rebind.js":4,"./stub.js":5}],3:[function(a,b,c){b.exports=function(a){return function(b){var c;for(c in a){b[c]=a[c]}return b}}},{}],4:[function(a,b,c){b.exports=function(a,b,c,d){return function(){var e,f=b.base;b.base=c;b.self=d;e=d[a].apply(b,arguments);b.base=f;return e}}},{}],5:[function(a,b,c){b.exports=function(){}},{}],6:[function(a,b,c){b.exports=a(1)},{"F:\\wamp\\www\\horse-jockey\\node_modules\\baseclassjs\\src\\abstract.js":1}],7:[function(a,b,c){b.exports=a(2)},{"./abstract.js":6,"./interface.js":8,"./rebind.js":9,"./stub.js":10,"F:\\wamp\\www\\horse-jockey\\node_modules\\baseclassjs\\src\\baseclass.js":2}],8:[function(a,b,c){b.exports=a(3)},{"F:\\wamp\\www\\horse-jockey\\node_modules\\baseclassjs\\src\\interface.js":3}],9:[function(a,b,c){b.exports=a(4)},{"F:\\wamp\\www\\horse-jockey\\node_modules\\baseclassjs\\src\\rebind.js":4}],10:[function(a,b,c){b.exports=a(5)},{"F:\\wamp\\www\\horse-jockey\\node_modules\\baseclassjs\\src\\stub.js":5}],11:[function(a,b,c){b.exports=function(){var a,b=arguments[0],c=arguments.length;for(a=1;a<c;a+=1){b=b.replace(/%s/,arguments[a])
}return b}},{}],12:[function(a,b,c){(function(a){b.exports=function(b){var c,d={},e={},f=[],g=a.localStorage||{};c=function(a,c){var h,i,a,j;var k=typeof a==="string";var l=typeof c;var m=l!=="undefined"&&l!=="function";if(g.lumberjack!=="on"&&!b){return}if(k&&m){j={time:new Date,data:c,channel:a,id:f.length};d[a]=d[a]||[];d[a].push(j);f.push(j);e[a]=e[a]||[];i=e[a].length;for(h=0;h<i;h+=1){e[a][h](c)}}else{throw Error("Lumberjack Error: log(channel, data) requires an channel {String} and a payload {String|Object|Number|Boolean}.")}};c.clear=function(a){if(a){d[a]=[]}else{d={};f=[]}};c.readback=function(a,b){var c=typeof a==="string";if(c){if(b){return JSON.stringify(d[a],null,4)}return d[a]||[]}throw Error("log.readback(channel, pretty) requires an channel {String}.")};c.readback.master=function(a){if(a){return JSON.stringify(f,null,4)}return f};c.readback.channels=function(a){var b=Object.keys(d);if(a){return JSON.stringify(b)}return b};c.on=function(a,b){var c=typeof a==="string";var d=typeof b==="function";if(c&&d){e[a]=e[a]||[];e[a].push(b)}else{throw Error("log.on(channel, cb) requires an channel {String} and a callback {Function}.")}};c.off=function(a){var b=typeof a==="string";if(b){e[a]=[]}else{throw Error("log.off(channel) requires an channel {String}.")}};c.enable=function(){b=true};c.disable=function(){b=false};return c}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],13:[function(a,b,c){var d=a("./dimension.js"),e=a("./point.js"),f=a("./log.js");b.exports=function(a){var b,c=0,f=false,g=a.frames||1,h=a.size||d(),i=a.start||e(),i=e(h.width*i.x,h.height*i.y),j=1;return{size:h,frame:0,speed:a.speed||0,load:function(b){a.sheet.load(b)},start:function(){b=Date.now();f=true},pause:function(){f=false},stop:function(){f=false;c=0;this.frame=0;j=1},update:function(){var a,d,e;if(f&&this.speed){e=1/this.speed*1e3;a=Date.now();d=a-b;c+=d;if(c>=e){c=0;this.nextFrame()}b=a}},nextFrame:function(){this.frame+=j;if(a.sinusoid){if(this.frame%(g-1)===0){j*=-1}}else{this.frame%=g}return this.frame},draw:function(b,c,e,f){var g,j=this.frame*h.width;e=e||d(1,1);f=f||0;g=d(h.width*e.width,h.height*e.height);b.save();b.translate(c.x+g.width/2,c.y+g.height/2);b.rotate(f);b.drawImage(a.sheet,i.x+j,i.y,h.width,h.height,-g.width/2,-g.height/2,g.width,g.height);b.restore()}}}},{"./dimension.js":23,"./log.js":32,"./point.js":34}],14:[function(a,b,c){b.exports=function(a){var b=document.createElement("audio"),c=b.play;b.loop=a.loop||false;b.volume=a.volume||1;b.play=function(a){if(a){this.currentTime=0}c.call(this)};b.stop=function(){this.pause();this.currentTime=0};a.on=a.on||{};b.onloadeddata=a.on.load;b.onplay=a.on.play;b.onplaying=a.on.playing;b.onended=a.on.ended;b.src="assets/sound/"+a.src;return b}},{}],15:[function(a,b,c){var d=a("./detect-mobile.js"),e=document.createElement("canvas");if(d){e.width=window.innerWidth;e.height=window.innerHeight}else{if(localStorage.drago==="landscape"){e.width=480;e.height=320}else{e.width=320;e.height=480}e.style.border="1px solid #000"}document.body.appendChild(e);e.mobile=d;e.ctx=e.getContext("2d");b.exports=e},{"./detect-mobile.js":22}],16:[function(a,b,c){var d=a("./shape.js"),e=a("./vector.js"),f=a("./point.js"),g=a("./dimension.js");b.exports=function(a,b){a=a||f();b=b||0;return d({pos:a,name:"circle",intersects:{rectangle:function(a){var b,c=f(this.x,this.y);if(this.x>a.right)c.x=a.right;else if(this.x<a.x)c.x=a.x;if(this.y>a.bottom)c.y=a.bottom;else if(this.y<a.y)c.y=a.y;b=e(this.x-c.x,this.y-c.y);return b.magnitude<this.radius},circle:function(a){var b=e(a.x-this.x,a.y-this.y);return b.magnitude<this.radius+a.radius}}}).extend({radius:b,width:b*2,height:b*2,top:a.y-b,right:a.x+b,bottom:a.y+b,left:a.x-b,draw:function(a){a.beginPath();a.lineWidth=1;a.strokeStyle="rgba(250, 50, 50, 0.5)";a.arc(this.x,this.y,this.radius,0,2*Math.PI);a.stroke()},move:function(a,b){this.x=a;this.y=b;this.top=b-this.radius;this.right=a+this.radius;this.bottom=b+this.radius;this.left=a-this.radius},resize:function(a){this.radius=a;this.width=a*2;this.height=a*2;this.top=this.y-a;this.right=this.x+a;this.bottom=this.y+a;this.left=this.x-a}})}},{"./dimension.js":23,"./point.js":34,"./shape.js":38,"./vector.js":41}],17:[function(a,b,c){var d=a("baseclassjs"),e=a("./sprite.js");b.exports=function(a){return e(a).extend({load:function(a){a()},start:d.Stub,pause:d.Stub,stop:d.Stub,update:d.Stub,draw:d.Stub})}},{"./sprite.js":39,baseclassjs:7}],18:[function(a,b,c){var d=a("./id-counter.js"),e=a("./event-handler.js"),f=a("baseclassjs"),g=a("./rectangle.js"),h=a("./point.js");b.exports=function(a){var b={},c={},i=[],j=false;if(a.collisionSets){i=[].concat(a.collisionSets)}return f({id:d.nextId,name:a.name,mask:a.mask||g(),offset:a.offset||h(),move:function(a){this.mask.move(a.x+this.offset.x,a.y+this.offset.y)},intersects:function(a){return this.mask.intersects(a)},update:function(){var a=this;if(!j){i.forEach(function(b){b.update(a)});j=true}},teardown:function(){j=false;c={}},addCollision:function(a){b[a]=true;c[a]=true},removeCollision:function(a){b[a]=false},clearCollisions:function(){b={}},isCollidingWith:function(a){return b[a]||false},canCollideWith:function(a){var b=this.id===a,d=c[a];return!b&&!d}}).implement(e({events:a.on,singles:a.one}))}},{"./event-handler.js":25,"./id-counter.js":29,"./point.js":34,"./rectangle.js":36,baseclassjs:7}],19:[function(a,b,c){var d=a("./rectangle.js"),e=a("./point.js"),f=a("./dimension.js"),g=a("./canvas.js");b.exports=function(a){var b,c,h=[],i=[],j=a.gridSize||f(1,1);for(b=0;b<j.width;b+=1){for(c=0;c<j.height;c+=1){h.push(d(e(b/j.width*g.width,c/j.height*g.height),f(g.width/j.width,g.height/j.height)))}}for(b=0;b<h.length;b+=1){i.push([])}return{name:a.name,draw:function(a,b){if(b){h.forEach(function(b){b.draw(a)})}i.forEach(function(b){b.forEach(function(b){b.mask.draw(a)})})},clearCollisions:function(){var a,b=i.length;for(a=0;a<b;a+=1){i[a]=[]}},update:function(a){var b,c=i.length;for(b=0;b<c;b+=1){if(a.intersects(h[b])){i[b].push(a)}}},handleCollisions:function(){var a,b,c=i.length;for(a=0;a<c;a+=1){b=i[a];b.forEach(function(a){b.forEach(function(b){var c,d,e=a.canCollideWith(b.id);if(e){c=a.intersects(b.mask),d=a.isCollidingWith(b.id);if(c){a.addCollision(b.id);if(!d){a.trigger("collide/"+b.name,b)}a.trigger("colliding/"+b.name,b)}else{if(d){a.removeCollision(b.id);a.trigger("separate/"+b.name,b)}a.trigger("miss/"+b.name,b)}}})})}},teardown:function(){this.clearCollisions()}}}},{"./canvas.js":15,"./dimension.js":23,"./point.js":34,"./rectangle.js":36}],20:[function(a,b,c){b.exports={Shape:a("./shape.js"),Circle:a("./circle.js"),Rectangle:a("./rectangle.js"),Dimension:a("./dimension.js"),Point:a("./point.js"),Vector:a("./vector.js"),Polar:a("./polar.js"),FrameCounter:a("./frame-counter.js"),IdCounter:a("./id-counter.js"),Mouse:a("./mouse.js"),Keyboard:a("./keyboard.js"),EventHandler:a("./event-handler.js"),SpriteSheet:a("./spritesheet.js"),AnimationStrip:a("./animation-strip.js"),Audio:a("./audio.js"),Font:a("./font.js"),CollisionHandler:a("./collision-handler.js"),collisions:a("./dragon-collisions.js"),Game:a("./game.js"),canvas:a("./canvas.js"),Screen:a("./screen.js"),Collidable:a("./collidable.js"),Sprite:a("./sprite.js"),ClearSprite:a("./clear-sprite.js")}},{"./animation-strip.js":13,"./audio.js":14,"./canvas.js":15,"./circle.js":16,"./clear-sprite.js":17,"./collidable.js":18,"./collision-handler.js":19,"./dimension.js":23,"./dragon-collisions.js":24,"./event-handler.js":25,"./font.js":26,"./frame-counter.js":27,"./game.js":28,"./id-counter.js":29,"./keyboard.js":31,"./mouse.js":33,"./point.js":34,"./polar.js":35,"./rectangle.js":36,"./screen.js":37,"./shape.js":38,"./sprite.js":39,"./spritesheet.js":40,"./vector.js":41}],21:[function(a,b,c){b.exports={show:{fps:function(){}}}},{}],22:[function(a,b,c){b.exports="ontouchstart"in window},{}],23:[function(a,b,c){function d(a,b){return{width:a||0,height:b||0,clone:function(){return d(this.width,this.height)},equals:function(a){return this.width===a.width&&this.height===a.height},scale:function(a){return d(this.width*a,this.height*a)}}}b.exports=d},{}],24:[function(a,b,c){var d=a("./collision-handler.js"),e=a("./dimension.js");b.exports=d({name:"dragon",gridSize:e(4,4)})},{"./collision-handler.js":19,"./dimension.js":23}],25:[function(a,b,c){var d=a("baseclassjs");b.exports=function(a){var b={},c={},e;a=a||{};for(e in a.events){b[e]=[a.events[e]]}for(e in a.singles){c[e]=[a.singles[e]]}return d.Interface({on:function(a,c){b[a]=b[a]||[];b[a].push(c)},one:function(a,b){c[a]=c[a]||[];c[a].push(b)},off:function(a){b[a]=[];c[a]=[]},trigger:function(a,d){var e=this;if(a in b){b[a].forEach(function(a){a.call(e,d)})}if(a in c){c[a].forEach(function(a){a.call(e,d)});c[a]=[]}}})}},{baseclassjs:7}],26:[function(a,b,c){var d=a("curb"),e="@font-face{font-family:'%s';font-style:%s;font-weight:%s;src:url(assets/fonts/%s);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2212,U+2215,U+E0FF,U+EFFD,U+F000}",f={};b.exports={load:function(a){var b;if(!f[a.name]){b=document.createElement("style");b.innerHTML=d(e,a.name,a.style||"normal",a.weight||"400",a.src);document.body.appendChild(b);f[a.name]=true}}}},{curb:11}],27:[function(a,b,c){var d=frameCountThisSecond=frameRate=0,e=Date.now();b.exports={countFrame:function(){var a=Date.now(),b=a-e;frameCountThisSecond+=1;e=a;d+=b;if(d>=1e3){d-=1e3;frameRate=frameCountThisSecond;frameCountThisSecond=0}},get frameRate(){return frameRate},draw:function(a){a.font="30px Verdana";a.fillStyle="rgba(250, 50, 50, 0.5)";a.fillText(frameRate,20,50)}}},{}],28:[function(a,b,c){var d=a("./collision-handler.js"),e=a("./point.js"),f=a("./dimension.js"),g=a("./circle.js"),h=a("./rectangle.js"),i=a("./collidable.js"),j=a("./frame-counter.js"),k=a("./mouse.js"),l=a("./canvas.js"),m=l.ctx,n=a("./id-counter.js"),o=a("./log.js"),p=a("./dragon-collisions.js"),q=false,r=[],s={},t=[],u=false,v={},w=false,x={screentap:i({name:"screentap",mask:g(e(),8)}),screendrag:i({name:"screendrag",mask:g(e(),8)}),screenhold:i({name:"screenhold",mask:g(e(),8)}),screenedge:{top:i({name:"screenedge/top",mask:h(e(0,-9),f(l.width,10))}),right:i({name:"screenedge/right",mask:h(e(l.width-1,0),f(10,l.height))}),bottom:i({name:"screenedge/bottom",mask:h(e(0,l.height-1),f(l.width,10))}),left:i({name:"screenedge/left",mask:h(e(-9,0),f(10,l.height))})}};k.on.down(function(){x.screentap.move(k.offset);p.update(x.screentap)});b.exports={debug:a("./debug-console.js"),screen:function(a){return s[a]},addScreens:function(a){var b;if(a){a=[].concat(a);b=n.nextId;v[b]=a.length;a.forEach(function(c){c.load(function(){v[b]-=1;if(v[b]===0){t=t.concat(a)}})})}},removeScreen:function(a){a.removed=true;u=true},run:function(a){var b=this,c=function(){b.update();b.draw();b.teardown();j.countFrame();if(w){window.requestAnimationFrame(c)}};q=a;if(a){window.Dragon=this}if(!w){w=true;window.requestAnimationFrame(c)}},kill:function(){w=false;r.forEach(function(a){a.stop()})},update:function(){if(k.is.dragging){x.screendrag.move(k.offset);p.update(x.screendrag)}else if(k.is.holding){x.screenhold.move(k.offset);p.update(x.screenhold)}p.update(x.screenedge.top);p.update(x.screenedge.right);p.update(x.screenedge.bottom);p.update(x.screenedge.left);r.forEach(function(a){a.update()});p.handleCollisions();if(t.length){t.forEach(function(a){r.push(a);if(a.name){s[a.name]=a}a.trigger("ready")});r.sort(function(a,b){return b.depth-a.depth});t=[]}},draw:function(){r.forEach(function(a){a.draw(m,q)});if(q){j.draw(m);p.draw(m)}},teardown:function(){p.teardown();r.forEach(function(a){a.teardown()});if(u){r=r.filter(function(a){return!a.removed});u=false}}}},{"./canvas.js":15,"./circle.js":16,"./collidable.js":18,"./collision-handler.js":19,"./debug-console.js":21,"./dimension.js":23,"./dragon-collisions.js":24,"./frame-counter.js":27,"./id-counter.js":29,"./log.js":32,"./mouse.js":33,"./point.js":34,"./rectangle.js":36}],29:[function(a,b,c){var d=0;b.exports={get lastId(){return d},get nextId(){d+=1;return d}}},{}],30:[function(a,b,c){b.exports=function(a){var b=new Image;b.ready=false;b.cmd=[];b.processLoadEvents=function(){this.cmd.forEach(function(a){a(b)});this.cmd=[]};b.onload=function(){this.ready=true;this.processLoadEvents()};b.load=function(c){c=c||function(){};if(this.ready){c(b)}else{this.cmd.push(c);this.src="assets/img/"+a}};return b}},{}],31:[function(a,b,c){var d={alt:false,ctrl:false,shift:false},e={};function f(a){return a.charCode||a.keyCode||a.which}document.onkeydown=function(a){var b=f(a),c=String.fromCharCode(b);e[b]=true;d[c]=true;d.alt=a.altKey;d.ctrl=a.ctrlKey;d.shift=a.shiftKey};document.onkeyup=function(a){var b=f(a),c=String.fromCharCode(b);e[b]=false;d[c]=false;d.alt=a.altKey;d.ctrl=a.ctrlKey;d.shift=a.shiftKey};b.exports={get alt(){return d.alt},get ctrl(){return d.ctrl},get shift(){return d.shift},arrow:{get left(){return e[37]||false},get up(){return e[38]||false},get right(){return e[39]||false},get down(){return e[40]||false}},name:function(a){return d[a]||false},code:function(a){return e[a]||false}}},{}],32:[function(a,b,c){var d=a("lumberjackjs");b.exports=d()},{lumberjackjs:12}],33:[function(a,b,c){(function(c){var d=a("./point.js"),e=a("./vector.js"),f=a("./canvas.js"),g=false,h=false,i=false,j=d(),k=d(),l=e(),m,n,o;if(f.mobile){m="touchstart";n="touchmove";o="touchend"}else{m="mousedown";n="mousemove";o="mouseup"}function p(a){if(f.mobile){return d(a.touches[0].clientX,a.touches[0].clientY)}return d(a.offsetX,a.offsetY)}f.addEventListener(m,function(a){g=true;j=p(a);c.setTimeout(function(){if(g){i=true}},200)});document.addEventListener(o,function(a){g=h=i=false});f.addEventListener(n,function(a){k=j;j=p(a);if(g){l.x=j.x-k.x;l.y=j.y-k.y;if(l.magnitude>1){h=true}}});b.exports={is:{get down(){return g},get dragging(){return h},get holding(){return i}},get offset(){return j},on:{down:function(a){f.addEventListener(m,a)},click:function(a){},dclick:function(a){},up:function(a){document.addEventListener(o,a)},move:function(a){f.addEventListener(n,a)}},eventName:{start:m,move:n,end:o}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./canvas.js":15,"./point.js":34,"./vector.js":41}],34:[function(a,b,c){function d(a,b){return{x:a||0,y:b||0,clone:function(){return d(this.x,this.y)},equals:function(a){return this.x===a.x&&this.y===a.y}}}b.exports=d},{}],35:[function(a,b,c){var d=a("./vector.js");function e(a,b,c,d){var e=a.magnitude===d*b.magnitude,f=(a.theta%Math.PI).toFixed(5),g=((b.theta+c)%Math.PI).toFixed(5);return e&&f===g}function f(a,b){return{theta:a||0,magnitude:b||0,invert:function(){return f(this.theta+Math.PI,this.magnitude*-1)},clone:function(){return f(this.theta,this.magnitude)},toVector:function(){return d(this.magnitude*Math.cos(this.theta),this.magnitude*Math.sin(this.theta))},equals:function(a){return e(this,a,0,1)||e(this,a,Math.PI,-1)}}}b.exports=f},{"./vector.js":41}],36:[function(a,b,c){var d=a("./shape.js"),e=a("./point.js"),f=a("./dimension.js"),g=a("./vector.js");b.exports=function(a,b){a=a||e();b=b||f();return d({pos:a,name:"rectangle",intersects:{rectangle:function(a){return this.x<a.right&&this.right>a.x&&this.y<a.bottom&&this.bottom>a.y},circle:function(a){var b,c=e(a.x,a.y);if(a.x>this.right)c.x=this.right;else if(a.x<this.x)c.x=this.x;if(a.y>this.bottom)c.y=this.bottom;else if(a.y<this.y)c.y=this.y;b=g(a.x-c.x,a.y-c.y);return b.magnitude<a.radius}}}).extend({width:b.width||0,height:b.height||0,top:a.y||0,right:a.x+b.width||0,bottom:a.y+b.height||0,left:a.x||0,move:function(a,b){this.x=a;this.y=b;this.top=b;this.right=a+this.width;this.bottom=b+this.height;this.left=a},resize:function(a){this.width=a.width;this.height=a.height;this.right=this.x+a.width;this.bottom=this.y+a.height},draw:function(a){a.beginPath();a.lineWidth=1;a.strokeStyle="rgba(250, 50, 50, 0.5)";a.rect(this.x,this.y,this.width,this.height);a.stroke()}})}},{"./dimension.js":23,"./point.js":34,"./shape.js":38,"./vector.js":41}],37:[function(a,b,c){var d=a("baseclassjs"),e=a("./event-handler.js"),f=a("./id-counter.js");b.exports=function(a){var b=false,c=[],g={},h=[],i=[],j={},k=false,l={},m=false,n=false;function o(){if(h.length){h.forEach(function(a){c.push(a);if(a.name){g[a.name]=a}a.trigger("ready")});c.sort(function(a,b){return b.depth-a.depth});h=[]}}return d({name:a.name,load:function(c){if(!b){this.addCollisionSets(a.collisionSets);this.addSprites({set:a.spriteSet,onload:c,force:true});b=true}},start:function(){m=true;n=true;this.trigger("start")},pause:function(){m=false;n=true;this.trigger("pause")},stop:function(){m=false;n=false;this.trigger("stop")},depth:a.depth||0,collision:function(a){return l[a]},addCollisionSets:function(a){if(a){a=[].concat(a);a.forEach(function(a){l[a.name]=a})}},sprite:function(a){return g[a]},addSprites:function(a){var b,c,d;a=a||{};c=a.onload||function(){};d=[].concat(a.set);if(a.set.length){b=f.nextId;j[b]=d.length;d.forEach(function(e){e.load(function(){j[b]-=1;if(j[b]===0){h=h.concat(d);if(a.force){o()}c()}})})}else{c()}},removeSprite:function(a){a.removed=true;k=true},update:function(){var a;if(m){c.forEach(function(a){if(m&&!a.removed){a.update()}});for(a in l){l[a].handleCollisions()}}o()},draw:function(a,b){var d;if(n){c.forEach(function(b){b.draw(a)});if(b){for(d in l){l[d].draw(a)}}}},teardown:function(){var a;if(m){c.forEach(function(a){if(!a.removed){a.teardown()}})}for(a in l){l[a].teardown()}if(k){c=c.filter(function(a){return!a.removed});k=false}}}).implement(e({events:a.on,singles:a.one}))}},{"./event-handler.js":25,"./id-counter.js":29,baseclassjs:7}],38:[function(a,b,c){var d=a("baseclassjs"),e=a("./point.js");b.exports=function(a){var b,c;a=a||{};c=a.intersects||{};b=a.pos||e();return d({x:b.x,y:b.y,name:a.name,move:d.Abstract,resize:d.Abstract,intersects:function(a){return c[a.name].call(this,a)},draw:d.Stub})}},{"./point.js":34,baseclassjs:7}],39:[function(a,b,c){var d=a("baseclassjs"),e=a("./collidable.js"),f=a("./point.js"),g=a("./dimension.js"),h=a("./rectangle.js");b.exports=function(a){var b=false,c=a.strips||{},d=a.pos||f(),i=false,j=false;if(!a.freemask){a.mask=a.mask||h();a.offset=f(a.mask.x,a.mask.y);a.mask.move(d.x+a.offset.x,d.x+a.offset.y)}a.one=a.one||{};a.one.ready=a.one.ready||function(){this.start()};return e(a).extend({strip:c[a.startingStrip],useStrip:function(a){if(this.strip!==c[a]){this.strip.stop();this.strip=c[a];this.strip.start()}},getStrip:function(a){return c[a]},pos:d,scale:a.scale||1,size:a.size||(c[a.startingStrip]||{}).size,trueSize:function(){return this.size.scale(this.scale)},rotation:a.rotation||0,depth:a.depth||0,speed:a.speed||f(),start:function(){i=true;j=true;this.strip.start();this.trigger("start")},pause:function(){i=false;j=true;this.strip.pause();this.trigger("pause")},stop:function(){i=false;j=false;this.strip.stop();this.trigger("stop")},update:function(){if(i){this.shift();this.strip.update();this.base.update()}},draw:function(a){var b;if(j){b=this.strip.size;this.strip.draw(a,this.pos,g(this.scale*this.size.width/b.width,this.scale*this.size.height/b.height),this.rotation)}},load:function(a){var d,e;if(!b){e=Object.keys(c).length;for(d in c){c[d].load(function(){e-=1;if(e===0){a();b=true}})}}},move:function(b,c){this.pos.x=b;this.pos.y=c;if(!a.freemask){this.base.move(this.pos)}},shift:function(b,c){this.pos.x+=b||this.speed.x;this.pos.y+=c||this.speed.y;if(!a.freemask){this.base.move(this.pos)}}})}},{"./collidable.js":18,"./dimension.js":23,"./point.js":34,"./rectangle.js":36,baseclassjs:7}],40:[function(a,b,c){var d=a("./image.js"),e={};b.exports=function(a){var b,c=a.src;if(c in e){b=e[c]}else{b=d(c);e[c]=b}return b}},{"./image.js":30}],41:[function(a,b,c){var d=a("./polar.js");function e(a,b){return{x:a||0,y:b||0,get magnitude(){return Math.abs(Math.sqrt(this.y*this.y+this.x*this.x))},clone:function(){return e(this.x,this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},scale:function(a){return e(this.x*a,this.y*a)},toPolar:function(){return d(Math.atan(this.y/this.x),this.magnitude)}}}b.exports=e},{"./polar.js":35}],42:[function(a,b,c){var d=a("dragonjs");b.exports=d.CollisionHandler({name:"racetrack",gridSize:d.Dimension(5,5)})},{dragonjs:20}],43:[function(a,b,c){(function(b){var c=a("dragonjs"),d=a("./screens/tracks/riverton.js");b.Cocoon.Utils.setAntialias(false);c.canvas.ctx.webkitImageSmoothingEnabled=false;c.canvas.ctx.mozImageSmoothingEnabled=false;c.canvas.ctx.imageSmoothingEnabled=false;c.Font.load({name:"Wonder",src:"8-bit-wonder.ttf"});c.Game.addScreens([a("./screens/training.js"),a("./screens/shop.js"),d]);c.Game.currentTrack=d;c.Game.loadTrack=function(a){this.currentTrack.stop();this.currentTrack=a;this.currentTrack.start()};c.Game.run(true)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./screens/shop.js":49,"./screens/tracks/riverton.js":51,"./screens/training.js":52,dragonjs:20}],44:[function(a,b,c){function d(a){a=a||{};return{speed:a.speed||1,jump:a.jump||1,strength:a.strength||1,smarts:a.smarts||1,health:a.health||1,clone:function(){return d(this)}}}b.exports=d},{}],45:[function(a,b,c){b.exports={none:function(){},flu:function(a){a.speed*=.8;a.jump*=.8;a.strength*=.8},thrush:function(a){a.speed*=.2},tetanus:function(){},rainRot:function(){},swampFever:function(){}}},{}],46:[function(a,b,c){function d(a){a=a||{};return{size:a.size||1,temper:a.temper||1,smarts:a.smarts||1,clone:function(){return d(this)}}}b.exports=d},{}],47:[function(a,b,c){b.exports={next:{get horse(){return"clydesdale"},get jockey(){return"jimmy"}}}},{}],48:[function(a,b,c){var d=a("./sprites/horse.js"),e=a("./sprites/jockey.js");b.exports={money:100,horse:d(),jockey:e()}},{"./sprites/horse.js":64,"./sprites/jockey.js":65}],49:[function(a,b,c){var d=a("dragonjs");b.exports=d.Screen({name:"shop",spriteSet:[a("../sprites/close-shop.js")],depth:-1})},{"../sprites/close-shop.js":63,dragonjs:20}],50:[function(a,b,c){var d=a("dragonjs"),e=a("../player.js"),f=a("../util.js");b.exports=function(b){var c,g=b.horses.concat(e.horse),h=f.range(g.length);f.shuffle(h);for(c=0;c<g.length;c+=1){g[c].pos.y=h[c]*45+40}return d.Screen({name:"racetrack",collisionSets:[a("../collisions/racetrack.js")],spriteSet:[].concat(g)}).extend({horses:g,race:function(){g.forEach(function(a){a.race()})}})}},{"../collisions/racetrack.js":42,"../player.js":48,"../util.js":66,dragonjs:20}],51:[function(a,b,c){var d=a("../track.js"),e=a("../../sprites/horse.js"),f=a("../../player.js");b.exports=d({horses:[e()]})},{"../../player.js":48,"../../sprites/horse.js":64,"../track.js":50}],52:[function(a,b,c){var d=a("dragonjs"),e=a("../player.js"),f=a("../sprites/buttons/race.js"),g={horse:[a("../sprites/buttons/train-speed.js"),a("../sprites/buttons/train-strength.js"),a("../sprites/buttons/train-jump.js"),a("../sprites/buttons/train-smarts.js")],jockey:[a("../sprites/buttons/train-jsmarts.js"),a("../sprites/buttons/train-size.js"),a("../sprites/buttons/train-temper.js")]},h=[].concat(g.horse).concat(g.jockey);b.exports=d.Screen({name:"training",spriteSet:[a("../sprites/buttons/open-shop.js"),f],one:{ready:function(){this.start()}},depth:0}).extend({draw:function(a){var b=a.createRadialGradient(d.canvas.width*(1-f.width)/2,d.canvas.height*.05,d.canvas.width*.1,d.canvas.width*(1-f.width)/2,d.canvas.height*.05,d.canvas.width);b.addColorStop(0,"#dfd3c8");b.addColorStop(1,"#8f8370");a.fillStyle=b;a.fillRect(0,0,d.canvas.width*(1-f.width),d.canvas.height);this.base.draw(a)}})},{"../player.js":48,"../sprites/buttons/open-shop.js":53,"../sprites/buttons/race.js":54,"../sprites/buttons/train-jsmarts.js":55,"../sprites/buttons/train-jump.js":56,"../sprites/buttons/train-size.js":57,"../sprites/buttons/train-smarts.js":58,"../sprites/buttons/train-speed.js":59,"../sprites/buttons/train-strength.js":60,"../sprites/buttons/train-temper.js":61,dragonjs:20}],53:[function(a,b,c){var d=a("dragonjs"),e=a("./race.js"),f=a("../close-shop.js"),g={top:.25},h=d.Dimension(d.canvas.width*.3,d.canvas.height*(f.margin.top-g.top));b.exports=d.Sprite({name:"shop-button",collisionSets:[d.collisions],mask:d.Rectangle(d.Point(),h),strips:{up:d.AnimationStrip({sheet:d.SpriteSheet({src:"buttons/gear.png"}),size:d.Dimension(35,11)})},startingStrip:"up",pos:d.Point((d.canvas.width-e.size.width)/2-h.width/2,d.canvas.height*g.top),size:h,on:{"colliding/screentap":function(){d.Game.screen("training").pause();d.Game.screen("shop").start()}}})},{"../close-shop.js":63,"./race.js":54,dragonjs:20}],54:[function(a,b,c){var d=a("dragonjs"),e=.18;b.exports=d.Sprite({name:"race",collisionSets:[d.collisions],mask:d.Rectangle(d.Point(),d.Dimension(d.canvas.width*e,d.canvas.height)),strips:{race:d.AnimationStrip({sheet:d.SpriteSheet({src:"buttons/start-race.png"}),size:d.Dimension(11,35)})},startingStrip:"race",pos:d.Point(d.canvas.width*(1-e),0),size:d.Dimension(d.canvas.width*e,d.canvas.height),on:{"colliding/screentap":function(){console.log(".. and they're off!")}}}).extend({width:e})},{dragonjs:20}],55:[function(a,b,c){var d=a("dragonjs"),e=a("./train.js"),f=a("../../player.js");b.exports=e({title:"+JBRN",src:"buttons/smarts.png",pos:d.Point(d.canvas.width/2,d.canvas.height/2-d.canvas.height/3)}).extend({click:function(){f.jockey.coreStats.smarts+=1;f.jockey.refreshStats()}})},{"../../player.js":48,"./train.js":62,dragonjs:20}],56:[function(a,b,c){var d=a("dragonjs"),e=a("./train.js"),f=a("../../player.js");b.exports=e({title:"+JMP",src:"buttons/jump.png",pos:d.Point(9*d.canvas.width/100,d.canvas.height/2-d.canvas.height/6)}).extend({click:function(){f.horse.coreStats.jump+=1;f.horse.refreshStats()}})},{"../../player.js":48,"./train.js":62,dragonjs:20}],57:[function(a,b,c){var d=a("dragonjs"),e=a("./train.js"),f=a("../../player.js");b.exports=e({title:"+SZE",src:"buttons/size.png",pos:d.Point(d.canvas.width/2,d.canvas.height/2+d.canvas.height/3)}).extend({click:function(){f.jockey.coreStats.size+=1;f.jockey.refreshStats()}})},{"../../player.js":48,"./train.js":62,dragonjs:20}],58:[function(a,b,c){var d=a("dragonjs"),e=a("./train.js"),f=a("../../player.js");b.exports=e({title:"+BRN",src:"buttons/smarts.png",pos:d.Point(9*d.canvas.width/100,d.canvas.height/2+d.canvas.height/6)}).extend({click:function(){f.horse.coreStats.smarts+=1;f.horse.refreshStats()}})},{"../../player.js":48,"./train.js":62,dragonjs:20}],59:[function(a,b,c){var d=a("dragonjs"),e=a("./train.js"),f=a("../../player.js");b.exports=e({title:"+SPD",src:"buttons/speed.png",pos:d.Point(27*d.canvas.width/100,d.canvas.height/2-d.canvas.height/3)}).extend({click:function(){f.horse.coreStats.speed+=1;f.horse.refreshStats()}})},{"../../player.js":48,"./train.js":62,dragonjs:20}],60:[function(a,b,c){var d=a("dragonjs"),e=a("./train.js"),f=a("../../player.js");b.exports=e({title:"+STR",src:"buttons/strength.png",pos:d.Point(27*d.canvas.width/100,d.canvas.height/2+d.canvas.height/3)}).extend({click:function(){f.horse.coreStats.strength+=1;f.horse.refreshStats()}})},{"../../player.js":48,"./train.js":62,dragonjs:20}],61:[function(a,b,c){var d=a("dragonjs"),e=a("./train.js"),f=a("../../player.js");b.exports=e({title:"+TPR",src:"buttons/temper.png",pos:d.Point(31*d.canvas.width/50,d.canvas.height/2)}).extend({click:function(){f.jockey.coreStats.temper+=1;f.jockey.refreshStats()}})},{"../../player.js":48,"./train.js":62,dragonjs:20}],62:[function(a,b,c){var d=a("dragonjs"),e=a("baseclassjs");b.exports=function(a){return d.Sprite({name:a.name||a.title,collisionSets:[d.collisions],mask:d.Circle(a.pos,40),freemask:true,strips:{up:d.AnimationStrip({sheet:d.SpriteSheet({src:a.src}),size:d.Dimension(256,64)})},startingStrip:"up",size:d.Dimension(128,32),pos:d.Point(a.pos.x-64,a.pos.y-16),on:{"colliding/screentap":function(){this.click()}}}).extend({title:a.title,click:e.Abstract})}},{baseclassjs:2,dragonjs:20}],63:[function(a,b,c){var d=a("dragonjs"),e=a("./buttons/race.js"),f={side:.1,bottom:.05,top:.38},g=d.Rectangle(d.Point(d.canvas.width*f.side,d.canvas.height*f.top),d.Dimension(d.canvas.width*(1-(e.width+2*f.side)),d.canvas.height*(1-(f.top+f.bottom))));b.exports=d.ClearSprite({name:"close-shop",collisionSets:[d.collisions],mask:d.Rectangle(d.Point(),d.canvas),pos:g,size:g,freemask:true,on:{"colliding/screentap":function(a){if(!a.intersects(g)){d.Game.screen("shop").stop();d.Game.screen("training").start()}}}}).extend({margin:f,update:function(){d.collisions.update(this)},draw:function(a){a.fillStyle="rgba(68, 68, 68, 0.6)";a.fillRect(0,0,d.canvas.width,d.canvas.height);a.fillStyle="#fafafa";a.fillRect(this.pos.x,this.pos.y,this.size.width,this.size.height);g.draw(a)}})},{"./buttons/race.js":54,dragonjs:20}],64:[function(a,b,c){var d=a("dragonjs"),e=a("../namer.js"),f=a("../illness.js"),g=a("../horse-stats.js");b.exports=function(b){b=b||{};return d.Sprite({name:"horse",collisionSets:[a("../collisions/racetrack.js"),d.collisions],mask:d.Rectangle(d.Point(),d.Dimension(50,37)),strips:{horse:d.AnimationStrip({sheet:d.SpriteSheet({src:"horse.png"}),size:d.Dimension(50,37)})},startingStrip:"horse",on:{"collide/screenedge/right":function(){this.speed.x=0}}}).extend({showname:b.showname||e.next.horse,coreStats:b.stats||g(),adjStats:g(),refreshStats:function(a){var b=this.coreStats.clone();a=a||function(){};a(b);this.sickness(b);this.adjStats=b},sickness:f.none,race:function(){this.refreshStats();this.speed.x=this.adjStats.speed}})}},{"../collisions/racetrack.js":42,"../horse-stats.js":44,"../illness.js":45,"../namer.js":47,dragonjs:20}],65:[function(a,b,c){var d=a("dragonjs"),e=a("../namer.js"),f=a("../jockey-stats.js");b.exports=function(a){a=a||{};return d.Sprite({name:"jockey",strips:{jockey:d.AnimationStrip({sheet:d.SpriteSheet({src:"jockey.png"}),size:d.Dimension(64,64)})},startingStrip:"jockey",pos:d.Point(100,100),depth:2}).extend({showname:a.showname||e.next.jockey,coreStats:a.stats||f(),adjStats:f(),refreshStats:function(a){var b=this.coreStats.clone();a=a||function(){};a(b);this.adjStats=b}})}},{"../jockey-stats.js":46,"../namer.js":47,dragonjs:20}],66:[function(a,b,c){b.exports={shuffle:function(a){var b,c,d;for(b=0;b<a.length;b+=1){c=parseInt(Math.random()*(b+1));d=a[b];a[b]=a[c];a[c]=d}return a},range:function(a,b){var c,d,e=[];if(!b){b=a;a=0}d=b-a;for(c=0;c<d;c+=1){e.push(c+a)}return e}}},{}]},{},[43,44,45,46,47,48,66]);